import{u as C,r as I,n as k,j as e,C as E,e as R,f as T,g as A,a as D,B as N,l as P,L as f,m as V}from"./index-BJDVYPr2.js";import{u as B,F as O,a as o,b as l,c,d,e as m,f as p,z as a,t as U}from"./form-Bn3qej8w.js";import{I as u}from"./input-C744jVRX.js";import{S as H,a as Y,b as M,c as z,d as y}from"./select-Bh-crIyN.js";import"./label-DKKVfa8V.js";import"./index-ZMpGrT0S.js";import"./index-pLghM4Oe.js";import"./chevron-down-JR_7gpC-.js";import"./check-CPyQFfyd.js";const J=a.object({username:a.string().min(3,"Username must be at least 3 characters"),password:a.string().min(6,"Password must be at least 6 characters")}),W=a.object({username:a.string().min(3,"Username must be at least 3 characters"),email:a.string().email("Invalid email address"),password:a.string().min(6,"Password must be at least 6 characters"),name:a.string().min(2,"Name must be at least 2 characters"),role:a.enum(["client","therapist"]),therapistId:a.number().optional()});function q({mode:r}){const{login:x,register:F}=C(),[w,b]=I.useState(!1),{toast:S}=k(),j=new URLSearchParams(window.location.search),g=j.get("email"),h=j.get("therapistId"),v=j.get("token"),t=j.get("invitation")==="true"||!!g||!!v;console.log("ðŸ” Invitation Detection:",{url:window.location.search,invitationEmail:g,therapistId:h,invitationToken:v,isInvitation:t,mode:r});const n=B({resolver:U(r==="login"?J:W),defaultValues:r==="login"?{username:"",password:""}:{username:"",email:g||"",password:"",name:"",role:"client",therapistId:h?parseInt(h):void 0}}),L=async s=>{b(!0);try{if(r==="login")await x(s.username,s.password);else{const i=s;t&&(i.role="client",i.therapistId=h?parseInt(h):void 0,console.log("FORCED INVITATION ROLE:",i.role,"therapistId:",i.therapistId)),await F(i)}}catch(i){console.error(i),S({title:"Error",description:i.message||"An error occurred. Please try again.",variant:"destructive"})}finally{b(!1)}};return e.jsxs(E,{className:"w-full max-w-md mx-auto",children:[e.jsxs(R,{children:[e.jsx(T,{children:r==="login"?"Log In":t?"Complete Your Registration":"Create Account"}),e.jsx(A,{children:r==="login"?"Enter your credentials to access your account":t?"You've been invited to join as a client. Please complete your registration below.":"Fill out the form below to create your account"})]}),e.jsx(D,{children:e.jsx(O,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(L),className:"space-y-4",children:[e.jsx(o,{control:n.control,name:"username",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Username"}),e.jsx(d,{children:e.jsx(u,{placeholder:"johndoe",...s})}),e.jsx(m,{})]})}),r==="register"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{control:n.control,name:"email",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Email"}),e.jsx(d,{children:e.jsx(u,{type:"email",placeholder:"john.doe@example.com",...s,disabled:t,className:t?"bg-muted":""})}),t&&e.jsx(p,{children:"This email is from your invitation link"}),e.jsx(m,{})]})}),e.jsx(o,{control:n.control,name:"name",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Full Name"}),e.jsx(d,{children:e.jsx(u,{placeholder:"John Doe",...s})}),e.jsx(m,{})]})}),!t&&e.jsx(o,{control:n.control,name:"role",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Role"}),e.jsxs(H,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(d,{children:e.jsx(Y,{children:e.jsx(M,{placeholder:"Select your role"})})}),e.jsxs(z,{children:[e.jsx(y,{value:"client",children:"Client"}),e.jsx(y,{value:"therapist",children:"Therapist"})]})]}),e.jsx(p,{children:"Choose your role in the system"}),e.jsx(m,{})]})}),t&&e.jsx(o,{control:n.control,name:"role",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Role"}),e.jsx(d,{children:e.jsx(u,{...s,value:"Client",disabled:!0,className:"bg-gray-100 text-gray-500 cursor-not-allowed",readOnly:!0})}),e.jsx(p,{children:"You're registering as a client through a therapist invitation"}),e.jsx(m,{})]})})]}),e.jsx(o,{control:n.control,name:"password",render:({field:s})=>e.jsxs(l,{children:[e.jsx(c,{children:"Password"}),e.jsx(d,{children:e.jsx(u,{type:"password",placeholder:"â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢",...s})}),e.jsx(m,{})]})}),e.jsx(N,{type:"submit",className:"w-full",disabled:w,children:w?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx("span",{className:"animate-spin mr-2 h-4 w-4 border-t-2 border-b-2 border-white rounded-full"}),r==="login"?"Logging in...":"Creating account..."]}):e.jsx(e.Fragment,{children:r==="login"?"Log In":"Create Account"})})]})})}),e.jsx(P,{className:"flex justify-center",children:r==="login"?e.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",e.jsx(f,{href:"/register",className:"text-primary hover:underline",children:"Sign up"})]}):e.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",e.jsx(f,{href:"/login",className:"text-primary hover:underline",children:"Log in"})]})})]})}function te(){const{user:r}=C(),[,x]=V();return I.useEffect(()=>{r&&x("/")},[r,x]),e.jsx("div",{className:"min-h-screen flex flex-col items-center justify-center bg-background p-4",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsx("div",{className:"flex justify-center mb-6",children:e.jsx(N,{asChild:!0,variant:"ghost",className:"flex items-center gap-2 text-muted-foreground",children:e.jsxs(f,{href:"/",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"mr-1",children:[e.jsx("path",{d:"m12 19-7-7 7-7"}),e.jsx("path",{d:"M19 12H5"})]}),"Back to Home"]})})}),e.jsx(q,{mode:"register"})]})})}export{te as default};
