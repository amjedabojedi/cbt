import{c as x,j as e,L as H,u as O,k as R,r as c,C as q,e as B,f as Y,g as G,a as U,A as W,o as Z,p as _,T as b,t as C,v as k,w as E,l as K,B as P,i as F}from"./index-BJDVYPr2.js";import{A as Q}from"./arrow-left-CJqe-HNu.js";import{A as X}from"./AppLayout-B4pR-pjA.js";import{S,a as D,b as T,c as A,d as r}from"./select-Bh-crIyN.js";import{L as M}from"./label-DKKVfa8V.js";import{I as f}from"./info-PLI2XuV7.js";import{F as ee}from"./file-text-CB9D2AC_.js";import"./Header-HmO9KIvP.js";import"./target-7abParum.js";import"./index-ZMpGrT0S.js";import"./index-epKMAjhH.js";import"./check-CPyQFfyd.js";import"./index-pLghM4Oe.js";import"./chevron-down-JR_7gpC-.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const j=x("CloudDownload",[["path",{d:"M12 13v8l-4-4",key:"1f5nwf"}],["path",{d:"m12 21 4-4",key:"1lfcce"}],["path",{d:"M4.393 15.269A7 7 0 1 1 15.71 8h1.79a4.5 4.5 0 0 1 2.436 8.284",key:"ui1hmy"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const se=x("FileJson",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 12a1 1 0 0 0-1 1v1a1 1 0 0 1-1 1 1 1 0 0 1 1 1v1a1 1 0 0 0 1 1",key:"1oajmo"}],["path",{d:"M14 18a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1 1 1 0 0 1-1-1v-1a1 1 0 0 0-1-1",key:"mpwhp6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const te=x("FileSpreadsheet",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M8 13h2",key:"yr2amv"}],["path",{d:"M14 13h2",key:"un5t4a"}],["path",{d:"M8 17h2",key:"2yhykz"}],["path",{d:"M14 17h2",key:"10kma7"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ae=x("Printer",[["path",{d:"M6 18H4a2 2 0 0 1-2-2v-5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2v5a2 2 0 0 1-2 2h-2",key:"143wyd"}],["path",{d:"M6 9V3a1 1 0 0 1 1-1h10a1 1 0 0 1 1 1v6",key:"1itne7"}],["rect",{x:"6",y:"14",width:"12",height:"8",rx:"1",key:"1ue0tg"}]]);function re({heading:o,subheading:t,icon:l,actions:i,backLink:n}){return e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col",children:[n&&e.jsxs(H,{to:n.to,className:"flex items-center text-muted-foreground hover:text-primary mb-2 text-sm",children:[e.jsx(Q,{className:"w-4 h-4 mr-1"}),n.label]}),e.jsxs("div",{className:"flex items-center",children:[l&&e.jsx("div",{className:"mr-3",children:l}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl sm:text-3xl font-bold tracking-tight",children:o}),t&&e.jsx("p",{className:"text-muted-foreground",children:t})]})]})]}),i&&e.jsx("div",{className:"flex flex-wrap gap-2 ml-auto",children:i})]})}function le(){const o="/api",{user:t}=O(),{viewingClientId:l,viewingClientName:i,isViewingClient:n}=R(),[d,V]=c.useState("all"),[m,I]=c.useState("json"),[y,g]=c.useState(!1),[v,w]=c.useState(!1),[N,h]=c.useState(null),p=((t==null?void 0:t.role)==="therapist"||(t==null?void 0:t.role)==="admin")&&n,z=async()=>{try{g(!0),h(null);let s=`${o}/export`;m==="csv"?s=`${o}/export/csv`:m==="pdf"&&(s=`${o}/export/pdf`),s+=`?type=${d}`,p&&l&&(s+=`&clientId=${l}`);const a=document.createElement("a");a.href=s,a.setAttribute("download",""),document.body.appendChild(a),a.click(),document.body.removeChild(a)}catch(s){console.error("Export error:",s),h("Failed to export data. Please try again later.")}finally{g(!1)}},$=async()=>{try{w(!0),h(null);let s=`${o}/export/html`;s+=`?type=${d}`,p&&l&&(s+=`&clientId=${l}`);const a=await fetch(s);if(!a.ok)throw new Error("Failed to fetch printable data");const L=await a.text(),u=window.open("","_blank");if(!u)throw new Error("Pop-up blocked. Please allow pop-ups and try again.");u.document.write(`
        <!DOCTYPE html>
        <html>
          <head>
            <title>CBT Export - ${d}</title>
            <style>
              body { font-family: Arial, sans-serif; margin: 40px; }
              h1, h2 { color: #333; }
              table { border-collapse: collapse; width: 100%; margin: 20px 0; }
              th, td { padding: 8px; text-align: left; border-bottom: 1px solid #ddd; }
              th { background-color: #f2f2f2; }
              .print-only { display: none; }
              @media print {
                .no-print { display: none; }
                .print-only { display: block; }
                body { margin: 0; padding: 20px; }
              }
            </style>
          </head>
          <body>
            <div class="no-print" style="background: #f2f2f2; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
              <h3>Print Instructions</h3>
              <p>To save as PDF: Use your browser's Print feature (Ctrl+P or Cmd+P) and select "Save as PDF" as the destination.</p>
              <p>This method avoids antivirus concerns with downloaded PDF files.</p>
              <button onclick="window.print();" style="background: #4F46E5; color: white; border: none; padding: 10px 15px; border-radius: 5px; cursor: pointer;">
                Print / Save as PDF
              </button>
            </div>
            ${L}
          </body>
        </html>
      `),u.document.close()}catch(s){console.error("Printable PDF error:",s),h("Failed to generate printable view. Please try again or use CSV export.")}finally{w(!1)}},J=s=>{switch(s){case"emotions":return"Emotion Records";case"thoughts":return"Thought Records";case"journals":return"Journal Entries";case"goals":return"Goals";case"all":return"All Data";default:return s}};return e.jsxs(q,{className:"w-full shadow-md",children:[e.jsxs(B,{children:[e.jsxs(Y,{className:"flex items-center",children:[e.jsx(j,{className:"mr-2",size:20}),"Export Data"]}),e.jsxs(G,{children:["Download your data in your preferred format",p&&i&&e.jsxs("span",{className:"font-medium text-primary",children:[" for client: ",i]})]})]}),e.jsxs(U,{className:"space-y-4",children:[N&&e.jsxs(W,{variant:"destructive",className:"mb-4",children:[e.jsx(Z,{children:"Export Failed"}),e.jsx(_,{children:N})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"export-type",className:"flex items-center",children:["Data Type",e.jsx(b,{children:e.jsxs(C,{children:[e.jsx(k,{asChild:!0,children:e.jsx(f,{size:16,className:"ml-1 text-muted-foreground"})}),e.jsx(E,{children:e.jsx("div",{children:"Select what kind of data you want to export"})})]})})]}),e.jsxs(S,{value:d,onValueChange:V,children:[e.jsx(D,{id:"export-type",children:e.jsx(T,{placeholder:"Select data to export"})}),e.jsxs(A,{children:[e.jsx(r,{value:"all",children:"All Data"}),e.jsx(r,{value:"emotions",children:"Emotion Records"}),e.jsx(r,{value:"thoughts",children:"Thought Records"}),e.jsx(r,{value:"journals",children:"Journal Entries"}),e.jsx(r,{value:"goals",children:"Goals"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(M,{htmlFor:"export-format",className:"flex items-center",children:["Export Format",e.jsx(b,{children:e.jsxs(C,{children:[e.jsx(k,{asChild:!0,children:e.jsx(f,{size:16,className:"ml-1 text-muted-foreground"})}),e.jsx(E,{children:e.jsx("div",{children:"JSON contains complete data for technical use. CSV works with spreadsheets like Excel. PDF creates a nicely formatted document you can print or share."})})]})})]}),e.jsxs(S,{value:m,onValueChange:I,children:[e.jsx(D,{id:"export-format",children:e.jsx(T,{placeholder:"Select export format"})}),e.jsxs(A,{children:[e.jsx(r,{value:"json",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(se,{className:"mr-2",size:16}),"JSON (Complete Data)"]})}),e.jsx(r,{value:"csv",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(te,{className:"mr-2",size:16}),"CSV (Spreadsheet)"]})}),e.jsx(r,{value:"pdf",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(ee,{className:"mr-2",size:16}),"PDF (Document)"]})})]})]}),m==="pdf"&&e.jsxs("div",{className:"text-xs text-amber-600 mt-1 flex items-center",children:[e.jsx(f,{size:12,className:"mr-1"}),"Note: If your antivirus blocks PDF downloads, please use CSV format instead."]})]})]}),e.jsxs(K,{className:"flex flex-col space-y-2",children:[e.jsx(P,{onClick:z,disabled:y,className:"w-full",children:y?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(j,{className:"mr-2 h-4 w-4"}),"Export ",J(d)]})}),e.jsx("div",{className:"w-full text-center mt-2",children:e.jsx(P,{onClick:$,disabled:v,variant:"outline",className:"w-full",children:v?e.jsxs(e.Fragment,{children:[e.jsx(F,{className:"mr-2 h-4 w-4 animate-spin"}),"Preparing Print View..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ae,{className:"mr-2 h-4 w-4"}),"Print-friendly PDF (Avoids Antivirus Issues)"]})})})]})]})}function ve(){return e.jsx(X,{children:e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx(re,{heading:"Export Your Data",subheading:"Download your records for backup or analysis",icon:e.jsx(j,{size:30,className:"text-primary"})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:"Data Export Options"}),e.jsx("p",{className:"text-muted-foreground",children:"Choose what data you want to export and in which format. Your data belongs to you, and you can download it at any time."}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"About the export formats:"}),e.jsxs("ul",{className:"list-disc pl-5 space-y-2",children:[e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"JSON"}),": Contains all data fields, best for complete backups or technical use."]}),e.jsxs("li",{children:[e.jsx("span",{className:"font-medium",children:"CSV"}),": Simpler format that works with spreadsheet programs like Excel or Google Sheets. Some complex data might be simplified."]})]})]}),e.jsxs("div",{className:"bg-muted p-4 rounded-lg",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Privacy Note:"}),e.jsx("p",{children:"Your data is downloaded directly to your device and is not shared with any third parties during this process."})]})]}),e.jsx("div",{children:e.jsx(le,{})})]})]})})}export{ve as default};
