import{u as be,n as Ie,m as ye,r as D,j as e,C as v,e as w,f as k,g as E,B as I,X as ie,a as N,x as Ae,h as De,D as Ee}from"./index-BJDVYPr2.js";import{u as q}from"./useQuery-CVl6tFXz.js";import{A as Me}from"./AppLayout-B4pR-pjA.js";import{B as ze,M as Fe}from"./BackToClientsButton-_c3Gvoq3.js";import{T as Pe,a as re}from"./ThoughtRecordsList-ZYmEA12P.js";import{u as Be,F as Le,z as L,t as We,a as X,b as oe,c as le,f as ce,e as de,d as $e}from"./form-Bn3qej8w.js";import{u as ve,C as Oe}from"./use-active-user-CkIppDip.js";import{D as _e,a as qe,c as Ke,d as Ve}from"./dialog-BkbRhY2O.js";import{S as Ye,a as Ue,b as He,c as Ge,d as Z}from"./select-Bh-crIyN.js";import{T as he}from"./textarea-8UmQ7iuL.js";import{P as Je}from"./progress-XD4z056s.js";import{a as Qe,B as ee}from"./Header-HmO9KIvP.js";import{C as Xe}from"./checkbox-CpzJVwUi.js";import{L as Ze}from"./label-DKKVfa8V.js";import{B as K,T as et}from"./target-7abParum.js";import{C as tt}from"./chevron-left-DkowiYxd.js";import{C as te}from"./circle-check-CkKaz49B.js";import{S as me}from"./sparkles-aDL3aOOp.js";import{I as U}from"./info-PLI2XuV7.js";import{f as T,a as ue}from"./format-CrnBQ42y.js";import{C as st}from"./ClientDebug-BYZqnShq.js";import{T as Ne,a as we,b as W,c as se}from"./tabs-DZkkmdmK.js";import{A as at,a as nt,b as it,c as rt}from"./accordion-C_vhZxL6.js";import{R as $,o as H,X as G,Y as J,T as O,B as ge,q as _,p as ot}from"./generateCategoricalChart-CFBGWCRH.js";import{B as xe}from"./BarChart-BD1_1xzo.js";import{P as lt,a as ct}from"./PieChart-PYX3tuHq.js";import{T as ae}from"./trending-up-CZSEG5Sb.js";import{a as dt,Z as ht,S as mt}from"./ScatterChart-CuiXXHR4.js";import{a as ut,L as pe,s as gt}from"./LineChart-D-Uu3kL0.js";import{e as je}from"./endOfWeek-Pim0fGCe.js";import{e as xt}from"./eachDayOfInterval-D7CfGF_P.js";import{C as pt}from"./clipboard-list-BPeYjCxY.js";import"./utils-km2FGkQ4.js";import"./useMutation-4_CoT2bx.js";import"./use-refresh-data-Dq9XIZaR.js";import"./alert-dialog-bBvWK-5Q.js";import"./slider-BHLSMB0K.js";import"./index-ZMpGrT0S.js";import"./index-pLghM4Oe.js";import"./calendar-Ck4F2mgv.js";import"./circle-check-big-D7NcmSYY.js";import"./circle-x-B6rDCGfP.js";import"./book-text-_2JTahF7.js";import"./eye-D3NTB46B.js";import"./square-pen-BwPwTV1q.js";import"./trash-2-ZtlY59XR.js";import"./book-DG6mmprG.js";import"./brain-circuit-ClF974iG.js";import"./triangle-alert-B6ZFxm6X.js";import"./message-square-BUQziOr0.js";import"./chevron-down-JR_7gpC-.js";import"./check-CPyQFfyd.js";import"./index-epKMAjhH.js";import"./en-US-9SRVm7yB.js";const jt=[{value:"all_or_nothing",label:"All or Nothing Thinking",description:"Things are either right or wrong, good or bad. Can lead people to give up at the first small sign of failure.",examples:["I failed this test. I am stupid so I am giving up","Either we do it like this or not at all"]},{value:"mental_filter",label:"Mental Filter",description:"Seeing the world through a 'filter' which only lets you see the negative without recognising the positive.",examples:["I only came second in the exam. I should have come first","I have got more responsibilities so this will mean more work and longer hours"]},{value:"mind_reading",label:"Mind Reading",description:"Presuming we know what other people are thinking without looking at the evidence.",examples:["Sarah didn't say hello. She must be mad with me"]},{value:"fortune_telling",label:"Fortune Telling",description:"Predicting the future and having negative expectations about what will happen.",examples:["What's the point? I know I am going to do badly in this interview","I am never going to lose weight so I may as well eat this cream cake"]},{value:"labelling",label:"Labelling",description:"Giving negative labels to ourselves or other people.",examples:["I'm a loser. I am useless","They are all idiots"]},{value:"over_generalising",label:"Over-Generalising",description:"Using words like 'always', 'never', 'nothing', 'every time'. If something bad happens once, you expect it to happen again and again.",examples:["I am always bad at that","Nothing good ever happens"]},{value:"compare_despair",label:"Compare and Despair",description:"Comparing yourself unfavourably to others.",examples:["I am so disorganised I will never be able to juggle things like Jane","Why can't I go on expensive holidays like Laura?"]},{value:"emotional_thinking",label:"Emotional Thinking",description:"Thinking that the way we feel about something must make it true.",examples:["I feel like a failure so I must be","I feel anxious about the presentation so I know it's going to go badly"]},{value:"guilty_thinking",label:"Guilty Thinking",description:"Using words like 'should', 'must', 'have to' and 'ought to' can allow guilt to build up.",examples:["I must clean the house today","I should have done that already","I ought to have known that was wrong"]},{value:"catastrophising",label:"Catastrophising",description:"Thinking an unlikely disaster is going to happen or attaching too much importance to a negative experience.",examples:["I have sent the wrong contract out. I am going to lose my job","I think I left my hair straighteners on. The house is going to burn down"]},{value:"blaming_others",label:"Blaming Others",description:"Thinking others are always to blame for things that have gone wrong without taking responsibility.",examples:["I would have got that promotion if it wasn't for her"]},{value:"personalising",label:"Personalising",description:"Blaming yourself for something that wasn't entirely your fault or thinking that something somebody says is a reaction to you.",examples:["It's my fault we all missed the train","Paul is in a bad mood today. It must be something I said to him"]}],ft=L.object({automaticThought:L.string().min(10,"Please provide more detail (minimum 10 characters)"),thoughtCategory:L.array(L.string()).min(1,"Please select at least one category"),situation:L.string().min(10,"Please describe the situation (minimum 10 characters)"),emotionRecordId:L.number().optional().nullable()});function bt({onClose:o,preselectedEmotionId:f}){be();const{activeUserId:m}=ve(),{toast:d}=Ie();ye();const[u,P]=D.useState(1),[B,b]=D.useState(!1),[A,C]=D.useState(!1),[M,z]=D.useState(null),[S,F]=D.useState(!1),g=5,a=u/g*100,{data:n}=q({queryKey:m?[`/api/users/${m}/emotions`]:[],enabled:!!m}),s=(n==null?void 0:n.slice(0,10))||[],t=Be({resolver:We(ft),mode:"onChange",defaultValues:{automaticThought:"",thoughtCategory:[],situation:"",emotionRecordId:f||null}}),l=t.watch(),h=async r=>{if(m&&!(u<g)){F(!0);try{const j=await(await De("POST",`/api/users/${m}/thoughts`,{userId:m,automaticThoughts:r.automaticThought,thoughtCategory:r.thoughtCategory,situation:r.situation,emotionRecordId:r.emotionRecordId||null,cognitiveDistortions:[],evidenceFor:null,evidenceAgainst:null,alternativePerspective:null,insightsGained:null,reflectionRating:null})).json();z(j),await Ee.invalidateQueries({queryKey:[`/api/users/${m}/thoughts`]}),b(!0),d({title:"Success!",description:"Your thought has been recorded."})}catch(y){console.error("Error recording thought:",y),d({title:"Error",description:"Failed to record thought. Please try again.",variant:"destructive"})}finally{F(!1)}}},i=async()=>{let r=[];u===1?r=["automaticThought"]:u===2||(u===3?r=["thoughtCategory"]:u===4&&(r=["situation"])),await t.trigger(r)&&P(u+1)},c=()=>{P(u-1)},x=()=>{t.reset({automaticThought:"",thoughtCategory:[],situation:"",emotionRecordId:null}),P(1),b(!1),z(null)},p=s.find(r=>r.id===t.watch("emotionRecordId")),R=()=>e.jsxs("div",{className:"space-y-6","data-testid":"step-write-thought",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-md",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(U,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-1",children:"ðŸ’¡ Why This Step?"}),e.jsx("p",{className:"text-sm text-blue-800",children:`The first step is simply capturing what went through your mind. Don't worry about getting it "right" - just write what you were thinking.`})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-base font-semibold flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5"}),"What thought went through your mind? ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Write down the exact thought that popped into your head. Be as specific as possible."}),e.jsx(he,{placeholder:"e.g., I'm going to embarrass myself in front of everyone...",className:"resize-none w-full min-h-[120px] text-base",rows:5,value:l.automaticThought||"",onChange:r=>{t.setValue("automaticThought",r.target.value,{shouldValidate:!0})},"data-testid":"textarea-thought"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.formState.errors.automaticThought&&e.jsx("p",{className:"text-red-500 text-sm",children:t.formState.errors.automaticThought.message}),e.jsxs("span",{className:`${(l.automaticThought||"").length<10?"text-red-500":"text-green-600"}`,children:[(l.automaticThought||"").length,"/10 characters minimum"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Examples of Common Thoughts:"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-700",children:[e.jsx("li",{children:`â€¢ "I'm not good enough"`}),e.jsx("li",{children:'â€¢ "Everyone will judge me"'}),e.jsx("li",{children:`â€¢ "I'll never succeed"`}),e.jsx("li",{children:'â€¢ "This is going to be a disaster"'}),e.jsx("li",{children:'â€¢ "I always mess things up"'})]})]})]}),V=()=>e.jsxs("div",{className:"space-y-6","data-testid":"step-learn-automatic-thoughts",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 border-2 border-purple-200 p-6 rounded-lg",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(me,{className:"h-8 w-8 text-purple-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-purple-900 mb-3",children:'What Are "Automatic Thoughts"?'}),e.jsxs("p",{className:"text-base text-gray-800 mb-3",children:["The thought you just wrote is called an ",e.jsx("strong",{children:"automatic thought"})," in therapy. These are the immediate thoughts that pop into your mind in response to a situation - often so quick you barely notice them!"]}),e.jsx("p",{className:"text-base text-gray-800 mb-3",children:"Automatic thoughts can be:"}),e.jsxs("ul",{className:"text-base text-gray-800 space-y-2 ml-4",children:[e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Lightning fast"})," - They happen in a split second"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Believable"})," - They feel like absolute truth"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Powerful"})," - They strongly affect how you feel"]}),e.jsxs("li",{children:["â€¢ ",e.jsx("strong",{children:"Sometimes unhelpful"})," - They can be inaccurate or exaggerated"]})]}),e.jsxs("p",{className:"text-base text-gray-800 mt-4",children:[e.jsx("strong",{children:"The good news:"})," Once you notice these thoughts, you can question them and develop more balanced perspectives. That's what CBT (Cognitive Behavioral Therapy) is all about!"]})]})]})}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Why this matters:"}),e.jsx("p",{className:"text-sm text-gray-700",children:"By learning to recognize automatic thoughts, you're taking the first step toward understanding and improving your mental well-being. You're building awareness!"})]})]}),ke=()=>e.jsxs("div",{className:"space-y-6","data-testid":"step-categorize-thought",children:[e.jsx("div",{className:"bg-blue-50 border-l-4 border-blue-500 p-4 rounded-r-md",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(U,{className:"h-5 w-5 text-blue-500 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-blue-900 mb-2",children:"ðŸ’¡ What Are Automatic Thoughts?"}),e.jsx("p",{className:"text-sm text-blue-800 mb-2",children:`Automatic thoughts are the immediate thoughts that pop into your mind in response to a situation. They're called "automatic" because they happen so quickly you barely notice them. Sometimes these thoughts are unhelpful and can be called ANTs (Automatic Negative Thoughts).`}),e.jsxs("p",{className:"text-sm text-blue-800 mb-2",children:[e.jsx("strong",{children:"Why categorize them?"})," Recognizing which type of unhelpful thinking pattern your thought follows helps you understand your patterns over time. Once you can spot these patterns, you can challenge them and develop more balanced ways of thinking."]}),e.jsx("p",{className:"text-sm text-blue-800",children:"Below are common types of unhelpful thinking styles. Read each definition and example, then select which ones match your thought. Your thought might fit into more than one category."})]})]})}),e.jsxs("div",{className:"bg-purple-50 border border-purple-200 p-4 rounded-md",children:[e.jsx("p",{className:"text-sm font-medium text-purple-900 mb-2",children:"Your automatic thought:"}),e.jsxs("p",{className:"text-sm italic text-gray-700",children:['"',l.automaticThought,'"']})]}),e.jsx(X,{control:t.control,name:"thoughtCategory",render:()=>e.jsxs(oe,{children:[e.jsxs(le,{className:"text-base font-semibold",children:["Read each definition and example, then select which ones match your thought ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx(ce,{children:"Your thought might fit multiple categories - select all that apply"}),e.jsx("div",{className:"space-y-3 mt-3",children:jt.map(r=>e.jsx(X,{control:t.control,name:"thoughtCategory",render:({field:y})=>{var j,ne;return e.jsx("div",{className:`group relative p-5 rounded-xl border-2 transition-all duration-200 cursor-pointer ${(j=y.value)!=null&&j.includes(r.value)?"border-blue-500 bg-blue-50 shadow-md":"border-gray-200 bg-white hover:border-blue-300 hover:shadow-sm"}`,children:e.jsxs("div",{className:"flex items-start space-x-4",children:[e.jsx(Xe,{checked:(ne=y.value)==null?void 0:ne.includes(r.value),onCheckedChange:Q=>{var Y;return Q?y.onChange([...y.value,r.value]):y.onChange((Y=y.value)==null?void 0:Y.filter(Re=>Re!==r.value))},"data-testid":`checkbox-${r.value}`,className:"mt-1"}),e.jsxs("div",{className:"flex-1",children:[e.jsx(Ze,{className:"text-base font-bold text-gray-900 cursor-pointer block mb-2",children:r.label}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed mb-3",children:r.description}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 border border-gray-100",children:[e.jsx("p",{className:"text-xs font-semibold text-gray-600 uppercase tracking-wide mb-2",children:"Examples:"}),e.jsx("div",{className:"space-y-1.5",children:r.examples.map((Q,Y)=>e.jsxs("div",{className:"flex items-start",children:[e.jsx("span",{className:"text-blue-500 mr-2 mt-0.5",children:"â€¢"}),e.jsxs("p",{className:"text-sm text-gray-600 italic flex-1",children:['"',Q,'"']})]},Y))})]})]})]})})}},r.value))}),e.jsx(de,{})]})})]}),Te=()=>e.jsxs("div",{className:"space-y-6","data-testid":"step-describe-situation",children:[e.jsx("div",{className:"bg-amber-50 border-l-4 border-amber-500 p-4 rounded-r-md",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(U,{className:"h-5 w-5 text-amber-500 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-amber-900 mb-1",children:"ðŸ’¡ Why Describe the Situation?"}),e.jsx("p",{className:"text-sm text-amber-800",children:"Understanding the context helps you identify triggers and patterns. What was happening when you had this thought?"})]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-base font-semibold",children:["What was happening when you had this thought? ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Describe the situation objectively - who, what, when, where, why"}),e.jsx(he,{placeholder:"e.g., I was preparing for my presentation tomorrow and my manager asked to review my slides...",className:"resize-none w-full min-h-[120px] text-base",rows:5,value:l.situation||"",onChange:r=>{t.setValue("situation",r.target.value,{shouldValidate:!0})},"data-testid":"textarea-situation"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[t.formState.errors.situation&&e.jsx("p",{className:"text-red-500 text-sm",children:t.formState.errors.situation.message}),e.jsxs("span",{className:`${(l.situation||"").length<10?"text-red-500":"text-green-600"}`,children:[(l.situation||"").length,"/10 characters minimum"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[e.jsx("h4",{className:"font-medium mb-2",children:"Tips for Describing Situations:"}),e.jsxs("ul",{className:"text-sm space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ Stick to observable facts, not interpretations"}),e.jsx("li",{children:"â€¢ Include who was there, what was said/done"}),e.jsx("li",{children:"â€¢ Note the time and place if relevant"}),e.jsx("li",{children:'â€¢ Avoid judgment words like "terrible" or "unfair"'})]})]})]}),Ce=()=>e.jsxs("div",{className:"space-y-6","data-testid":"step-link-emotion",children:[e.jsx("div",{className:"bg-purple-50 border-l-4 border-purple-500 p-4 rounded-r-md",children:e.jsxs("div",{className:"flex items-start",children:[e.jsx(U,{className:"h-5 w-5 text-purple-500 mt-0.5 mr-3 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-semibold text-purple-900 mb-1",children:"ðŸ’¡ Why Link to an Emotion?"}),e.jsxs("p",{className:"text-sm text-purple-800",children:["Connecting your thought to a specific emotion you tracked helps you see patterns between what you think and how you feel. This is ",e.jsx("strong",{children:"optional"})," but can provide valuable insights."]})]})]})}),e.jsx(X,{control:t.control,name:"emotionRecordId",render:({field:r})=>{var y;return e.jsxs(oe,{children:[e.jsx(le,{className:"text-base font-semibold",children:"Link to a Recent Emotion (Optional)"}),e.jsx(ce,{children:"Select an emotion you tracked recently, or skip this step"}),e.jsxs(Ye,{value:((y=r.value)==null?void 0:y.toString())||"none",onValueChange:j=>{r.onChange(j==="none"?null:parseInt(j))},children:[e.jsx($e,{children:e.jsx(Ue,{"data-testid":"select-emotion-link",children:e.jsx(He,{placeholder:"No emotion linked"})})}),e.jsxs(Ge,{children:[e.jsx(Z,{value:"none",children:"No emotion linked"}),s.map(j=>e.jsx(Z,{value:j.id.toString(),children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{children:j.primaryEmotion||j.coreEmotion}),j.tertiaryEmotion&&e.jsxs("span",{className:"text-gray-500",children:["(",j.tertiaryEmotion,")"]}),e.jsxs("span",{className:"text-xs text-gray-400",children:["- ",T(new Date(j.timestamp),"MMM d, h:mm a")]})]})},j.id)),s.length===0&&e.jsx(Z,{value:"none",disabled:!0,children:"No recent emotions tracked"})]})]}),e.jsx(de,{})]})}}),p&&e.jsxs("div",{className:"bg-green-50 border border-green-200 p-4 rounded-md",children:[e.jsxs("h4",{className:"font-medium mb-2 flex items-center gap-2",children:[e.jsx(te,{className:"h-5 w-5 text-green-600"}),"Linked Emotion"]}),e.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[e.jsx(ee,{variant:"secondary",className:"text-sm",children:p.coreEmotion}),p.primaryEmotion&&e.jsx(ee,{variant:"outline",className:"text-sm",children:p.primaryEmotion}),p.tertiaryEmotion&&e.jsx(ee,{variant:"outline",className:"text-sm",children:p.tertiaryEmotion}),e.jsxs("span",{className:"text-sm text-gray-600",children:["Intensity: ",p.intensity,"/10"]})]}),p.situation&&e.jsxs("p",{className:"text-sm text-gray-700 mt-2",children:[e.jsx("strong",{children:"Situation:"})," ",p.situation]})]})]}),Se=()=>{switch(u){case 1:return R();case 2:return V();case 3:return ke();case 4:return Te();case 5:return Ce();default:return null}};return e.jsxs(e.Fragment,{children:[e.jsxs(v,{className:"max-w-3xl mx-auto",children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(k,{className:"text-2xl font-bold flex items-center gap-2",children:[e.jsx(K,{className:"h-7 w-7 text-primary"}),"Record a Thought"]}),e.jsx(E,{children:"Capture and understand your thoughts"})]}),e.jsx(I,{variant:"ghost",size:"sm",onClick:o,"data-testid":"button-close-wizard",children:e.jsx(ie,{className:"h-4 w-4"})})]}),e.jsxs("div",{className:"space-y-2","data-testid":"progress-wizard",children:[e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[e.jsxs("span",{className:"font-medium",children:["Step ",u," of ",g]}),e.jsxs("span",{className:"text-gray-600",children:[Math.round(a),"% Complete"]})]}),e.jsx(Je,{value:a,className:"h-2"})]})]}),e.jsx(N,{children:e.jsx(Le,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(h),className:"space-y-6 pb-4",children:[Se(),e.jsxs("div",{className:"flex justify-between items-center pt-6 mt-6 border-t",children:[e.jsx("div",{children:u>1&&e.jsxs(I,{type:"button",variant:"outline",onClick:c,disabled:S,"data-testid":"button-previous-step",children:[e.jsx(tt,{className:"h-4 w-4 mr-2"}),"Previous"]})}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(I,{type:"button",variant:"ghost",onClick:o,disabled:S,children:"Cancel"}),u===g&&e.jsx(I,{type:"button",variant:"outline",onClick:()=>t.handleSubmit(h)(),disabled:S,"data-testid":"button-skip-emotion",children:"Skip & Record"}),u<g?e.jsxs(I,{type:"button",onClick:i,disabled:S,"data-testid":"button-next-step",children:["Next Step",e.jsx(Qe,{className:"h-4 w-4 ml-2"})]}):e.jsx(I,{type:"button",onClick:()=>t.handleSubmit(h)(),disabled:S,"data-testid":"button-submit-thought",children:S?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-white border-t-transparent animate-spin mr-2"}),"Recording..."]}):e.jsxs(e.Fragment,{children:[e.jsx(te,{className:"h-4 w-4 mr-2"}),"Record Thought"]})})]})]})]})})})]}),e.jsx(_e,{open:B,onOpenChange:b,children:e.jsxs(qe,{className:"max-w-md",children:[e.jsx(Ke,{className:"sr-only",children:"Thought Recorded Successfully"}),e.jsx(Ve,{className:"sr-only",children:"Your automatic thought has been saved"}),e.jsxs("div",{className:"text-center space-y-4 py-4",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"rounded-full bg-green-100 p-3",children:e.jsx(te,{className:"h-12 w-12 text-green-600"})})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Thought Recorded Successfully!"}),e.jsx("p",{className:"text-gray-600",children:"Great job capturing your automatic thought. What would you like to do next?"})]}),e.jsxs("div",{className:"flex flex-col gap-3 pt-4",children:[e.jsxs(I,{size:"lg",variant:"default",className:"flex items-center justify-center gap-2 h-12",onClick:()=>{b(!1),C(!0)},"data-testid":"button-challenge-thought",children:[e.jsx(me,{className:"h-5 w-5"}),"Challenge This Thought (Optional)"]}),e.jsxs(I,{size:"lg",variant:"outline",className:"flex items-center justify-center gap-2 h-12",onClick:()=>{x()},"data-testid":"button-record-another-thought",children:[e.jsx(Ae,{className:"h-5 w-5"}),"Record Another Thought"]}),e.jsxs(I,{size:"lg",variant:"outline",className:"flex items-center justify-center gap-2 h-12",onClick:()=>{b(!1),o()},"data-testid":"button-close-wizard",children:[e.jsx(ie,{className:"h-5 w-5"}),"Close"]})]})]})]})}),M&&e.jsx(Pe,{open:A,thoughtRecord:M,onComplete:()=>{C(!1),o()},onCancel:()=>{C(!1),o()}})]})}const fe=["#8884d8","#82ca9d","#ffc658","#ff7c7c","#a18dff","#ff9f9f","#6ec9c9","#ffb347","#c9a0dc","#99c9ff","#ffcc99","#b3d9ff"];function yt({userId:o}){const[f,m]=D.useState("month"),{data:d=[],isLoading:u}=q({queryKey:[`/api/users/${o}/thoughts`],enabled:!!o}),{data:P=[]}=q({queryKey:[`/api/users/${o}/emotions`],enabled:!!o}),B=a=>({all_or_nothing:"All or Nothing Thinking",overgeneralization:"Overgeneralization",mental_filter:"Mental Filter",disqualifying_positive:"Disqualifying the Positive",jumping_to_conclusions:"Jumping to Conclusions",magnification:"Magnification/Minimization",emotional_reasoning:"Emotional Reasoning",should_statements:"Should Statements",labeling:"Labeling",personalization:"Personalization",catastrophizing:"Catastrophizing",fortune_telling:"Fortune Telling"})[a]||a,b=()=>{const a={};return d.forEach(n=>{n.thoughtCategory&&Array.isArray(n.thoughtCategory)&&n.thoughtCategory.forEach(s=>{const t=B(s);a[t]=(a[t]||0)+1})}),Object.entries(a).map(([n,s])=>({name:n,count:s})).sort((n,s)=>s.count-n.count)},A=()=>{const a=d.filter(s=>s.evidenceFor||s.evidenceAgainst),n=d.filter(s=>!s.evidenceFor&&!s.evidenceAgainst);return[{name:"Challenged",value:a.length,percentage:d.length>0?Math.round(a.length/d.length*100):0},{name:"Not Challenged",value:n.length,percentage:d.length>0?Math.round(n.length/d.length*100):0}]},C=()=>{const a=d.filter(h=>h.alternativePerspective);if(a.length===0)return[];const n=a.reduce((h,i)=>h+(i.reflectionRating?(10-i.reflectionRating)*10:80),0),s=a.reduce((h,i)=>h+(i.reflectionRating||0)*10,0),t=Math.round(n/a.length),l=Math.round(s/a.length);return[{stage:"Before Challenge",belief:t},{stage:"After Challenge",belief:l}]},M=()=>{if(f==="week"){const a=new Date,n=ue(a,{weekStartsOn:1}),s=je(a,{weekStartsOn:1});return xt({start:n,end:s}).map(l=>{const h=T(l,"yyyy-MM-dd"),i=d.filter(x=>T(new Date(x.createdAt),"yyyy-MM-dd")===h),c=i.filter(x=>x.evidenceFor||x.evidenceAgainst).length;return{date:T(l,"EEE d"),total:i.length,challenged:c}})}else if(f==="month"){const n=ue(new Date,{weekStartsOn:1}),s=[];for(let t=3;t>=0;t--){const l=gt(n,t*7);s.push(l)}return s.map(t=>{const l=je(t,{weekStartsOn:1}),h=d.filter(R=>{const V=new Date(R.createdAt);return V>=t&&V<=l}),i=h.filter(R=>R.evidenceFor||R.evidenceAgainst).length,c=T(t,"MMM"),x=T(l,"MMM");return{date:c===x?`${c} ${T(t,"d")}-${T(l,"d")}`:`${c} ${T(t,"d")}-${x} ${T(l,"d")}`,total:h.length,challenged:i}})}else{const n=new Date().getFullYear(),s=[];for(let t=0;t<12;t++)s.push(new Date(n,t,1));return s.map(t=>{const l=T(t,"MMM"),h=new Date(t.getFullYear(),t.getMonth(),1),i=new Date(t.getFullYear(),t.getMonth()+1,0),c=d.filter(p=>{const R=new Date(p.createdAt);return R>=h&&R<=i}),x=c.filter(p=>p.evidenceFor||p.evidenceAgainst).length;return{date:l,total:c.length,challenged:x}})}},z=()=>{const a=new Map(P.map(s=>[s.id,s.coreEmotion])),n=new Map;return d.forEach(s=>{if(s.emotionRecordId&&s.thoughtCategory&&Array.isArray(s.thoughtCategory)){const t=a.get(s.emotionRecordId);t&&s.thoughtCategory.forEach(l=>{const h=B(l),i=`${h}|${t}`,c=n.get(i);c?c.count+=1:n.set(i,{distortion:h,emotion:t,count:1})})}}),Array.from(n.values())},S=()=>({allDistortions:["All or Nothing Thinking","Overgeneralization","Mental Filter","Disqualifying the Positive","Jumping to Conclusions","Magnification/Minimization","Emotional Reasoning","Should Statements","Labeling","Personalization","Catastrophizing","Fortune Telling"],allEmotions:["Joy","Sadness","Fear","Anger","Love","Surprise"]}),F=()=>{const a=d.filter(s=>s.evidenceFor||s.evidenceAgainst);if(a.length===0)return{avgReflectionRating:0,totalChallenged:0,challengeRate:0};const n=a.reduce((s,t)=>s+(t.reflectionRating||0),0)/a.length;return{avgReflectionRating:parseFloat(n.toFixed(1)),totalChallenged:a.length,challengeRate:parseFloat((a.length/d.length*100).toFixed(1))}};if(u)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"})});if(d.length===0)return e.jsx(v,{children:e.jsx(N,{className:"py-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No thought records yet. Start recording to see insights!"})})});const g=F();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs(v,{children:[e.jsx(w,{className:"pb-3",children:e.jsx(k,{className:"text-sm font-medium",children:"Challenge Rate"})}),e.jsxs(N,{children:[e.jsxs("div",{className:"text-2xl font-bold text-primary",children:[g.challengeRate,"%"]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:[g.totalChallenged," of ",d.length," thoughts challenged"]})]})]}),e.jsxs(v,{children:[e.jsx(w,{className:"pb-3",children:e.jsx(k,{className:"text-sm font-medium",children:"Avg Reflection Rating"})}),e.jsxs(N,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[g.avgReflectionRating,"/10"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Quality of challenged thoughts"})]})]}),e.jsxs(v,{children:[e.jsx(w,{className:"pb-3",children:e.jsx(k,{className:"text-sm font-medium",children:"Total ANTs Identified"})}),e.jsxs(N,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:b().reduce((a,n)=>a+n.count,0)}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Cognitive distortions recognized"})]})]})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5 text-primary"}),e.jsx(k,{children:"ANT Patterns (Cognitive Distortions)"})]}),e.jsx(E,{children:"Most common unhelpful thinking patterns you've identified"})]}),e.jsx(N,{children:e.jsx($,{width:"100%",height:400,children:e.jsxs(xe,{data:b(),children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"name",angle:-45,textAnchor:"end",height:120,interval:0,tick:{fontSize:12}}),e.jsx(J,{allowDecimals:!1}),e.jsx(O,{}),e.jsx(ge,{dataKey:"count",fill:"#8884d8",children:b().map((a,n)=>e.jsx(_,{fill:fe[n%fe.length]},`cell-${n}`))})]})})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(et,{className:"h-5 w-5 text-primary"}),e.jsx(k,{children:"Challenge Rate"})]}),e.jsx(E,{children:"Percentage of thoughts you've challenged"})]}),e.jsxs(N,{children:[e.jsx($,{width:"100%",height:300,children:e.jsxs(lt,{children:[e.jsxs(ct,{data:A(),cx:"50%",cy:"50%",labelLine:!1,label:({name:a,percentage:n})=>`${a}: ${n}%`,outerRadius:100,fill:"#8884d8",dataKey:"value",children:[e.jsx(_,{fill:"#82ca9d"}),e.jsx(_,{fill:"#e0e0e0"})]}),e.jsx(O,{formatter:(a,n,s)=>[a,`${s.payload.name} (${s.payload.percentage}%)`]})]})}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:d.length>0?`${A()[0].value} of ${d.length} thoughts challenged`:"No thoughts recorded yet"})})]})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-primary"}),e.jsx(k,{children:"Belief Shift"})]}),e.jsx(E,{children:"How challenging changes your belief in thoughts"})]}),e.jsx(N,{children:C().length>0?e.jsx($,{width:"100%",height:300,children:e.jsxs(xe,{data:C(),children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"stage"}),e.jsx(J,{domain:[0,100],label:{value:"Belief %",angle:-90,position:"insideLeft"},allowDecimals:!1}),e.jsx(O,{formatter:a=>[`${a}%`,"Belief"]}),e.jsxs(ge,{dataKey:"belief",fill:"#8884d8",children:[e.jsx(_,{fill:"#ff7c7c"}),e.jsx(_,{fill:"#82ca9d"})]})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:"Challenge thoughts to see belief shift"})})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5 text-primary"}),e.jsx(k,{children:"Distortion-Emotion Patterns"})]}),e.jsx(E,{children:"Which thinking patterns appear with which emotions"})]}),e.jsx(N,{children:(()=>{const a=z(),{allDistortions:n,allEmotions:s}=S();if(a.length===0)return e.jsx("div",{className:"flex items-center justify-center h-[400px] text-muted-foreground",children:"No distortion-emotion data yet"});const t=new Map(n.map((i,c)=>[i,c])),l=new Map(s.map((i,c)=>[i,c])),h=a.map(i=>({x:t.get(i.distortion),y:l.get(i.emotion),z:i.count*50,count:i.count,distortion:i.distortion,emotion:i.emotion}));return e.jsxs(e.Fragment,{children:[e.jsx($,{width:"100%",height:500,children:e.jsxs(dt,{margin:{top:20,right:20,bottom:120,left:100},children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(G,{type:"number",dataKey:"x",domain:[-.5,n.length-.5],ticks:Array.from({length:n.length},(i,c)=>c),tickFormatter:i=>n[i]||"",angle:-45,textAnchor:"end",height:120,interval:0,tick:{fontSize:10}}),e.jsx(J,{type:"number",dataKey:"y",domain:[-.5,s.length-.5],ticks:Array.from({length:s.length},(i,c)=>c),tickFormatter:i=>s[i]||"",width:90,interval:0,tick:{fontSize:12}}),e.jsx(ht,{type:"number",dataKey:"z",range:[50,400]}),e.jsx(O,{cursor:{strokeDasharray:"3 3"},content:({active:i,payload:c})=>{if(i&&c&&c.length){const x=c[0].payload;return e.jsxs("div",{className:"bg-white dark:bg-gray-800 p-3 border rounded shadow-lg",children:[e.jsx("p",{className:"font-semibold",children:x.distortion}),e.jsx("p",{className:"text-sm text-muted-foreground",children:x.emotion}),e.jsxs("p",{className:"text-sm font-bold mt-1",children:["Frequency: ",x.count]})]})}return null}}),e.jsx(mt,{data:h,fill:"#8884d8",fillOpacity:.6})]})}),e.jsxs("div",{className:"mt-4 text-sm text-muted-foreground text-center",children:[e.jsx("p",{children:"Bubble size represents how often that distortion-emotion combination occurs"}),e.jsx("p",{className:"mt-1",children:"Larger bubbles = more frequent pattern"})]})]})})()})]}),e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ae,{className:"h-5 w-5 text-primary"}),e.jsx(k,{children:"Progress Trends"})]}),e.jsx(Ne,{value:f,onValueChange:a=>m(a),className:"w-auto",children:e.jsxs(we,{children:[e.jsx(W,{value:"week",children:"Week"}),e.jsx(W,{value:"month",children:"Month"}),e.jsx(W,{value:"year",children:"Year"})]})})]}),e.jsx(E,{children:"Your thought challenging progress over time"})]}),e.jsx(N,{className:"overflow-visible",children:e.jsx($,{width:"100%",height:400,children:e.jsxs(ut,{data:M(),margin:{bottom:40},children:[e.jsx(H,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"date",tick:{fontSize:12},interval:0}),e.jsx(J,{allowDecimals:!1,label:{value:"Thought Count",angle:-90,position:"insideLeft"}}),e.jsx(O,{contentStyle:{backgroundColor:"rgba(255, 255, 255, 0.95)",border:"1px solid #ccc",borderRadius:"8px",padding:"12px"}}),e.jsx(ot,{wrapperStyle:{paddingTop:"10px"}}),e.jsx(pe,{type:"monotone",dataKey:"total",stroke:"#8884d8",strokeWidth:2,name:"Total Thoughts",dot:{r:4},activeDot:{r:6}}),e.jsx(pe,{type:"monotone",dataKey:"challenged",stroke:"#22c55e",strokeWidth:2,name:"Challenged",dot:{r:4},activeDot:{r:6}})]})})})]})]})}function vs(){const{user:o}=be(),{isViewingClientData:f,activeUserId:m}=ve(),[d,u]=ye(),B=new URLSearchParams(window.location.search).get("tab"),[b,A]=D.useState(B==="history"||f||(o==null?void 0:o.role)==="therapist"?"history":"record");D.useEffect(()=>{!(!f&&(o==null?void 0:o.role)!=="therapist")&&b==="record"&&A("history")},[o==null?void 0:o.role,f,b]),q({queryKey:m?[`/api/users/${m}/emotions`]:[],enabled:!!m});const{data:C=[]}=q({queryKey:m?[`/api/users/${m}/thoughts`]:[],enabled:!!m}),M=C.length,z=C.filter(g=>g.evidenceFor&&g.evidenceAgainst).length,S=M-z,F=g=>{u(`/reflection?edit=${g.id}`)};return e.jsx(Me,{title:"Thought Records",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx(ze,{}),e.jsx(st,{}),e.jsx(Fe,{title:"Thought Records",description:"Capture automatic thoughts, identify thinking patterns, and challenge unhelpful beliefs",badges:[]}),C.length>0&&e.jsxs(v,{className:"mb-6 bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:[e.jsx(w,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(K,{className:"h-5 w-5 text-primary"}),e.jsx(k,{className:"text-lg",children:"Overall Progress"})]})}),e.jsx(N,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-white/50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:M}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Recorded"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:z}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Challenged"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-amber-600",children:S}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Unchallenged"})]})]})})]}),e.jsxs(Ne,{value:b,onValueChange:A,className:"space-y-4",children:[e.jsxs(we,{children:[!f&&(o==null?void 0:o.role)!=="therapist"&&e.jsx(W,{value:"record",children:"Record Thought"}),e.jsx(W,{value:"history",children:f?"Client's Thought Records History":"Thought Records History"}),e.jsxs(W,{value:"insights",children:[e.jsx(ae,{className:"h-4 w-4 mr-1.5"}),"Insights"]})]}),!f&&(o==null?void 0:o.role)!=="therapist"&&e.jsx(se,{value:"record",children:e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(k,{children:"Record Your Thought"}),e.jsx(E,{children:"Capture and analyze automatic thoughts as they occur"})]}),e.jsxs(N,{children:[e.jsx(at,{type:"single",collapsible:!0,className:"mb-6 bg-indigo-50 dark:bg-indigo-950/30 rounded-lg px-4",children:e.jsxs(nt,{value:"what-are-ants",className:"border-0",children:[e.jsx(it,{className:"text-base font-medium hover:no-underline py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(Oe,{className:"h-5 w-5 mr-2 text-indigo-600 dark:text-indigo-400"}),"What are Automatic Thoughts?"]})}),e.jsxs(rt,{className:"text-sm text-muted-foreground pb-4",children:[e.jsx("p",{className:"mb-3",children:"Automatic thoughts (also called ANTs - Automatic Negative Thoughts) are the immediate, involuntary thoughts that pop into your mind in response to situations. They're often so quick and habitual that we don't even notice them."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900/50 p-3 rounded-md",children:[e.jsx("h4",{className:"font-medium text-foreground mb-1",children:"Catch the Thought"}),e.jsx("p",{children:"The first step is simply noticing these thoughts. Write them down exactly as they occurâ€”don't judge or analyze yet."}),e.jsx("p",{className:"text-xs mt-1 italic text-indigo-600 dark:text-indigo-400",children:`Example: "I'm going to fail this presentation" or "Everyone thinks I'm boring"`})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900/50 p-3 rounded-md",children:[e.jsx("h4",{className:"font-medium text-foreground mb-1",children:"Identify the Pattern"}),e.jsx("p",{children:"Once recorded, you'll identify which type of unhelpful thinking pattern (ANT category) it representsâ€”like catastrophizing or mind-reading."})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900/50 p-3 rounded-md",children:[e.jsx("h4",{className:"font-medium text-foreground mb-1",children:"Challenge & Reframe"}),e.jsx("p",{children:"After recording, you can challenge these thoughts by examining evidence and developing more balanced perspectives."})]})]})]})]})}),e.jsx(bt,{onClose:()=>{A("history")}})]})]})}),e.jsx(se,{value:"history",children:f?e.jsxs(v,{children:[e.jsxs(w,{children:[e.jsx(k,{children:"Client's Thought Records History"}),e.jsx(E,{children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(pt,{size:16}),"View thought records and reflections for this client"]})})]}),e.jsx(N,{children:e.jsx(re,{onEditRecord:F})})]}):e.jsx(re,{onEditRecord:F})}),e.jsx(se,{value:"insights",children:m&&e.jsx(yt,{userId:m})})]})]})})}export{vs as default};
