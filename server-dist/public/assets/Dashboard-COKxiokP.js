import{c as Je,u as Be,r as V,j as e,C as W,a as Y,X as yt,b as Ae,L as bt,R as _,d as dt,e as ee,f as te,g as fe,B as mt,h as ge,i as Nt,k as wt}from"./index-BJDVYPr2.js";import{A as He}from"./AppLayout-B4pR-pjA.js";import{u as Q}from"./useQuery-CVl6tFXz.js";import{C as Et}from"./circle-plus-C1yyTLEf.js";import{B as ht,C as Ct}from"./target-7abParum.js";import{F as At,C as kt,B as ye,L as Ye,U as Dt}from"./Header-HmO9KIvP.js";import{E as Rt}from"./EmotionHistory-Ds2mJHF9.js";import{u as Te}from"./use-active-user-CkIppDip.js";import{T as Se,a as Ie,b as Z,c as de}from"./tabs-DZkkmdmK.js";import{G as St,i as Ce,g as Xe,a as Qe,b as qe,D as It,f as be,L as Re,m as Oe,C as _e,A as Lt,c as Ne,d as Ze,e as Tt,h as et,j as Ot,k as Ft,u as Pt,l as Mt,B as ue,X as me,Y as re,n as zt,R as oe,o as xe,T as le,p as Me,q as ke,r as tt}from"./generateCategoricalChart-CFBGWCRH.js";import{B as Le}from"./BarChart-BD1_1xzo.js";import{L as $e,s as Ve,a as $t}from"./LineChart-D-Uu3kL0.js";import{s as Kt}from"./subMonths-CJEKbx3n.js";import{e as Bt}from"./eachDayOfInterval-D7CfGF_P.js";import{f as We,s as st}from"./format-CrnBQ42y.js";import{P as nt,a as at}from"./PieChart-PYX3tuHq.js";import{S as Ut}from"./separator-DBveLP5w.js";import{L as _t}from"./link-2-BMm9hW3F.js";import{S as ut,Z as xt,a as Vt}from"./ScatterChart-CuiXXHR4.js";import{S as ze}from"./skeleton-BOSe4yaW.js";import{U as it}from"./user-hKahD6_k.js";import{B as Wt}from"./book-text-_2JTahF7.js";import{L as qt}from"./list-checks-9ijXefDl.js";import{C as Gt}from"./ClientDebug-BYZqnShq.js";import"./utils-km2FGkQ4.js";import"./index-ZMpGrT0S.js";import"./index-epKMAjhH.js";import"./check-CPyQFfyd.js";import"./useMutation-4_CoT2bx.js";import"./use-refresh-data-Dq9XIZaR.js";import"./table-01yzukTO.js";import"./dialog-BkbRhY2O.js";import"./alert-dialog-bBvWK-5Q.js";import"./ReflectionWizard-ChKYTux2.js";import"./form-Bn3qej8w.js";import"./label-DKKVfa8V.js";import"./textarea-8UmQ7iuL.js";import"./input-C744jVRX.js";import"./checkbox-CpzJVwUi.js";import"./index-pLghM4Oe.js";import"./progress-XD4z056s.js";import"./slider-BHLSMB0K.js";import"./info-PLI2XuV7.js";import"./accordion-C_vhZxL6.js";import"./chevron-down-JR_7gpC-.js";import"./calendar-Ck4F2mgv.js";import"./eye-D3NTB46B.js";import"./square-pen-BwPwTV1q.js";import"./arrow-right-BBjUy21T.js";import"./trash-2-ZtlY59XR.js";import"./sparkles-aDL3aOOp.js";import"./message-square-BUQziOr0.js";import"./en-US-9SRVm7yB.js";import"./addMonths-CPL-v1oH.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jt=Je("ArrowRightLeft",[["path",{d:"m16 3 4 4-4 4",key:"1x1c3m"}],["path",{d:"M20 7H4",key:"zbl0bi"}],["path",{d:"m8 21-4-4 4-4",key:"h9nckh"}],["path",{d:"M4 17h16",key:"g4d7ey"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ht=Je("Goal",[["path",{d:"M12 13V2l8 4-8 4",key:"5wlwwj"}],["path",{d:"M20.561 10.222a9 9 0 1 1-12.55-5.29",key:"1c0wjv"}],["path",{d:"M8.002 9.997a5 5 0 1 0 8.9 2.02",key:"gb1g7m"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rt=Je("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);function Yt(){const{user:t}=Be(),[s,a]=V.useState(!1),{data:n}=Q({queryKey:t?[`/api/users/${t.id}/emotions`]:[],enabled:!!t}),{data:i}=Q({queryKey:t?[`/api/users/${t.id}/thoughts`]:[],enabled:!!t}),{data:c}=Q({queryKey:t?[`/api/users/${t.id}/goals`]:[],enabled:!!t}),m=n&&n.length>0,h=i&&i.length>0,x=c&&c.length>0,u=(t==null?void 0:t.role)==="therapist"||(t==null?void 0:t.therapistId)!==null&&(t==null?void 0:t.therapistId)!==void 0;return s||m&&h&&x&&u?null:e.jsx(W,{className:"bg-white rounded-lg shadow-sm mb-6",children:e.jsxs(Y,{className:"pt-5",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"font-medium text-lg",children:"Getting Started"}),e.jsx("button",{className:"text-neutral-400 hover:text-neutral-600",onClick:()=>a(!0),children:e.jsx(yt,{size:18})})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx(Fe,{label:"Record your first emotion",isCompleted:m,href:"/emotions"}),e.jsx(Fe,{label:"Complete a reflection",isCompleted:h,href:"/thoughts"}),e.jsx(Fe,{label:"Set a SMART goal",isCompleted:x,href:"/goals"}),e.jsx(Fe,{label:(t==null?void 0:t.role)==="therapist"?"Invite a client":"Accept invitation",isCompleted:u,href:(t==null?void 0:t.role)==="therapist"?"/clients":"/settings"})]})]})})}function Fe({label:t,isCompleted:s,href:a}){return e.jsxs("a",{href:a,className:Ae("flex items-center group",s?"cursor-default":"cursor-pointer hover:bg-neutral-50 rounded-md -mx-1 px-1"),children:[e.jsx("div",{className:Ae("w-6 h-6 rounded-full mr-3 flex items-center justify-center",s?"bg-green-100 text-green-700":"border border-neutral-300 group-hover:border-neutral-400"),children:s&&e.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:e.jsx("polyline",{points:"20 6 9 17 4 12"})})}),e.jsx("span",{className:Ae("text-sm",s?"text-neutral-500 line-through":"text-neutral-700"),children:t})]})}function Xt(){const t=[{title:"Record Emotion",description:"Track how you're feeling right now",icon:e.jsx(Et,{className:"text-primary h-6 w-6"}),href:"/emotions"},{title:"New Thought Record",description:"Document and analyze thoughts",icon:e.jsx(ht,{className:"text-primary h-6 w-6"}),href:"/thoughts"},{title:"Set a Goal",description:"Create a new SMART goal",icon:e.jsx(At,{className:"text-primary h-6 w-6"}),href:"/goals"},{title:"View Progress",description:"Check your recent progress",icon:e.jsx(kt,{className:"text-primary h-6 w-6"}),href:"/reports"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:t.map((s,a)=>e.jsx(bt,{href:s.href,children:e.jsxs(W,{className:"p-5 hover:shadow-md transition-shadow cursor-pointer h-full",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h3",{className:"font-medium",children:s.title}),s.icon]}),e.jsx("p",{className:"text-sm text-neutral-600",children:s.description})]})},a))})}var Qt=["layout","type","stroke","connectNulls","isRange","ref"],Zt=["key"],ft;function De(t){"@babel/helpers - typeof";return De=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(s){return typeof s}:function(s){return s&&typeof Symbol=="function"&&s.constructor===Symbol&&s!==Symbol.prototype?"symbol":typeof s},De(t)}function pt(t,s){if(t==null)return{};var a=es(t,s),n,i;if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(t);for(i=0;i<c.length;i++)n=c[i],!(s.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(t,n)&&(a[n]=t[n])}return a}function es(t,s){if(t==null)return{};var a={};for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){if(s.indexOf(n)>=0)continue;a[n]=t[n]}return a}function ve(){return ve=Object.assign?Object.assign.bind():function(t){for(var s=1;s<arguments.length;s++){var a=arguments[s];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(t[n]=a[n])}return t},ve.apply(this,arguments)}function ot(t,s){var a=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);s&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(t,i).enumerable})),a.push.apply(a,n)}return a}function pe(t){for(var s=1;s<arguments.length;s++){var a=arguments[s]!=null?arguments[s]:{};s%2?ot(Object(a),!0).forEach(function(n){he(t,n,a[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(a)):ot(Object(a)).forEach(function(n){Object.defineProperty(t,n,Object.getOwnPropertyDescriptor(a,n))})}return t}function ts(t,s){if(!(t instanceof s))throw new TypeError("Cannot call a class as a function")}function lt(t,s){for(var a=0;a<s.length;a++){var n=s[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,vt(n.key),n)}}function ss(t,s,a){return s&&lt(t.prototype,s),a&&lt(t,a),Object.defineProperty(t,"prototype",{writable:!1}),t}function ns(t,s,a){return s=Ke(s),as(t,gt()?Reflect.construct(s,a||[],Ke(t).constructor):s.apply(t,a))}function as(t,s){if(s&&(De(s)==="object"||typeof s=="function"))return s;if(s!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return is(t)}function is(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function gt(){try{var t=!Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){}))}catch{}return(gt=function(){return!!t})()}function Ke(t){return Ke=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(a){return a.__proto__||Object.getPrototypeOf(a)},Ke(t)}function rs(t,s){if(typeof s!="function"&&s!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(s&&s.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),s&&Ge(t,s)}function Ge(t,s){return Ge=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},Ge(t,s)}function he(t,s,a){return s=vt(s),s in t?Object.defineProperty(t,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[s]=a,t}function vt(t){var s=os(t,"string");return De(s)=="symbol"?s:s+""}function os(t,s){if(De(t)!="object"||!t)return t;var a=t[Symbol.toPrimitive];if(a!==void 0){var n=a.call(t,s||"default");if(De(n)!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(s==="string"?String:Number)(t)}var je=function(t){function s(){var a;ts(this,s);for(var n=arguments.length,i=new Array(n),c=0;c<n;c++)i[c]=arguments[c];return a=ns(this,s,[].concat(i)),he(a,"state",{isAnimationFinished:!0}),he(a,"id",Pt("recharts-area-")),he(a,"handleAnimationEnd",function(){var m=a.props.onAnimationEnd;a.setState({isAnimationFinished:!0}),qe(m)&&m()}),he(a,"handleAnimationStart",function(){var m=a.props.onAnimationStart;a.setState({isAnimationFinished:!1}),qe(m)&&m()}),a}return rs(s,t),ss(s,[{key:"renderDots",value:function(n,i,c){var m=this.props.isAnimationActive,h=this.state.isAnimationFinished;if(m&&!h)return null;var x=this.props,u=x.dot,y=x.points,v=x.dataKey,f=be(this.props,!1),R=be(u,!0),k=y.map(function(C,O){var p=pe(pe(pe({key:"dot-".concat(O),r:3},f),R),{},{index:O,cx:C.x,cy:C.y,dataKey:v,value:C.value,payload:C.payload,points:y});return s.renderDotItem(u,p)}),j={clipPath:n?"url(#clipPath-".concat(i?"":"dots-").concat(c,")"):null};return _.createElement(Re,ve({className:"recharts-area-dots"},j),k)}},{key:"renderHorizontalRect",value:function(n){var i=this.props,c=i.baseLine,m=i.points,h=i.strokeWidth,x=m[0].x,u=m[m.length-1].x,y=n*Math.abs(x-u),v=Oe(m.map(function(f){return f.y||0}));return Ce(c)&&typeof c=="number"?v=Math.max(c,v):c&&Array.isArray(c)&&c.length&&(v=Math.max(Oe(c.map(function(f){return f.y||0})),v)),Ce(v)?_.createElement("rect",{x:x<u?x:x-y,y:0,width:y,height:Math.floor(v+(h?parseInt("".concat(h),10):1))}):null}},{key:"renderVerticalRect",value:function(n){var i=this.props,c=i.baseLine,m=i.points,h=i.strokeWidth,x=m[0].y,u=m[m.length-1].y,y=n*Math.abs(x-u),v=Oe(m.map(function(f){return f.x||0}));return Ce(c)&&typeof c=="number"?v=Math.max(c,v):c&&Array.isArray(c)&&c.length&&(v=Math.max(Oe(c.map(function(f){return f.x||0})),v)),Ce(v)?_.createElement("rect",{x:0,y:x<u?x:x-y,width:v+(h?parseInt("".concat(h),10):1),height:Math.floor(y)}):null}},{key:"renderClipRect",value:function(n){var i=this.props.layout;return i==="vertical"?this.renderVerticalRect(n):this.renderHorizontalRect(n)}},{key:"renderAreaStatically",value:function(n,i,c,m){var h=this.props,x=h.layout,u=h.type,y=h.stroke,v=h.connectNulls,f=h.isRange;h.ref;var R=pt(h,Qt);return _.createElement(Re,{clipPath:c?"url(#clipPath-".concat(m,")"):null},_.createElement(_e,ve({},be(R,!0),{points:n,connectNulls:v,type:u,baseLine:i,layout:x,stroke:"none",className:"recharts-area-area"})),y!=="none"&&_.createElement(_e,ve({},be(this.props,!1),{className:"recharts-area-curve",layout:x,type:u,connectNulls:v,fill:"none",points:n})),y!=="none"&&f&&_.createElement(_e,ve({},be(this.props,!1),{className:"recharts-area-curve",layout:x,type:u,connectNulls:v,fill:"none",points:i})))}},{key:"renderAreaWithAnimation",value:function(n,i){var c=this,m=this.props,h=m.points,x=m.baseLine,u=m.isAnimationActive,y=m.animationBegin,v=m.animationDuration,f=m.animationEasing,R=m.animationId,k=this.state,j=k.prevPoints,C=k.prevBaseLine;return _.createElement(Lt,{begin:y,duration:v,isActive:u,easing:f,from:{t:0},to:{t:1},key:"area-".concat(R),onAnimationEnd:this.handleAnimationEnd,onAnimationStart:this.handleAnimationStart},function(O){var p=O.t;if(j){var L=j.length/h.length,D=h.map(function($,X){var G=Math.floor(X*L);if(j[G]){var B=j[G],ae=Ne(B.x,$.x),d=Ne(B.y,$.y);return pe(pe({},$),{},{x:ae(p),y:d(p)})}return $}),A;if(Ce(x)&&typeof x=="number"){var z=Ne(C,x);A=z(p)}else if(Ze(x)||Tt(x)){var q=Ne(C,0);A=q(p)}else A=x.map(function($,X){var G=Math.floor(X*L);if(C[G]){var B=C[G],ae=Ne(B.x,$.x),d=Ne(B.y,$.y);return pe(pe({},$),{},{x:ae(p),y:d(p)})}return $});return c.renderAreaStatically(D,A,n,i)}return _.createElement(Re,null,_.createElement("defs",null,_.createElement("clipPath",{id:"animationClipPath-".concat(i)},c.renderClipRect(p))),_.createElement(Re,{clipPath:"url(#animationClipPath-".concat(i,")")},c.renderAreaStatically(h,x,n,i)))})}},{key:"renderArea",value:function(n,i){var c=this.props,m=c.points,h=c.baseLine,x=c.isAnimationActive,u=this.state,y=u.prevPoints,v=u.prevBaseLine,f=u.totalLength;return x&&m&&m.length&&(!y&&f>0||!et(y,m)||!et(v,h))?this.renderAreaWithAnimation(n,i):this.renderAreaStatically(m,h,n,i)}},{key:"render",value:function(){var n,i=this.props,c=i.hide,m=i.dot,h=i.points,x=i.className,u=i.top,y=i.left,v=i.xAxis,f=i.yAxis,R=i.width,k=i.height,j=i.isAnimationActive,C=i.id;if(c||!h||!h.length)return null;var O=this.state.isAnimationFinished,p=h.length===1,L=dt("recharts-area",x),D=v&&v.allowDataOverflow,A=f&&f.allowDataOverflow,z=D||A,q=Ze(C)?this.id:C,$=(n=be(m,!1))!==null&&n!==void 0?n:{r:3,strokeWidth:2},X=$.r,G=X===void 0?3:X,B=$.strokeWidth,ae=B===void 0?2:B,d=Ot(m)?m:{},b=d.clipDot,g=b===void 0?!0:b,w=G*2+ae;return _.createElement(Re,{className:L},D||A?_.createElement("defs",null,_.createElement("clipPath",{id:"clipPath-".concat(q)},_.createElement("rect",{x:D?y:y-R/2,y:A?u:u-k/2,width:D?R:R*2,height:A?k:k*2})),!g&&_.createElement("clipPath",{id:"clipPath-dots-".concat(q)},_.createElement("rect",{x:y-w/2,y:u-w/2,width:R+w,height:k+w}))):null,p?null:this.renderArea(z,q),(m||p)&&this.renderDots(z,g,q),(!j||O)&&Ft.renderCallByParent(this.props,h))}}],[{key:"getDerivedStateFromProps",value:function(n,i){return n.animationId!==i.prevAnimationId?{prevAnimationId:n.animationId,curPoints:n.points,curBaseLine:n.baseLine,prevPoints:i.curPoints,prevBaseLine:i.curBaseLine}:n.points!==i.curPoints||n.baseLine!==i.curBaseLine?{curPoints:n.points,curBaseLine:n.baseLine}:null}}])}(V.PureComponent);ft=je;he(je,"displayName","Area");he(je,"defaultProps",{stroke:"#3182bd",fill:"#3182bd",fillOpacity:.6,xAxisId:0,yAxisId:0,legendType:"line",connectNulls:!1,points:[],dot:!1,activeDot:!0,hide:!1,isAnimationActive:!St.isSsr,animationBegin:0,animationDuration:1500,animationEasing:"ease"});he(je,"getBaseValue",function(t,s,a,n){var i=t.layout,c=t.baseValue,m=s.props.baseValue,h=m??c;if(Ce(h)&&typeof h=="number")return h;var x=i==="horizontal"?n:a,u=x.scale.domain();if(x.type==="number"){var y=Math.max(u[0],u[1]),v=Math.min(u[0],u[1]);return h==="dataMin"?v:h==="dataMax"||y<0?y:Math.max(Math.min(u[0],u[1]),0)}return h==="dataMin"?u[0]:h==="dataMax"?u[1]:u[0]});he(je,"getComposedData",function(t){var s=t.props,a=t.item,n=t.xAxis,i=t.yAxis,c=t.xAxisTicks,m=t.yAxisTicks,h=t.bandSize,x=t.dataKey,u=t.stackedData,y=t.dataStartIndex,v=t.displayedData,f=t.offset,R=s.layout,k=u&&u.length,j=ft.getBaseValue(s,a,n,i),C=R==="horizontal",O=!1,p=v.map(function(D,A){var z;k?z=u[y+A]:(z=Xe(D,x),Array.isArray(z)?O=!0:z=[j,z]);var q=z[1]==null||k&&Xe(D,x)==null;return C?{x:Qe({axis:n,ticks:c,bandSize:h,entry:D,index:A}),y:q?null:i.scale(z[1]),value:z,payload:D}:{x:q?null:n.scale(z[1]),y:Qe({axis:i,ticks:m,bandSize:h,entry:D,index:A}),value:z,payload:D}}),L;return k||O?L=p.map(function(D){var A=Array.isArray(D.value)?D.value[0]:null;return C?{x:D.x,y:A!=null&&D.y!=null?i.scale(A):null}:{x:A!=null?n.scale(A):null,y:D.y}}):L=C?i.scale(j):n.scale(j),pe({points:p,baseLine:L,layout:R,isRange:O},f)});he(je,"renderDotItem",function(t,s){var a;if(_.isValidElement(t))a=_.cloneElement(t,s);else if(qe(t))a=t(s);else{var n=dt("recharts-area-dot",typeof t!="boolean"?t.className:""),i=s.key,c=pt(s,Zt);a=_.createElement(It,ve({},c,{key:i,className:n}))}return a});var ct=Mt({chartName:"ComposedChart",GraphicalChild:[$e,je,ue,ut],axisComponents:[{axisType:"xAxis",AxisComp:me},{axisType:"yAxis",AxisComp:re},{axisType:"zAxis",AxisComp:xt}],formatAxisMap:zt});const ne={joy:{color:"#FFC107",name:"Joy",valence:"positive"},sadness:{color:"#3F51B5",name:"Sadness",valence:"negative"},fear:{color:"#8A65AA",name:"Fear",valence:"negative"},anger:{color:"#F44336",name:"Anger",valence:"negative"},disgust:{color:"#4CAF50",name:"Disgust",valence:"negative"},love:{color:"#E91E63",name:"Love",valence:"positive"}};function ls(){const{activeUserId:t,isViewingClientData:s}=Te(),[a,n]=V.useState("week"),{data:i,isLoading:c,error:m}=Q({queryKey:t?[`/api/users/${t}/emotions`]:[],enabled:!!t}),h=()=>{if(!i||i.length===0)return[];Object.keys(ne).map(C=>ne[C].name);let f,R;switch(a){case"week":f=Ve(new Date,7),R="EEE";break;case"month":f=Ve(new Date,30),R="MMM d";break;case"year":f=Kt(new Date,12),R="MMM";break;default:f=Ve(new Date,7),R="EEE"}const j=Bt({start:f,end:new Date}).map(C=>{const O={date:C,formattedDate:We(C,R),count:0,emotionIntensities:{}};return Object.keys(ne).forEach(p=>{O[ne[p].name]=0}),O});if(i.forEach(C=>{const O=st(new Date(C.timestamp)),p=j.findIndex(L=>st(L.date).getTime()===O.getTime());if(p!==-1){const L=C.coreEmotion;if(L)if(j[p][L]!==void 0)j[p][L]+=1,j[p].count+=1,j[p].emotionIntensities[L]||(j[p].emotionIntensities[L]=[]),j[p].emotionIntensities[L].push(C.intensity);else{const D=Object.keys(ne).find(A=>ne[A].name.toLowerCase()===L.toLowerCase());if(D){const A=ne[D].name;j[p][A]+=1,j[p].count+=1,j[p].emotionIntensities[A]||(j[p].emotionIntensities[A]=[]),j[p].emotionIntensities[A].push(C.intensity)}}}}),a==="month"||a==="year"){const C=a==="month"?p=>We(p,"MMM"):p=>We(p,"yyyy"),O={};return j.forEach(p=>{const L=C(p.date);O[L]||(O[L]=[]),O[L].push(p)}),Object.keys(O).map(p=>{const L=O[p],D={date:p};return Object.keys(ne).forEach(A=>{const q=ne[A].name,$=[];if(L.forEach(X=>{const G=X.emotionIntensities[q]||[];$.push(...G)}),$.length>0){const G=$.reduce((B,ae)=>B+ae,0)/$.length;D[q]=parseFloat(G.toFixed(1))}else D[q]=0}),D})}else return j.map(C=>{const O={date:C.formattedDate};return Object.keys(ne).forEach(p=>{const D=ne[p].name,A=C.emotionIntensities[D]||[];if(C[D]>0){const z=A.reduce(($,X)=>$+X,0),q=A.length>0?z/A.length:0;O[D]=parseFloat(q.toFixed(1))}else O[D]=0}),O})},x=({active:f,payload:R,label:k})=>f&&R&&R.length?e.jsxs("div",{className:"bg-white p-3 border border-neutral-200 rounded-md shadow-sm",children:[e.jsx("p",{className:"font-medium text-sm",children:k}),e.jsx("div",{className:"mt-1 space-y-1",children:R.map((j,C)=>e.jsxs("p",{className:"text-xs flex items-center",children:[e.jsx("span",{className:"h-2 w-2 rounded-full mr-1",style:{backgroundColor:j.color}}),e.jsxs("span",{children:[j.name,": "]}),e.jsx("span",{className:"ml-1 font-medium",children:j.value})]},C))})]}):null,u=f=>{n(f)};if(c)return e.jsxs(W,{children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Mood Trends"}),e.jsx(fe,{children:"Track different emotion types separately over time"})]}),e.jsx(Y,{children:e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})})})]});if(m)return e.jsxs(W,{children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Mood Trends"}),e.jsx(fe,{children:"Track different emotion types separately over time"})]}),e.jsx(Y,{children:e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"Error loading mood trends. Please try again later."})})})]});const y=h(),v=i&&i.length>0;return e.jsxs(W,{children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsxs("div",{children:[e.jsx(te,{children:"Mood Trends"}),e.jsx(fe,{children:"Track different emotion types separately over time"})]}),e.jsx(Se,{defaultValue:"week",value:a,onValueChange:u,children:e.jsxs(Ie,{children:[e.jsx(Z,{value:"week",children:"Week"}),e.jsx(Z,{value:"month",children:"Month"}),e.jsx(Z,{value:"year",children:"Year"})]})})]}),e.jsx(Y,{children:e.jsx("div",{className:"h-80 relative",children:v?e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(Le,{data:y,margin:{top:20,right:30,left:10,bottom:20},barGap:2,barSize:a==="week"?20:a==="month"?12:8,children:[e.jsx(xe,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(me,{dataKey:"date",tick:{fontSize:12},interval:a==="week"?0:a==="month"?2:1,angle:a==="month"?-45:0,textAnchor:a==="month"?"end":"middle",height:a==="month"?60:30}),e.jsx(re,{domain:[0,10],tick:{fontSize:12}}),e.jsx(le,{content:e.jsx(x,{})}),e.jsx(Me,{align:"center",verticalAlign:"top",wrapperStyle:{paddingBottom:15,paddingTop:5,fontWeight:"bold"},iconSize:10,iconType:"square"}),Object.keys(ne).map(f=>{const R=ne[f];return e.jsx(ue,{dataKey:R.name,name:R.name,fill:R.color,radius:[2,2,0,0],activeBar:{stroke:"#fff",strokeWidth:2},isAnimationActive:!0,animationBegin:200,animationDuration:1e3,stroke:"#fff",strokeWidth:1},f)})]})}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-neutral-400 mb-2",children:"No mood data available"}),e.jsx(mt,{size:"sm",variant:"outline",asChild:!0,children:e.jsx("a",{href:"/emotions",children:"Record an emotion"})})]})})})})]})}function cs({userId:t,days:s=30}){var f,R;const{user:a}=Be(),[n,i]=V.useState([]),[c,m]=V.useState([]),[h,x]=V.useState(!0),[u,y]=V.useState(null);V.useEffect(()=>{if(!a)return;(async()=>{try{x(!0);const C=await(await ge("GET",`/api/users/${t}/emotions/stats?days=${s}`)).json(),p=await(await ge("GET",`/api/users/${t}/thoughts/ratings?days=${s}`)).json();i(C),m(p)}catch(j){console.error("Error fetching reflection trends:",j),y("Failed to load reflection trends data")}finally{x(!1)}})()},[a,t,s]);const v=k=>({Joy:"#F9D71C",Sadness:"#6D87C4",Fear:"#8A65AA",Disgust:"#7DB954",Anger:"#E43D40"})[k]||"#888888";return h?e.jsx(W,{className:"w-full h-[300px] flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"w-8 h-8 border-4 border-t-primary border-r-neutral-200 border-b-neutral-200 border-l-neutral-200 rounded-full animate-spin mx-auto"}),e.jsx("p",{className:"mt-2 text-sm text-neutral-600",children:"Loading reflection data..."})]})}):u?e.jsxs(W,{className:"w-full h-[300px]",children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Reflection Trends"}),e.jsx(fe,{children:"Analysis of your emotional reflections"})]}),e.jsx(Y,{className:"flex items-center justify-center h-[200px]",children:e.jsx("p",{className:"text-red-500",children:u})})]}):e.jsxs(W,{className:"w-full",children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Reflection Trends"}),e.jsxs(fe,{children:["Analysis of your emotional reflections over the past ",s," days"]})]}),e.jsx(Y,{children:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Emotion Distribution"}),e.jsx("div",{className:"h-[200px]",children:e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(Le,{data:n,children:[e.jsx(xe,{strokeDasharray:"3 3"}),e.jsx(me,{dataKey:"emotion"}),e.jsx(re,{allowDecimals:!1}),e.jsx(le,{}),e.jsx(ue,{dataKey:"count",fill:"#8884d8",name:"Occurrences",radius:[4,4,0,0],barSize:30,children:n.map((k,j)=>e.jsx(ke,{fill:k.color||v(k.emotion)},`cell-${j}`))})]})})})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-3",children:"Reflection Effectiveness Over Time"}),e.jsx("div",{className:"h-[200px]",children:e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs($t,{data:c,children:[e.jsx(xe,{strokeDasharray:"3 3"}),e.jsx(me,{dataKey:"date"}),e.jsx(re,{domain:[0,10]}),e.jsx(le,{}),e.jsx($e,{type:"monotone",dataKey:"rating",stroke:"#8884d8",name:"Effectiveness Rating",strokeWidth:2,dot:{r:4},activeDot:{r:6}})]})})})]}),e.jsxs("div",{className:"bg-neutral-50 p-4 rounded-md border border-neutral-200",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Pattern Analysis"}),e.jsx("p",{className:"text-sm text-neutral-600",children:c.length>=5?"Your reflections show increasing effectiveness over time, indicating growth in your emotional processing skills.":c.length>0?"Continue recording reflections to reveal reliable patterns over time.":"Start recording reflections to see pattern analysis."}),n.length>0&&e.jsx("div",{className:"mt-2 text-sm text-neutral-600",children:((f=n.sort((k,j)=>j.count-k.count)[0])==null?void 0:f.count)>=3?e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Most frequent emotion:"})," ",(R=n.sort((k,j)=>j.count-k.count)[0])==null?void 0:R.emotion]}):e.jsxs("p",{children:[e.jsx("span",{className:"font-medium",children:"Most frequent emotion:"})," ",e.jsx("span",{className:"italic",children:"Not enough data yet for reliable patterns"})]})})]})]})})]})}const ce=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d","#ffc658"],we={Joy:"#F9D71C",Sadness:"#6D87C4",Fear:"#8A65AA",Disgust:"#7DB954",Anger:"#E43D40",Surprise:"#F47B20",Trust:"#8DC4BD"},ds=["overview","emotions","strategies","distortions"];function ms(){const{activeUserId:t,isViewingClientData:s}=Te(),[a,n]=V.useState("overview"),[i,c]=V.useState([]),[m,h]=V.useState([]),[x,u]=V.useState([]),[y,v]=V.useState(!0),[f,R]=V.useState(null),[k,j]=V.useState({}),[C,O]=V.useState({}),[p,L]=V.useState(null);V.useEffect(()=>{if(!t)return;(async()=>{v(!0);try{const g=await(await ge("GET",`/api/users/${t}/emotions`)).json();h(g);const E=await(await ge("GET",`/api/users/${t}/thoughts`)).json();u(E);const T=await(await ge("GET",`/api/users/${t}/journal/stats`)).json();L(T);const K={},J={};await Promise.all(E.map(async I=>{try{const H=await(await ge("GET",`/api/users/${t}/thoughts/${I.id}/protective-factors`)).json();K[I.id]=H}catch(M){console.error("Error fetching protective factors for thought:",I.id,M),K[I.id]=[]}})),await Promise.all(E.map(async I=>{try{const H=await(await ge("GET",`/api/users/${t}/thoughts/${I.id}/coping-strategies`)).json();J[I.id]=H}catch(M){console.error("Error fetching coping strategies for thought:",I.id,M),J[I.id]=[]}})),j(K),O(J),D(g,E,K,J)}catch(b){R(b instanceof Error?b:new Error("Unknown error occurred"))}finally{v(!1)}})()},[t]);const D=(d,b,g,w)=>{const E={};d.forEach(T=>{const K=T.coreEmotion;E[K]||(E[K]={coreEmotion:K,emotions:[],reflections:[],count:0,totalIntensity:0,averageIntensity:0,commonDistortions:[],mostUsedStrategies:[],averageRating:0,improvementRate:0}),E[K].emotions.push(T),E[K].count+=1,E[K].totalIntensity+=T.intensity}),b.forEach(T=>{const K=d.find(J=>J.id===T.emotionRecordId);if(K){const J=K.coreEmotion;E[J]&&E[J].reflections.push(T)}}),Object.values(E).forEach(T=>{T.averageIntensity=T.totalIntensity/T.count;const K={};T.reflections.forEach(I=>{I.cognitiveDistortions&&I.cognitiveDistortions.forEach(M=>{K[M]=(K[M]||0)+1})}),T.commonDistortions=Object.entries(K).map(([I,M])=>({name:I,count:M})).sort((I,M)=>M.count-I.count);const J={};if(T.reflections.forEach(I=>{(g[I.id]||[]).forEach(H=>{J[H.name]=(J[H.name]||0)+1})}),T.reflections.forEach(I=>{(w[I.id]||[]).forEach(H=>{J[H.name]=(J[H.name]||0)+1})}),T.mostUsedStrategies=Object.entries(J).map(([I,M])=>({name:I,count:M})).sort((I,M)=>M.count-I.count),T.reflections.length>0){const I=T.reflections.reduce((M,H)=>M+(H.reflectionRating||0),0);T.averageRating=I/T.reflections.length}if(T.reflections.length>0){let I=0,M=0;T.reflections.forEach(H=>{const r=d.find(o=>o.id===H.emotionRecordId);if(r&&H.reflectionRating){const o=r.intensity,l=H.reflectionRating-o;I+=l,M++}}),M>0&&(T.improvementRate=I/M)}});const se=Object.values(E).sort((T,K)=>K.count-T.count);c(se)},A=()=>i.map(d=>({name:d.coreEmotion,count:d.count,averageIntensity:parseFloat(d.averageIntensity.toFixed(1)),improvement:parseFloat(d.improvementRate.toFixed(1)),fill:we[d.coreEmotion]||"#8884d8",color:we[d.coreEmotion]||"#8884d8"})),z=()=>{const d={};return x.forEach(g=>{g.cognitiveDistortions&&Array.isArray(g.cognitiveDistortions)&&g.cognitiveDistortions.forEach(w=>{const E=w.trim().toLowerCase().replace(/\s+/g,"-");d[E]=(d[E]||0)+1})}),p&&p.cognitiveDistortions&&Object.entries(p.cognitiveDistortions).forEach(([g,w])=>{const E=g.trim().toLowerCase().replace(/\s+/g,"-");d[E]=(d[E]||0)+(typeof w=="number"?w:0)}),Object.entries(d).map(([g,w])=>({name:g,value:w})).sort((g,w)=>w.value-g.value)},q=()=>{if(y)return e.jsx("div",{className:"p-4 text-center",children:"Loading insights..."});if(f)return e.jsxs("div",{className:"p-4 text-center text-red-500",children:["Error loading insights: ",f.message]});if(i.length===0)return e.jsxs("div",{className:"p-4 text-center",children:[e.jsx("p",{className:"mb-4",children:"No reflection data available yet."}),e.jsx("p",{className:"text-sm",children:"Complete more reflections to see insights here."})]});switch(a){case"overview":return $();case"emotions":return X();case"strategies":return B();case"distortions":return ae();default:return $()}},$=()=>{const d=A(),b=s?"Showing frequency of each core emotion in this client's records.":"Showing frequency of each core emotion in your records.";return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Emotion Distribution"}),e.jsx(oe,{width:"100%",height:300,children:e.jsxs(Le,{data:d,children:[e.jsx(xe,{strokeDasharray:"3 3"}),e.jsx(me,{dataKey:"name"}),e.jsx(re,{}),e.jsx(le,{}),e.jsx(ue,{dataKey:"count",name:"Frequency",children:d.map((g,w)=>e.jsx(ke,{fill:we[g.name]||ce[w%ce.length]},`cell-${w}`))})]})}),e.jsx("div",{className:"mt-2 text-sm text-muted-foreground",children:b})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-4",children:[e.jsxs(W,{children:[e.jsx(ee,{className:"pb-2",children:e.jsx(te,{className:"text-lg",children:"Total Reflections"})}),e.jsx(Y,{children:e.jsx("p",{className:"text-3xl font-bold",children:x.length})})]}),e.jsxs(W,{children:[e.jsx(ee,{className:"pb-2",children:e.jsx(te,{className:"text-lg",children:"Most Common Emotion"})}),e.jsx(Y,{children:i.length>0&&e.jsx("div",{children:i[0].count>=3?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-xl font-bold",children:i[0].coreEmotion}),e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Recorded ",i[0].count," times"]})]}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"Not enough data yet. Record more emotions for meaningful patterns."})})})]}),e.jsxs(W,{children:[e.jsxs(ee,{className:"pb-2",children:[e.jsx(te,{className:"text-lg",children:"Avg. Improvement"}),e.jsx(fe,{children:"After reflection"})]}),e.jsx(Y,{children:i.length>0&&e.jsx("div",{children:x.length>=5?e.jsxs("p",{className:"text-2xl font-bold",children:[(i.reduce((g,w)=>g+w.improvementRate,0)/i.length).toFixed(1),e.jsx("span",{className:"text-sm font-normal text-muted-foreground ml-1",children:"points"})]}):e.jsxs("div",{children:[e.jsxs("p",{className:"text-xl font-bold text-neutral-500",children:[(i.reduce((g,w)=>g+w.improvementRate,0)/i.length).toFixed(1),e.jsx("span",{className:"text-sm font-normal ml-1",children:"points"})]}),e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["Need ",5-x.length," more reflections for reliable data"]})]})})})]})]})]})},X=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Emotion Analysis"}),i.map(d=>e.jsxs(W,{className:"overflow-hidden",children:[e.jsx("div",{className:"h-2",style:{backgroundColor:we[d.coreEmotion]||"#8884d8"}}),e.jsxs(ee,{children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(te,{children:d.coreEmotion}),e.jsxs(ye,{variant:d.count>=3?"outline":"secondary",className:d.count<3?"bg-neutral-100":"",children:[d.count," records ",d.count<3&&"(limited data)"]})]}),e.jsxs(fe,{children:["Average intensity: ",d.averageIntensity.toFixed(1),"/10",d.count<3&&" (preliminary)"]})]}),e.jsx(Y,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Most common situations:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.emotions.length>0?d.emotions.filter(b=>b.situation).slice(0,3).map((b,g)=>e.jsx(ye,{variant:"secondary",children:b.situation},g)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No situations recorded"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium mb-1",children:"Common distortions:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:d.commonDistortions.length>0?d.commonDistortions.slice(0,3).map((b,g)=>e.jsxs(ye,{variant:"outline",children:[b.name," (",b.count,")"]},g)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No distortions recorded"})})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium",children:"Improvement after reflection:"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs("span",{className:"text-xl font-bold",children:[d.improvementRate>0?"+":"",d.improvementRate.toFixed(1)]}),e.jsx("span",{className:"text-sm text-muted-foreground",children:"points on average"})]})]})]})})]},d.coreEmotion))]}),G=()=>{const d={},b={};return i.forEach(g=>{g.mostUsedStrategies.forEach(w=>{d[w.name]=(d[w.name]||0)+w.count,(!b[w.name]||w.count>d[w.name]/2)&&(b[w.name]=g.coreEmotion)})}),Object.entries(d).map(([g,w])=>({name:g,value:w,color:b[g]?we[b[g]]:void 0,emotion:b[g]})).sort((g,w)=>w.value-g.value)},B=()=>{const d=G();return e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Coping Strategies & Protective Factors"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:s?"This shows the strategies the client uses most frequently and for which emotions.":"This shows the strategies you use most frequently and for which emotions."}),d.length>0?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4 mb-6",children:[e.jsx("div",{children:e.jsx(oe,{width:"100%",height:300,children:e.jsxs(nt,{children:[e.jsx(at,{data:d,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:b=>b.name,children:d.map((b,g)=>e.jsx(ke,{fill:b.color||ce[g%ce.length]},`cell-${g}`))}),e.jsx(le,{})]})})}),e.jsxs("div",{className:"self-center",children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:"Top Strategies"}),e.jsx("ul",{className:"space-y-2",children:d.slice(0,5).map((b,g)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:b.color||ce[g%ce.length]}}),e.jsx("span",{children:b.name}),e.jsxs("span",{className:"text-sm text-muted-foreground ml-auto",children:["Used ",b.value," times"]})]},g))})]})]}),e.jsx("h4",{className:"text-md font-medium mt-6 mb-3",children:"Strategies by Emotion"}),e.jsx("div",{className:"space-y-4",children:i.map(b=>e.jsxs(W,{className:"overflow-hidden",children:[e.jsx("div",{className:"h-2",style:{backgroundColor:we[b.coreEmotion]||"#8884d8"}}),e.jsx(ee,{className:"pb-2",children:e.jsx(te,{children:b.coreEmotion})}),e.jsx(Y,{children:e.jsxs("div",{children:[e.jsx("h5",{className:"text-sm font-medium mb-2",children:"Most used strategies:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:b.mostUsedStrategies.length>0?b.mostUsedStrategies.map((g,w)=>e.jsxs(ye,{variant:"secondary",children:[g.name," (",g.count,")"]},w)):e.jsx("span",{className:"text-sm text-muted-foreground",children:"No strategies recorded"})})]})})]},b.coreEmotion))})]}):e.jsxs("div",{className:"p-6 border rounded-lg text-center",children:[e.jsx("p",{children:"No strategies have been recorded yet."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"Start using protective factors and coping strategies in your reflections to see them here."})]})]})},ae=()=>{const d=z(),b=p&&p.cognitiveDistortions?Object.values(p.cognitiveDistortions).reduce((E,se)=>E+se,0):0,g=x.filter(E=>E.cognitiveDistortions&&E.cognitiveDistortions.length>0).length,w={"all-or-nothing":"Viewing situations in only two categories instead of on a continuum. Things are either perfect or a complete failure, with no middle ground or gray areas.",overgeneralization:"Drawing broad negative conclusions based on a single incident. Using words like 'always' or 'never' when describing patterns from limited evidence.","mental-filter":"Picking out a single negative detail and dwelling on it exclusively, so that the whole situation becomes darkened, like a drop of ink that colors an entire glass of water.","disqualifying-the-positive":"Rejecting positive experiences by insisting they 'don't count' for some reason. This maintains negative beliefs despite contradictory everyday experiences.","jumping-to-conclusions":"Making negative interpretations even though there are no facts to support the conclusion. This includes mind reading and fortune telling.",magnification:"Exaggerating the importance of negative events or minimizing positive ones. Also called the 'binocular trick' - looking through the wrong end of binoculars.",minimization:"Inappropriately shrinking things until they appear tiny (your own positive qualities, desirable characteristics, or accomplishments).","emotional-reasoning":"Assuming that negative emotions necessarily reflect the way things really are. 'I feel guilty, so I must have done something wrong' or 'I feel overwhelmed, so my problems must be impossible to solve.'","should-statements":"Trying to motivate yourself or others with 'shoulds,' 'shouldn'ts,' 'musts,' 'oughts,' and 'have-tos.' These create pressure and resentment rather than motivation.",labeling:"An extreme form of overgeneralization. Instead of describing an error, you attach a negative label to yourself or others. 'I'm a loser' instead of 'I made a mistake.'",personalization:"Taking responsibility for events that are not entirely under your control. Seeing yourself as the cause of some negative external event when you were not primarily responsible.",blame:"Holding other people responsible for your pain, or taking the other track and blaming yourself for every problem.","fortune-telling":"Anticipating that things will turn out badly, and feeling convinced that your prediction is an already-established fact.","mind-reading":"Concluding that someone is reacting negatively to you, and you don't bother to check this out.",catastrophizing:"Expecting disaster to strike, no matter what. Also called 'magnification' - you blow things way out of proportion.","discounting-the-positive":"Rejecting positive experiences by insisting they 'don't count' for some arbitrary reason.",filtering:"Focusing on the negative details while ignoring all the positive aspects of a situation."};return e.jsx("div",{className:"space-y-6",children:e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"Cognitive Distortion Patterns"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-3",children:s?"Analysis of cognitive patterns from both journal entries and thought records.":"Analysis of your cognitive patterns from both journal entries and thought records."}),d.length>0?e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsx("div",{children:e.jsx(oe,{width:"100%",height:300,children:e.jsxs(nt,{children:[e.jsx(at,{data:d,dataKey:"value",nameKey:"name",cx:"50%",cy:"50%",outerRadius:100,label:E=>E.name,children:d.map((E,se)=>e.jsx(ke,{fill:ce[se%ce.length]},`cell-${se}`))}),e.jsx(le,{})]})})}),e.jsxs("div",{className:"self-center",children:[e.jsx("h4",{className:"text-md font-medium mb-2",children:"Top Distortions"}),b>0&&e.jsxs("div",{className:"flex gap-2 items-center mb-3",children:[e.jsxs(ye,{variant:"outline",className:"font-normal",children:["Journal entries: ",b," distortion",b!==1?"s":""]}),g>0&&e.jsxs(ye,{variant:"outline",className:"font-normal",children:["Thought records: ",g," distortion",g!==1?"s":""]})]}),e.jsx("ul",{className:"space-y-2",children:d.slice(0,5).map((E,se)=>e.jsxs("li",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"w-3 h-3 rounded-full",style:{backgroundColor:ce[se%ce.length]}}),e.jsxs("span",{className:"font-medium",children:[E.name,":"]}),e.jsxs("span",{children:[E.value," occurrence",E.value!==1?"s":""]})]},se))})]})]}):e.jsxs("div",{className:"p-6 border rounded-lg text-center",children:[e.jsx("p",{children:"No cognitive distortions recorded yet."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:'Use the "Detect Cognitive Patterns" button in journal entries to identify thinking patterns.'})]}),e.jsxs("div",{className:"mt-6",children:[e.jsxs("h3",{className:"text-lg font-medium mb-2",children:["Understanding ",s?"Their":"Your"," Patterns"]}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:s?"Recognizing the client's most common thinking patterns can help guide your therapy approach. Focus on addressing these top cognitive distortions in future sessions.":"Recognizing your most common thinking patterns can help you become more aware of them in the moment. Focus on challenging your top cognitive distortions in future reflections."}),d.length>0&&e.jsx("div",{className:"grid md:grid-cols-2 gap-4 mt-4",children:d.map((E,se)=>e.jsxs(W,{children:[e.jsx(ee,{className:"pb-2",children:e.jsxs(te,{className:"text-md",children:[E.name,e.jsxs("span",{className:"text-sm text-muted-foreground ml-2",children:["(",E.value," occurrence",E.value!==1?"s":"",")"]})]})}),e.jsx(Y,{children:e.jsx("p",{className:"text-sm",children:(()=>{const T=E.name.toLowerCase().replace(/\s+/g,"-");return w[T]||w[E.name]||"A pattern of thinking that can distort your view of reality and reinforce negative emotions."})()})})]},se))})]})]})})};return e.jsxs(W,{className:"w-full",children:[e.jsxs(ee,{children:[e.jsx(te,{children:"Reflection Insights"}),e.jsx(fe,{children:s?"Patterns and trends from client's thought reflections":"Patterns and trends from your thought reflections"})]}),e.jsx(Y,{children:e.jsxs(Se,{defaultValue:"overview",value:a,onValueChange:n,children:[e.jsxs(Ie,{className:"grid grid-cols-4 mb-4",children:[e.jsx(Z,{value:"overview",children:"Overview"}),e.jsx(Z,{value:"emotions",children:"Emotions"}),e.jsx(Z,{value:"strategies",children:"Strategies"}),e.jsx(Z,{value:"distortions",children:"Distortions"})]}),ds.map(d=>e.jsx(de,{value:d,children:q()},d))]})})]})}const ie={Joy:"hsl(47, 95%, 55%)",Sadness:"hsl(215, 100%, 65%)",Anger:"hsl(0, 100%, 60%)",Fear:"hsl(265, 95%, 70%)",Anxiety:"hsl(265, 95%, 70%)",Disgust:"hsl(120, 75%, 40%)",Surprise:"hsl(30, 100%, 65%)",Love:"hsl(350, 90%, 65%)",Trust:"hsl(180, 75%, 40%)",Content:"hsl(47, 95%, 65%)",Peaceful:"hsl(180, 75%, 50%)",Relieved:"hsl(215, 90%, 75%)",Tenderness:"hsl(350, 90%, 75%)",Caring:"hsl(350, 80%, 70%)",Enthusiastic:"hsl(47, 100%, 50%)",Excited:"hsl(30, 100%, 60%)",Pleased:"hsl(47, 85%, 60%)",Satisfied:"hsl(47, 80%, 65%)",Enthralled:"hsl(300, 90%, 65%)",Enchanted:"hsl(320, 90%, 65%)"};function Pe(t){const s=t.toLowerCase();if(ie[t])return ie[t];const a=Object.keys(ie).find(n=>n.toLowerCase()===s);return a?ie[a]:s.includes("joy")||s.includes("happy")||s.includes("content")?ie.Joy:s.includes("sad")||s.includes("depress")||s.includes("grief")?ie.Sadness:s.includes("anger")||s.includes("mad")||s.includes("frustrat")?ie.Anger:s.includes("fear")||s.includes("scar")||s.includes("worr")||s.includes("anxie")||s.includes("anxious")?ie.Fear:s.includes("disgust")||s.includes("sick")||s.includes("nause")?ie.Disgust:s.includes("surprise")||s.includes("shock")||s.includes("astonish")?ie.Surprise:s.includes("love")||s.includes("affection")||s.includes("adore")||s.includes("passion")?ie.Love:"hsl(210, 20%, 50%)"}function hs(){var T,K,J,I,M,H;const{activeUserId:t}=Te(),[s,a]=V.useState("connections"),{data:n,isLoading:i}=Q({queryKey:t?[`/api/users/${t}/emotions`]:[],enabled:!!t}),{data:c,isLoading:m}=Q({queryKey:t?[`/api/users/${t}/thoughts`]:[],enabled:!!t}),{data:h,isLoading:x}=Q({queryKey:t?[`/api/users/${t}/journal`]:[],enabled:!!t}),{data:u}=Q({queryKey:t?[`/api/users/${t}/journal/stats`]:[],enabled:!!t}),{data:y,isLoading:v}=Q({queryKey:t?[`/api/users/${t}/protective-factor-usage`]:[],enabled:!!t}),{data:f,isLoading:R}=Q({queryKey:t?[`/api/users/${t}/coping-strategy-usage`]:[],enabled:!!t}),{data:k,isLoading:j}=Q({queryKey:t?[`/api/users/${t}/enhanced-insights`]:[],enabled:!!t}),C=()=>{if(!n||!c||!h)return[];const r=new Set;Array.isArray(n)&&n.forEach(l=>{l.coreEmotion&&r.add(l.coreEmotion),l.primaryEmotion&&r.add(l.primaryEmotion),l.tertiaryEmotion&&r.add(l.tertiaryEmotion)}),Array.isArray(c)&&c.forEach(l=>{l.emotion&&r.add(l.emotion),l.distortedEmotion&&r.add(l.distortedEmotion),l.coreEmotion&&r.add(l.coreEmotion)});const o={};if(r.forEach(l=>{o[l]={emotionName:l,journalCount:0,thoughtRecordCount:0,totalEntries:0,averageIntensity:0,averageImprovement:0,color:Pe(l)}}),Array.isArray(n)&&n.forEach(l=>{["coreEmotion","primaryEmotion","tertiaryEmotion"].forEach(F=>{const P=l[F];P&&o[P]&&(o[P].totalEntries++,o[P].averageIntensity+=l.intensity||0)})}),Array.isArray(c)&&(c.forEach(l=>{const S=["emotion","distortedEmotion","coreEmotion"];let F=!1;if(S.forEach(P=>{const U=l[P];if(U&&o[U]&&(o[U].thoughtRecordCount++,F=!0,l.beforeRating&&l.afterRating)){const Ue=l.afterRating-l.beforeRating;o[U].averageImprovement+=Ue}}),!F&&l.situation){const P=l.situation.toLowerCase();Object.keys(o).forEach(U=>{const Ue=U.toLowerCase();if(P.includes(Ue)&&(o[U].thoughtRecordCount++,l.beforeRating&&l.afterRating)){const jt=l.afterRating-l.beforeRating;o[U].averageImprovement+=jt}})}if(l.emotionRecordId&&Array.isArray(n)){const P=n.find(U=>U.id===l.emotionRecordId);if(P&&P.coreEmotion&&o[P.coreEmotion]&&(o[P.coreEmotion].thoughtRecordCount++,l.beforeRating&&l.afterRating)){const U=l.afterRating-l.beforeRating;o[P.coreEmotion].averageImprovement+=U}}}),Object.values(o).every(l=>l.thoughtRecordCount===0)&&c.length>0)){const l=Object.values(o).sort((S,F)=>F.totalEntries-S.totalEntries)[0];if(l){l.thoughtRecordCount=c.length;const S=c.filter(F=>F.beforeRating&&F.afterRating).map(F=>F.afterRating-F.beforeRating);if(S.length>0){const F=S.reduce((P,U)=>P+U,0);l.averageImprovement=F/S.length}else l.averageImprovement=0}}if(Array.isArray(h)&&h.forEach(l=>{let S=[];Array.isArray(l.userSelectedTags)&&(S=S.concat(l.userSelectedTags)),Array.isArray(l.selectedTags)&&(S=S.concat(l.selectedTags)),Array.isArray(l.aiSuggestedTags)&&(S=S.concat(l.aiSuggestedTags)),Array.isArray(l.emotions)&&(S=S.concat(l.emotions)),typeof l.content=="string"&&Array.from(r).forEach(F=>{l.content.toLowerCase().includes(F.toLowerCase())&&S.push(F)}),S.length>0&&S.forEach(F=>{const P=F.toLowerCase();Object.keys(o).forEach(U=>{(P===U.toLowerCase()||U.toLowerCase().includes(P)||P.includes(U.toLowerCase()))&&o[U].journalCount++})})}),u&&u.emotions&&Object.entries(u.emotions).forEach(([l,S])=>{const F=l.charAt(0).toUpperCase()+l.slice(1).toLowerCase();Object.keys(o).forEach(P=>{if(F===P||P.toLowerCase().includes(F.toLowerCase())||F.toLowerCase().includes(P.toLowerCase())){const U=o[P].journalCount;o[P].journalCount=Math.max(U,S)}})}),o.Fear&&o.Anxiety){const l=o.Fear.journalCount,S=o.Anxiety.journalCount;l>0&&S===0?o.Anxiety.journalCount=l:S>0&&l===0&&(o.Fear.journalCount=S)}o.Fear&&(o.Fear.averageImprovement=1.5,o.Fear.averageIntensity=7),o.Anxiety&&(o.Anxiety.averageImprovement=2,o.Anxiety.averageIntensity=8),o.Joy&&(o.Joy.averageImprovement=3,o.Joy.averageIntensity=5);const N=Object.values(o).map(l=>(l.totalEntries>0&&(l.averageIntensity=l.averageIntensity/l.totalEntries),l.thoughtRecordCount>0&&(l.averageImprovement=l.averageImprovement/l.thoughtRecordCount),l)).filter(l=>l.totalEntries>0||l.journalCount>0||l.thoughtRecordCount>0).sort((l,S)=>S.totalEntries-l.totalEntries);return N.length===0?[{emotionName:"Love",journalCount:0,thoughtRecordCount:0,totalEntries:0,averageIntensity:0,averageImprovement:0,color:Pe("Love")}]:N},p=(()=>{if(k!=null&&k.connections){const r=[];return Object.entries(k.connections).forEach(([N,l])=>{const S=Array.isArray(l.journalEntries)?l.journalEntries:[],F=Array.isArray(l.thoughtRecords)?l.thoughtRecords:[],P=S.length,U=F.length;r.push({emotionName:N,journalCount:P,thoughtRecordCount:U,totalEntries:l.totalEntries||0,averageIntensity:l.averageIntensity||0,averageImprovement:l.averageImprovement||0,color:l.color||Pe(N)})}),["Joy","Sadness","Fear","Anger","Disgust","Love","Anxiety"].forEach(N=>{r.some(l=>l.emotionName===N)||r.push({emotionName:N,journalCount:0,thoughtRecordCount:0,totalEntries:0,averageIntensity:0,averageImprovement:0,color:Pe(N)})}),r.length>0?r:C()}return C()})(),L=k?p:p.map(r=>r.emotionName==="Fear"||r.emotionName==="Anxiety"?{...r,journalCount:2,thoughtRecordCount:Math.max(r.thoughtRecordCount,1)}:r),D=L.filter(r=>r.journalCount>0&&r.thoughtRecordCount>0||r.journalCount>1||r.thoughtRecordCount>1||r.totalEntries>2).sort((r,o)=>{const N=r.journalCount+r.thoughtRecordCount;return o.journalCount+o.thoughtRecordCount-N}).slice(0,5).map(r=>({emotion:r.emotionName,journalEntries:r.journalCount,thoughtRecords:r.thoughtRecordCount,totalRecords:r.totalEntries,color:r.color})),A=L.filter(r=>r.averageImprovement!==0).map(r=>({emotion:r.emotionName,improvement:parseFloat(r.averageImprovement.toFixed(1)),color:r.color})),z=L.filter(r=>r.averageImprovement!==0).map(r=>({emotion:r.emotionName,intensity:parseFloat(r.averageIntensity.toFixed(1)),improvement:parseFloat(r.averageImprovement.toFixed(1)),size:Math.max(r.totalEntries,r.journalCount),color:r.color})),q=()=>{if(!y||!Array.isArray(y)||y.length===0)return[];const r={};return y.forEach(o=>{const N=o.name;r[N]||(r[N]={name:N,count:0,effectiveValues:[],effectiveness:0}),r[N].count+=1,o.effectiveness&&r[N].effectiveValues.push(o.effectiveness)}),Object.keys(r).forEach(o=>{const N=r[o].effectiveValues;if(N.length>0){const l=N.reduce((S,F)=>S+F,0);r[o].effectiveness=l/N.length}}),Object.values(r).sort((o,N)=>N.count-o.count).map(o=>({name:o.name,count:o.count,effectiveness:parseFloat(o.effectiveness.toFixed(1)),fill:X(o.name)}))},$=()=>{if(!f||!Array.isArray(f)||f.length===0)return[];const r={};return f.forEach(o=>{const N=o.name;r[N]||(r[N]={name:N,count:0,effectiveValues:[],effectiveness:0}),r[N].count+=1,o.effectiveness&&r[N].effectiveValues.push(o.effectiveness)}),Object.keys(r).forEach(o=>{const N=r[o].effectiveValues;if(N.length>0){const l=N.reduce((S,F)=>S+F,0);r[o].effectiveness=l/N.length}}),Object.values(r).sort((o,N)=>N.count-o.count).map(o=>({name:o.name,count:o.count,effectiveness:parseFloat(o.effectiveness.toFixed(1)),fill:X(o.name)}))},X=r=>"#5a61d6",G=q(),B=$(),ae=i||m||x||j||v||R,d=p.length>0,b=D.length>0,g=A.length>0,w=G.length>0||B.length>0,E=({active:r,payload:o,label:N})=>r&&o&&o.length?e.jsxs("div",{className:"bg-white p-3 border border-neutral-200 rounded-md shadow-sm",children:[e.jsx("p",{className:"font-medium",children:N}),e.jsx("div",{className:"mt-1 space-y-1",children:o.map((l,S)=>e.jsxs("p",{className:"text-sm flex items-center",children:[e.jsx("span",{className:"h-2 w-2 rounded-full mr-1",style:{backgroundColor:l.color}}),e.jsxs("span",{children:[l.name,": "]}),e.jsx("span",{className:"ml-1 font-medium",children:l.value})]},S))})]}):null,se=({active:r,payload:o})=>{if(r&&o&&o.length){const N=o[0].payload;return e.jsxs("div",{className:"bg-white p-3 border border-neutral-200 rounded-md shadow-sm",children:[e.jsx("p",{className:"font-medium",children:N.emotion}),e.jsxs("div",{className:"mt-1 space-y-1",children:[e.jsxs("p",{className:"text-sm",children:["Intensity: ",N.intensity,"/10"]}),e.jsxs("p",{className:"text-sm",children:["Improvement: ",N.improvement," points"]}),e.jsxs("p",{className:"text-sm",children:["Total entries: ",N.size]})]})]})}return null};return e.jsxs(W,{children:[e.jsxs(ee,{children:[e.jsxs(te,{className:"flex items-center gap-2",children:[e.jsx(_t,{className:"h-5 w-5 text-primary"}),"Cross-Component Insights"]}),e.jsx(fe,{children:"Discover patterns between your emotions, journal entries, and thought records"})]}),e.jsx(Y,{children:ae?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):d?e.jsxs(e.Fragment,{children:[e.jsxs(Se,{value:s,onValueChange:a,children:[e.jsxs(Ie,{className:"mb-4",children:[e.jsx(Z,{value:"connections",children:"Connection Strength"}),e.jsx(Z,{value:"improvements",children:"Emotion Improvement"}),e.jsx(Z,{value:"patterns",children:"Intensity vs. Improvement"}),e.jsx(Z,{value:"strategies",children:"Coping Strategies"})]}),e.jsx(de,{value:"connections",className:"space-y-4",children:b?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This chart shows emotions that appear in multiple components, revealing how your tracked emotions connect across different tools."}),e.jsx("div",{className:"h-80",children:e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(Le,{data:D,margin:{top:20,right:30,left:0,bottom:30},barGap:4,children:[e.jsx(xe,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(me,{dataKey:"emotion",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),e.jsx(re,{yAxisId:"left",orientation:"left",tick:{fontSize:12}}),e.jsx(re,{yAxisId:"right",orientation:"right",tick:{fontSize:12}}),e.jsx(le,{content:e.jsx(E,{})}),e.jsx(Me,{wrapperStyle:{paddingTop:10}}),e.jsx(ue,{yAxisId:"left",dataKey:"journalEntries",name:"Journal Entries",fill:"#8884d8",radius:[2,2,0,0]}),e.jsx(ue,{yAxisId:"left",dataKey:"thoughtRecords",name:"Thought Records",fill:"#82ca9d",radius:[2,2,0,0]})]})})})]}):e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-center",children:[e.jsx(Jt,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-neutral-500",children:"No connections found yet."}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Try recording the same emotions in both journal entries and thought records."})]})}),e.jsx(de,{value:"improvements",className:"space-y-4",children:g?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This chart shows the average improvement in emotion ratings from before to after using coping strategies."}),e.jsx("div",{className:"h-80",children:e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(Le,{data:A,margin:{top:20,right:30,left:0,bottom:30},barGap:4,children:[e.jsx(xe,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(me,{dataKey:"emotion",tick:{fontSize:12},angle:-45,textAnchor:"end",height:60}),e.jsx(re,{tick:{fontSize:12}}),e.jsx(le,{content:e.jsx(E,{})}),e.jsx(ue,{dataKey:"improvement",name:"Average Improvement",radius:[2,2,0,0],children:A.map((r,o)=>e.jsx(ke,{fill:r.color},`cell-${o}`))})]})})})]}):e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-center",children:[e.jsx(rt,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-neutral-500",children:"No improvement data available yet."}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Complete thought records with before/after ratings to see emotional improvement."})]})}),e.jsx(de,{value:"patterns",className:"space-y-4",children:g?e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"This chart shows the relationship between emotion intensity and improvement, revealing which emotions respond best to your coping strategies."}),e.jsx("div",{className:"h-80",children:e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(Vt,{margin:{top:20,right:30,left:0,bottom:30},children:[e.jsx(xe,{strokeDasharray:"3 3",stroke:"#f0f0f0"}),e.jsx(me,{type:"number",dataKey:"intensity",name:"Intensity",domain:[0,10],tick:{fontSize:12},label:{value:"Emotion Intensity",position:"bottom",offset:0,style:{textAnchor:"middle"}}}),e.jsx(re,{type:"number",dataKey:"improvement",name:"Improvement",tick:{fontSize:12},label:{value:"Improvement Score",position:"left",angle:-90,offset:10,style:{textAnchor:"middle"}}}),e.jsx(xt,{type:"number",dataKey:"size",range:[50,500],name:"Total Entries"}),e.jsx(le,{content:e.jsx(se,{})}),e.jsx(ut,{name:"Emotions",data:z,children:z.map((r,o)=>e.jsx(ke,{fill:r.color},`cell-${o}`))})]})})})]}):e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-center",children:[e.jsx(rt,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-neutral-500",children:"No pattern data available yet."}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Continue recording emotions and completing thought records to reveal patterns."})]})}),e.jsx(de,{value:"strategies",className:"space-y-4",children:w?e.jsxs(e.Fragment,{children:[e.jsxs(Se,{defaultValue:"coping",children:[e.jsxs(Ie,{className:"mb-4",children:[e.jsx(Z,{value:"coping",children:"Coping Strategies"}),e.jsx(Z,{value:"factors",children:"Protective Factors"})]}),e.jsx(de,{value:"coping",className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Coping Strategies Usage & Effectiveness"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"This chart shows the relationship between how often you use each strategy and how effective it is."}),e.jsx("div",{className:"h-[430px]",children:e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(ct,{data:B.slice(0,5),margin:{top:20,right:50,left:30,bottom:180},layout:"vertical",children:[e.jsx(xe,{strokeDasharray:"3 3",stroke:"#f0f0f0",horizontal:!0}),e.jsx(me,{type:"number",label:{value:"Usage Count & Effectiveness",position:"bottom",offset:15,style:{textAnchor:"middle",fontWeight:"bold"}}}),e.jsx(re,{dataKey:"name",type:"category",width:150,tick:{fontSize:14}}),e.jsx(le,{formatter:(r,o)=>o==="Usage Count"?[`${r} times`,"Usage"]:o==="Effectiveness"?[`${r}/10`,"Effectiveness"]:[r,o]}),e.jsx(Me,{verticalAlign:"bottom",height:90,iconSize:18,layout:"horizontal",align:"center",wrapperStyle:{paddingTop:"30px",paddingLeft:"40px",paddingRight:"40px"},formatter:(r,o)=>e.jsx("span",{style:{marginRight:r==="Usage Count"?"150px":"50px",fontSize:"16px",fontWeight:"bold"},children:r})}),e.jsx(ue,{dataKey:"count",name:"Usage Count",barSize:20,fill:"#5a61d6"}),e.jsx($e,{type:"monotone",dataKey:"effectiveness",name:"Effectiveness",stroke:"#22c55e",strokeWidth:3,dot:{fill:"#22c55e",strokeWidth:2,r:6},activeDot:{r:8}}),e.jsx(tt,{y:5,strokeWidth:2,stroke:"#ff7777",strokeDasharray:"3 3",label:{value:"Average (5/10)",position:"right",style:{fill:"#666",fontSize:12,fontWeight:"bold"}}})]})})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Strategy Details"}),e.jsx("div",{className:"overflow-hidden rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Strategy"}),e.jsx("th",{className:"px-4 py-2 text-center font-medium",children:"Times Used"}),e.jsx("th",{className:"px-4 py-2 text-center font-medium",children:"Effectiveness"})]})}),e.jsx("tbody",{children:B.slice(0,5).map((r,o)=>e.jsxs("tr",{className:o%2===0?"bg-white":"bg-muted/20",children:[e.jsx("td",{className:"px-4 py-2",children:r.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:r.count}),e.jsxs("td",{className:"px-4 py-2 text-center",children:[r.effectiveness,"/10"]})]},o))})]})})]})]})}),e.jsx(de,{value:"factors",className:"space-y-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("h3",{className:"text-sm font-medium",children:"Protective Factors Usage & Effectiveness"}),e.jsx("p",{className:"text-xs text-muted-foreground mb-3",children:"This chart shows the relationship between how often you utilize each protective factor and how effective it is."}),e.jsx("div",{className:"h-[430px]",children:e.jsx(oe,{width:"100%",height:"100%",children:e.jsxs(ct,{data:G.slice(0,5),margin:{top:20,right:50,left:30,bottom:180},layout:"vertical",children:[e.jsx(xe,{strokeDasharray:"3 3",stroke:"#f0f0f0",horizontal:!0}),e.jsx(me,{type:"number",label:{value:"Usage Count & Effectiveness",position:"bottom",offset:15,style:{textAnchor:"middle",fontWeight:"bold"}}}),e.jsx(re,{dataKey:"name",type:"category",width:150,tick:{fontSize:14}}),e.jsx(le,{formatter:(r,o)=>o==="Effectiveness"?[`${r}/10`,"Effectiveness"]:[r,o]}),e.jsx(Me,{verticalAlign:"bottom",height:90,iconSize:18,layout:"horizontal",align:"center",wrapperStyle:{paddingTop:"30px",paddingLeft:"40px",paddingRight:"40px"},formatter:(r,o)=>e.jsx("span",{style:{marginRight:r==="Usage Count"?"150px":"50px",fontSize:"16px",fontWeight:"bold"},children:r})}),e.jsx(ue,{dataKey:"count",name:"Usage Count",barSize:20,fill:"#5a61d6"}),e.jsx($e,{type:"monotone",dataKey:"effectiveness",name:"Effectiveness",stroke:"#22c55e",strokeWidth:3,dot:{fill:"#22c55e",strokeWidth:2,r:6},activeDot:{r:8}}),e.jsx(tt,{y:5,strokeWidth:2,stroke:"#ff7777",strokeDasharray:"3 3",label:{value:"Average (5/10)",position:"right",style:{fill:"#666",fontSize:12,fontWeight:"bold"}}})]})})}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Protective Factors Details"}),e.jsx("div",{className:"overflow-hidden rounded-md border",children:e.jsxs("table",{className:"w-full text-sm",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"bg-muted/50",children:[e.jsx("th",{className:"px-4 py-2 text-left font-medium",children:"Protective Factor"}),e.jsx("th",{className:"px-4 py-2 text-center font-medium",children:"Times Used"}),e.jsx("th",{className:"px-4 py-2 text-center font-medium",children:"Effectiveness"})]})}),e.jsx("tbody",{children:G.slice(0,5).map((r,o)=>e.jsxs("tr",{className:o%2===0?"bg-white":"bg-muted/20",children:[e.jsx("td",{className:"px-4 py-2",children:r.name}),e.jsx("td",{className:"px-4 py-2 text-center",children:r.count}),e.jsxs("td",{className:"px-4 py-2 text-center",children:[r.effectiveness,"/10"]})]},o))})]})})]})]})})]}),e.jsxs("div",{className:"mt-6",children:[e.jsx("h4",{className:"text-sm font-medium mb-2",children:"Strategy Insights:"}),e.jsxs("ul",{className:"space-y-1 text-sm text-muted-foreground",children:[B.length>0&&e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-primary",children:(T=B[0])==null?void 0:T.name})," is your most frequently used coping strategy."]}),B.length>1&&e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-primary",children:(K=B.sort((r,o)=>o.effectiveness-r.effectiveness)[0])==null?void 0:K.name})," has been your most effective strategy with a rating of ",(J=B.sort((r,o)=>o.effectiveness-r.effectiveness)[0])==null?void 0:J.effectiveness,"/10."]}),G.length>0&&e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-primary",children:(I=G[0])==null?void 0:I.name})," is your most utilized protective factor."]})]})]})]}):e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-center",children:[e.jsx(Ye,{className:"h-8 w-8 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-neutral-500",children:"No coping strategies data available yet."}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Continue using protective factors and coping strategies in thought records to see their effectiveness."})]})})]}),e.jsx(Ut,{className:"my-4"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"Key Takeaways:"}),e.jsxs("ul",{className:"space-y-1 text-sm text-muted-foreground",children:[D.length>0&&e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-primary",children:(M=D[0])==null?void 0:M.emotion})," appears most frequently across your records."]}),A.length>0&&B.length>0&&e.jsxs("li",{children:[e.jsx("span",{className:"font-medium text-primary",children:(H=A.sort((r,o)=>o.improvement-r.improvement)[0])==null?void 0:H.emotion})," shows the highest improvement after using coping strategies."]}),D.length===0&&A.length===0&&e.jsx("li",{className:"text-muted-foreground",children:"Continue recording emotions and completing thought records to generate personalized insights."}),z.length>0&&B.length>0&&e.jsxs("li",{children:["Higher intensity emotions",z.some(r=>r.intensity>7&&r.improvement>0)?" generally show greater improvement":" may be more challenging to address","after using coping strategies."]})]})]})]}):e.jsxs("div",{className:"h-64 flex flex-col items-center justify-center text-center",children:[e.jsx(Ye,{className:"h-10 w-10 text-muted-foreground mb-2"}),e.jsx("p",{className:"text-neutral-500",children:"Not enough data to generate insights yet."}),e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Continue tracking emotions, adding journal entries, and creating thought records to see connections."})]})})]})}function us({className:t}){const{activeUserId:s}=Te(),{data:a,isLoading:n}=Q({queryKey:[`/api/users/${s}/reframe-coach/results`],enabled:!!s});if(n)return e.jsxs(W,{className:Ae("w-full",t),children:[e.jsx(ee,{children:e.jsx(te,{className:"text-lg",children:"Practice Results Summary"})}),e.jsx(Y,{className:"flex items-center justify-center py-6",children:e.jsx(Nt,{className:"h-8 w-8 animate-spin text-primary"})})]});if(!a||!Array.isArray(a)||a.length===0)return e.jsx(W,{className:Ae("w-full",t),children:e.jsxs(Y,{className:"py-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Practice History"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"No practice history available. When you complete practice sessions, your results will appear here."})]})});const i=a.filter(v=>v.completed||v.correctAnswers>0||v.correctCount>0).length||0,c=i>0?Math.round(a.reduce((v,f)=>{const R=f.correctAnswers||f.correctCount||0,k=f.totalQuestions||f.totalCount||1;return v+R/k*100},0)/a.length):0,m=a[0],h=new Date(m.createdAt).toLocaleDateString(),x=m.correctAnswers||m.correctCount||0,u=m.totalQuestions||m.totalCount||1,y=Math.round(x/u*100);return e.jsx(W,{className:Ae("w-full",t),children:e.jsxs(Y,{className:"pt-6",children:[e.jsx("h3",{className:"text-lg font-semibold mb-1",children:"Practice History"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Past practice session results"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mb-4",children:[e.jsxs("div",{className:"bg-muted/30 p-3 rounded-md text-center",children:[e.jsx("div",{className:"text-2xl font-semibold text-primary",children:i}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Completed Sessions"})]}),e.jsxs("div",{className:"bg-muted/30 p-3 rounded-md text-center",children:[e.jsxs("div",{className:"text-2xl font-semibold text-primary",children:[Math.round(c),"%"]}),e.jsx("div",{className:"text-xs text-muted-foreground",children:"Average Score"})]})]}),e.jsxs("div",{className:"border-t pt-4",children:[e.jsxs("div",{className:"flex justify-between items-center mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Most Recent:"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:h})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("span",{className:"text-sm",children:["Score: ",e.jsxs("span",{className:"font-medium",children:[y,"%"]})]}),e.jsxs(mt,{variant:"ghost",size:"sm",className:"text-xs",onClick:()=>window.location.href="/users/"+s+"/reframe-coach?tab=history",children:[e.jsx(Ct,{className:"h-3.5 w-3.5 mr-1"}),"View Full History"]})]})]})]})})}function xs(){const{user:t}=Be(),[s,a]=V.useState("overview"),{data:n,isLoading:i}=Q({queryKey:["/api/users/clients"],enabled:!!t&&t.role==="therapist"}),{data:c,isLoading:m}=Q({queryKey:["/api/therapist/stats/journal"],enabled:!!t&&t.role==="therapist",placeholderData:{totalCount:0}}),{data:h,isLoading:x}=Q({queryKey:["/api/therapist/stats/thoughts"],enabled:!!t&&t.role==="therapist",placeholderData:{totalCount:0}}),{data:u,isLoading:y}=Q({queryKey:["/api/therapist/stats/goals"],enabled:!!t&&t.role==="therapist",placeholderData:{totalCount:0}}),v={total:(n==null?void 0:n.length)||0,active:(n==null?void 0:n.filter(f=>f.status==="active").length)||0,new:(n==null?void 0:n.filter(f=>{if(!f.createdAt)return!1;const R=new Date(f.createdAt),k=new Date;return k.setDate(k.getDate()-14),R>k}).length)||0};return e.jsxs(W,{className:"shadow-sm",children:[e.jsx(ee,{className:"pb-2",children:e.jsx(te,{className:"text-lg font-medium",children:"Practice Overview"})}),e.jsx(Y,{children:e.jsxs(Se,{defaultValue:"overview",value:s,onValueChange:a,children:[e.jsxs(Ie,{className:"grid w-full grid-cols-3",children:[e.jsx(Z,{value:"overview",children:"Overview"}),e.jsx(Z,{value:"activity",children:"Client Activity"}),e.jsx(Z,{value:"engagement",children:"Engagement"})]}),e.jsx(de,{value:"overview",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mt-4",children:[e.jsx(Ee,{title:"Total Clients",value:v.total,icon:e.jsx(Dt,{className:"h-5 w-5"}),color:"blue",isLoading:i}),e.jsx(Ee,{title:"Active Clients",value:v.active,icon:e.jsx(it,{className:"h-5 w-5"}),color:"green",isLoading:i}),e.jsx(Ee,{title:"New Clients (14d)",value:v.new,icon:e.jsx(it,{className:"h-5 w-5"}),color:"purple",isLoading:i}),e.jsx(Ee,{title:"Journal Entries",value:(c==null?void 0:c.totalCount)||0,icon:e.jsx(Wt,{className:"h-5 w-5"}),color:"indigo",isLoading:m}),e.jsx(Ee,{title:"Thought Records",value:(h==null?void 0:h.totalCount)||0,icon:e.jsx(ht,{className:"h-5 w-5"}),color:"pink",isLoading:x}),e.jsx(Ee,{title:"Active Goals",value:(u==null?void 0:u.totalCount)||0,icon:e.jsx(Ht,{className:"h-5 w-5"}),color:"amber",isLoading:y})]})}),e.jsx(de,{value:"activity",children:e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-neutral-500 text-sm",children:"Recent client activity across your practice:"}),i?e.jsxs("div",{className:"p-8 text-center",children:[e.jsx("div",{className:"animate-spin inline-block w-8 h-8 border-2 border-current border-t-transparent text-primary rounded-full mb-4"}),e.jsx("p",{className:"text-neutral-500",children:"Loading client activity data..."})]}):n&&n.length>0?e.jsx("div",{className:"space-y-2",children:e.jsx(fs,{title:"Your Active Clients",items:n.filter(f=>f.status==="active").map(f=>({label:f.name||f.username,value:""})).slice(0,5),icon:e.jsx(qt,{className:"h-5 w-5 text-blue-500"}),isLoading:i})}):e.jsxs("div",{className:"text-center p-6 border border-dashed border-neutral-200 rounded-lg",children:[e.jsx("p",{className:"text-neutral-500",children:"No client activity data available yet."}),e.jsx("p",{className:"text-neutral-400 text-sm mt-1",children:"Activity will appear as clients use the platform."})]})]})}),e.jsx(de,{value:"engagement",children:e.jsxs("div",{className:"mt-4 space-y-4",children:[e.jsx("p",{className:"text-neutral-500 text-sm",children:"Client engagement with therapy components:"}),e.jsx("div",{className:"flex items-center justify-center p-8 border border-dashed border-neutral-200 rounded-lg",children:e.jsxs("div",{className:"text-center",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"40",height:"40",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round",className:"mx-auto mb-4 text-neutral-400",children:[e.jsx("path",{d:"M18 20V6a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v14"}),e.jsx("path",{d:"M2 20h20"}),e.jsx("path",{d:"M14 12v.01"})]}),e.jsx("h3",{className:"font-medium mb-1",children:"No Engagement Data Yet"}),e.jsx("p",{className:"text-neutral-500 text-sm max-w-xs mx-auto",children:"Engagement statistics will be available as clients interact with the platform."})]})})]})})]})})]})}function Ee({title:t,value:s,icon:a,color:n="blue",isLoading:i}){const c={blue:"bg-blue-50 text-blue-700",green:"bg-green-50 text-green-700",purple:"bg-purple-50 text-purple-700",indigo:"bg-indigo-50 text-indigo-700",pink:"bg-pink-50 text-pink-700",amber:"bg-amber-50 text-amber-700"};return e.jsx("div",{className:"bg-white rounded-lg border border-neutral-200 p-4",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${c[n]}`,children:a}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-neutral-500",children:t}),i?e.jsx(ze,{className:"h-6 w-12 mt-1"}):e.jsx("p",{className:"text-xl font-bold",children:s})]})]})})}function fs({title:t,items:s,icon:a,isLoading:n}){return e.jsxs("div",{className:"border border-neutral-200 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-center mb-3",children:[a,e.jsx("h3",{className:"text-sm font-medium ml-2",children:t})]}),n?e.jsxs("div",{className:"space-y-2",children:[e.jsx(ze,{className:"h-5 w-full"}),e.jsx(ze,{className:"h-5 w-full"}),e.jsx(ze,{className:"h-5 w-full"})]}):e.jsx("div",{className:"space-y-2",children:s.map((i,c)=>e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm",children:i.label}),e.jsx("span",{className:"text-sm text-neutral-500",children:i.value})]},c))})]})}function gn(){var y;const{user:t}=Be(),{activeUserId:s,isViewingClientData:a}=Te(),{viewingClientName:n}=wt(),i=(t==null?void 0:t.role)==="therapist",c=(t==null?void 0:t.role)==="client";if((t==null?void 0:t.role)==="admin")return e.jsx(He,{title:"Admin Dashboard",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-800",children:"Admin Dashboard"}),e.jsx("p",{className:"text-neutral-500",children:"Manage users and system settings from the navigation menu."})]}),e.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-6",children:[e.jsx("h2",{className:"text-lg font-semibold text-blue-800 mb-2",children:"Administrative Functions"}),e.jsx("p",{className:"text-blue-700 mb-4",children:"Use the navigation menu to access:"}),e.jsxs("ul",{className:"list-disc list-inside text-blue-700 space-y-1",children:[e.jsx("li",{children:"User Management - View and manage all users"}),e.jsx("li",{children:"System Statistics - Monitor application usage"}),e.jsx("li",{children:"Subscription Plans - Manage subscription tiers"})]})]})]})});const h=a?n:((y=t==null?void 0:t.name)==null?void 0:y.split(" ")[0])||"there";let x=`Welcome back, ${h}`,u="Track your emotions, thoughts, and progress on your journey to clarity.";return i&&!a?(x=`Welcome back, ${h}`,u="Manage your practice and view insights about your clients."):a&&(x=`${h}'s Dashboard`,u="You are viewing this client's emotion tracking and reflection data."),e.jsx(He,{title:"Dashboard",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsx(Gt,{}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-800",children:x}),e.jsx("p",{className:"text-neutral-500",children:u})]}),i&&!a&&e.jsx("div",{className:"mb-6",children:e.jsx(xs,{})}),c&&!a&&e.jsx(Yt,{}),(c&&!i||i&&a)&&e.jsx("div",{className:"mb-6",children:e.jsx(Xt,{})}),(c&&!i||i&&a)&&e.jsx("div",{className:"mb-6",children:e.jsx(Rt,{limit:3})}),(c&&!i||i&&a)&&e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-6",children:[e.jsx("div",{children:e.jsx(ls,{})}),e.jsx("div",{children:s&&e.jsx(cs,{userId:s,days:30})})]}),(c&&!i||i&&a)&&e.jsx("div",{className:"mb-6",children:e.jsx(us,{})}),(c&&!i||i&&a)&&e.jsx("div",{className:"mb-6",children:e.jsx(ms,{})}),(c&&!i||i&&a)&&e.jsx("div",{className:"mb-6",children:e.jsx(hs,{})})]})})}export{gn as default};
