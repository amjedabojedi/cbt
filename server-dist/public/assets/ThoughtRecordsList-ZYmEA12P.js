import{c as Le,n as ie,y as we,m as Ce,j as e,B as o,i as We,h as ne,u as Te,r as N,q as _e,D as He,C as M,e as ee,f as R,a as B,g as xe}from"./index-BJDVYPr2.js";import{u as se}from"./useQuery-CVl6tFXz.js";import{u as De}from"./useMutation-4_CoT2bx.js";import{u as Ae}from"./use-active-user-CkIppDip.js";import{u as ze}from"./use-refresh-data-Dq9XIZaR.js";import{D as F,a as I,b as H,c as z,d as Y,e as Ye}from"./dialog-BkbRhY2O.js";import{A as Je,a as Re,b as Ke,c as Ue,d as Qe,e as Ge,f as Ze,g as Xe}from"./alert-dialog-bBvWK-5Q.js";import{L as ae,B as ue,D as es,b as ss,c as ts,d as T,e as as}from"./Header-HmO9KIvP.js";import{z as x,u as ke,t as Se,F as Pe,a as O,b as V,d as q,c as L,f as W,e as U}from"./form-Bn3qej8w.js";import{C as rs}from"./checkbox-CpzJVwUi.js";import{T as _}from"./textarea-8UmQ7iuL.js";import{P as is}from"./progress-XD4z056s.js";import{S as ge}from"./slider-BHLSMB0K.js";import{B as re,H as ns}from"./target-7abParum.js";import{C as P}from"./circle-check-CkKaz49B.js";import{C as pe}from"./calendar-Ck4F2mgv.js";import{C as je}from"./circle-check-big-D7NcmSYY.js";import{C as ls}from"./circle-x-B6rDCGfP.js";import{B as K}from"./book-text-_2JTahF7.js";import{E as cs}from"./eachDayOfInterval-D7CfGF_P.js";import{E as os}from"./eye-D3NTB46B.js";import{S as fe}from"./square-pen-BwPwTV1q.js";import{S as ve}from"./sparkles-aDL3aOOp.js";import{T as ds}from"./trash-2-ZtlY59XR.js";import{B as ms}from"./book-DG6mmprG.js";import{B as Ne}from"./brain-circuit-ClF974iG.js";import{T as be}from"./triangle-alert-B6ZFxm6X.js";import{M as hs}from"./message-square-BUQziOr0.js";import{f as te}from"./format-CrnBQ42y.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ye=Le("Scale",[["path",{d:"m16 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"7g6ntu"}],["path",{d:"m2 16 3-8 3 8c-.87.65-1.92 1-3 1s-2.13-.35-3-1Z",key:"ijws7r"}],["path",{d:"M7 21h10",key:"1b0cd5"}],["path",{d:"M12 3v18",key:"108xh3"}],["path",{d:"M3 7h2c2 0 5-1 7-2 2 1 5 2 7 2h2",key:"3gwbw2"}]]),xs=x.object({thoughtRecordId:x.number(),assignedTo:x.number(),isPriority:x.boolean().default(!1),notes:x.string().optional(),customInstructions:x.string().optional()}),us=({thoughtRecord:r,clientId:b,isOpen:D,onClose:p})=>{const{toast:u}=ie(),f=we(),[l,d]=Ce(),t=ke({resolver:Se(xs),defaultValues:{thoughtRecordId:r==null?void 0:r.id,assignedTo:b,isPriority:!1,notes:"",customInstructions:""}}),h=De({mutationFn:async a=>await(await ne("POST","/api/reframe-coach/assignments",a)).json(),onSuccess:a=>{u({title:"Practice assignment created",description:"The reframe practice has been assigned to the client."}),f.invalidateQueries({queryKey:[`/api/users/${b}/resources/assignments`]}),t.reset(),p(),a&&a.id&&d(`/reframe-coach/practice/${a.id}`)},onError:a=>{u({title:"Error creating assignment",description:a.message,variant:"destructive"})}}),A=a=>{h.mutate(a)},n=()=>!(r!=null&&r.cognitiveDistortions)||r.cognitiveDistortions.length===0?"None identified":r.cognitiveDistortions.join(", ");return e.jsx(F,{open:D,onOpenChange:p,children:e.jsxs(I,{className:"sm:max-w-[525px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(H,{children:[e.jsx(z,{children:"Create Reframe Practice Assignment"}),e.jsx(Y,{children:"Create a customized cognitive restructuring practice based on this thought record."})]}),e.jsxs("div",{className:"py-2",children:[e.jsxs("div",{className:"rounded-md bg-muted p-3 mb-4 text-sm",children:[e.jsx("h4",{className:"font-medium",children:"Thought Record Details"}),e.jsxs("p",{className:"mt-1 text-muted-foreground line-clamp-3 hover:line-clamp-none",children:[e.jsx("strong",{children:"Thought:"})," ",r==null?void 0:r.automaticThoughts]}),e.jsxs("p",{className:"mt-1 text-muted-foreground",children:[e.jsx("strong",{children:"Cognitive Distortions:"})," ",n()]}),(r==null?void 0:r.alternativePerspective)&&e.jsxs("p",{className:"mt-1 text-muted-foreground line-clamp-2 hover:line-clamp-none",children:[e.jsx("strong",{children:"Alternative Perspective:"})," ",r.alternativePerspective]})]}),e.jsx(Pe,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(A),className:"space-y-4",children:[e.jsx(O,{control:t.control,name:"isPriority",render:({field:a})=>e.jsxs(V,{className:"flex flex-row items-start space-x-3 space-y-0 rounded-md border p-4",children:[e.jsx(q,{children:e.jsx(rs,{checked:a.value,onCheckedChange:a.onChange})}),e.jsxs("div",{className:"space-y-1 leading-none",children:[e.jsx(L,{children:"Mark as priority"}),e.jsx(W,{children:"Priority assignments will be highlighted for the client."})]})]})}),e.jsx(O,{control:t.control,name:"notes",render:({field:a})=>e.jsxs(V,{children:[e.jsx(L,{children:"Notes for Client"}),e.jsx(q,{children:e.jsx(_,{placeholder:"Add any notes or context for the client about this practice assignment",className:"resize-none",...a})}),e.jsx(W,{children:"These notes will be visible to the client."}),e.jsx(U,{})]})}),e.jsx(O,{control:t.control,name:"customInstructions",render:({field:a})=>e.jsxs(V,{children:[e.jsx(L,{children:"Custom Instructions (Optional)"}),e.jsx(q,{children:e.jsx(_,{placeholder:"Add any custom instructions for the AI when generating practice scenarios",className:"resize-none",...a})}),e.jsx(W,{children:'These instructions will guide the AI in generating scenarios. For example: "Focus on social anxiety situations" or "Include examples related to work stress."'}),e.jsx(U,{})]})}),e.jsxs(Ye,{children:[e.jsx(o,{type:"button",variant:"outline",onClick:p,disabled:h.isPending,children:"Cancel"}),e.jsxs(o,{type:"submit",disabled:h.isPending,className:"bg-blue-600 hover:bg-blue-700",children:[h.isPending&&e.jsx(We,{className:"mr-2 h-4 w-4 animate-spin"}),"Create Assignment"]})]})]})})]})]})})},gs=x.object({evidenceFor:x.string().min(10,"Please provide at least 10 characters"),evidenceAgainst:x.string().min(10,"Please provide at least 10 characters"),alternativeThought:x.string().min(10,"Please provide at least 10 characters"),beliefInOriginal:x.number().min(0).max(100),beliefInAlternative:x.number().min(0).max(100)});function ps({thoughtRecord:r,onComplete:b,onCancel:D,open:p}){Te();const{activeUserId:u}=Ae(),{toast:f}=ie(),[l,d]=N.useState(0),[t,h]=N.useState(!1),A=3,n=ke({resolver:Se(gs),defaultValues:{evidenceFor:"",evidenceAgainst:"",alternativeThought:"",beliefInOriginal:50,beliefInAlternative:50}}),a=n.watch(),y=l===0?0:l/A*100,E=async()=>{let i=!0;l===1?i=await n.trigger(["evidenceFor","evidenceAgainst"]):l===2&&(i=await n.trigger("alternativeThought")),i&&d(l+1)},v=()=>{l>0&&d(l-1)},Q=async i=>{try{if(!u||!r.id){f({title:"Error",description:"Missing required information",variant:"destructive"});return}const j={evidenceFor:i.evidenceFor,evidenceAgainst:i.evidenceAgainst,alternativePerspective:i.alternativeThought,reflectionRating:Math.round(i.beliefInAlternative/100*10)};await ne("PATCH",`/api/users/${u}/thoughts/${r.id}`,j),He.invalidateQueries({queryKey:[`/api/users/${u}/thoughts`]}),h(!0)}catch(j){console.error("Error saving challenge:",j),f({title:"Error",description:"Failed to save your thought challenge. Please try again.",variant:"destructive"})}},k=()=>{h(!1),n.reset(),d(0),b()},$=()=>{n.reset(),d(0),D()},w=e.jsxs(e.Fragment,{children:[!t&&e.jsxs(e.Fragment,{children:[e.jsxs(H,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(re,{className:"h-5 w-5 text-purple-600"}),"Challenge Your Thought"]}),e.jsx(Y,{children:l===0?"Learn about cognitive behavioral therapy":`Step ${l} of ${A}`})]}),l>0&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(is,{value:y,className:"h-2","data-testid":"progress-challenge"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{className:l>=1?"text-purple-600 font-medium":"",children:"1. Evidence"}),e.jsx("span",{className:l>=2?"text-purple-600 font-medium":"",children:"2. Alternative"}),e.jsx("span",{className:l>=3?"text-purple-600 font-medium":"",children:"3. Beliefs"})]})]}),e.jsx(Pe,{...n,children:e.jsxs("form",{onSubmit:n.handleSubmit(Q),className:"space-y-6",children:[l===0&&e.jsxs("div",{className:"space-y-6","data-testid":"step-intro",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-50 to-blue-50 p-6 rounded-lg border-2 border-purple-200",children:e.jsxs("div",{className:"flex items-start gap-3",children:[e.jsx(ae,{className:"h-6 w-6 text-purple-600 mt-1 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-semibold mb-2",children:"What is Thought Challenging?"}),e.jsx("p",{className:"text-sm text-gray-700 leading-relaxed",children:"Thought challenging is a core technique from Cognitive Behavioral Therapy (CBT). It helps you examine whether your automatic thoughts are accurate, helpful, and based on facts."})]})]})}),e.jsxs("div",{className:"space-y-4",children:[e.jsx("h4",{className:"font-semibold text-base",children:"Why Challenge Your Thoughts?"}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"flex gap-3 bg-white p-4 rounded-lg border",children:[e.jsx(P,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Reduce Emotional Distress"}),e.jsx("p",{className:"text-sm text-gray-600",children:"When you question negative thoughts, they often lose their power over your emotions"})]})]}),e.jsxs("div",{className:"flex gap-3 bg-white p-4 rounded-lg border",children:[e.jsx(P,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"See the Bigger Picture"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Find evidence you might have overlooked and consider alternative explanations"})]})]}),e.jsxs("div",{className:"flex gap-3 bg-white p-4 rounded-lg border",children:[e.jsx(P,{className:"h-5 w-5 text-green-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-sm",children:"Develop Balanced Alternatives"}),e.jsx("p",{className:"text-sm text-gray-600",children:"Create more realistic, evidence-based thoughts that consider all the facts"})]})]})]})]}),e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsx(_e,{className:"h-5 w-5 text-blue-600 mt-0.5 flex-shrink-0"}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium text-sm mb-1",children:"Your Automatic Thought:"}),e.jsxs("p",{className:"text-sm text-gray-700 italic",children:['"',r.automaticThoughts,'"']}),e.jsx("p",{className:"text-xs text-gray-500 mt-2",children:"We'll guide you through examining this thought step-by-step"})]})]})}),e.jsxs("div",{className:"flex justify-end gap-3",children:[e.jsx(o,{type:"button",variant:"outline",onClick:$,children:"Skip for Now"}),e.jsxs(o,{type:"button",onClick:()=>d(1),"data-testid":"button-start-challenge",children:["Start Challenge ",e.jsx(P,{className:"ml-2 h-4 w-4"})]})]})]}),l===1&&e.jsxs("div",{className:"space-y-4","data-testid":"step-evidence",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-medium text-sm mb-2",children:"ðŸ’¡ Why Examine Evidence?"}),e.jsx("p",{className:"text-sm text-gray-700",children:"Looking at both sides helps you see if your thought is based on facts or assumptions. Be honest and objective."})]}),e.jsxs("div",{className:"bg-blue-50 p-3 rounded border border-blue-200",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"Your thought:"}),e.jsxs("p",{className:"text-sm italic text-gray-700",children:['"',r.automaticThoughts,'"']})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-base font-semibold",children:["Evidence supporting this thought ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"What facts or experiences support this thought?"}),e.jsx(_,{placeholder:"e.g., My manager gave me critical feedback on my last report...",className:"resize-none w-full min-h-[100px] text-base",rows:4,value:a.evidenceFor||"",onChange:i=>{n.setValue("evidenceFor",i.target.value,{shouldValidate:!0})},"data-testid":"textarea-evidence-for"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[n.formState.errors.evidenceFor&&e.jsx("p",{className:"text-red-500 text-sm",children:n.formState.errors.evidenceFor.message}),e.jsxs("span",{className:`${(a.evidenceFor||"").length<10?"text-red-500":"text-green-600"}`,children:[(a.evidenceFor||"").length,"/10 characters minimum"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-base font-semibold",children:["Evidence against this thought ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"What facts or experiences contradict this thought?"}),e.jsx(_,{placeholder:"e.g., I've received positive feedback on my work before. My colleague said I did great work last month...",className:"resize-none w-full min-h-[100px] text-base",rows:4,value:a.evidenceAgainst||"",onChange:i=>{n.setValue("evidenceAgainst",i.target.value,{shouldValidate:!0})},"data-testid":"textarea-evidence-against"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[n.formState.errors.evidenceAgainst&&e.jsx("p",{className:"text-red-500 text-sm",children:n.formState.errors.evidenceAgainst.message}),e.jsxs("span",{className:`${(a.evidenceAgainst||"").length<10?"text-red-500":"text-green-600"}`,children:[(a.evidenceAgainst||"").length,"/10 characters minimum"]})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:v,children:"Previous"}),e.jsx(o,{type:"button",onClick:E,"data-testid":"button-next-step",children:"Next Step"})]})]}),l===2&&e.jsxs("div",{className:"space-y-4","data-testid":"step-alternative",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-medium text-sm mb-2",children:"ðŸ’¡ Why Create an Alternative?"}),e.jsx("p",{className:"text-sm text-gray-700",children:"Based on the evidence, create a more balanced, realistic thought that considers all the facts."})]}),e.jsxs("div",{className:"grid gap-3",children:[e.jsxs("div",{className:"bg-red-50 p-3 rounded border border-red-200",children:[e.jsx("p",{className:"text-xs font-medium mb-1 text-red-800",children:"Original thought:"}),e.jsxs("p",{className:"text-sm italic text-gray-700",children:['"',r.automaticThoughts,'"']})]}),e.jsxs("div",{className:"bg-green-50 p-3 rounded border border-green-200",children:[e.jsx("p",{className:"text-xs font-medium mb-1 text-green-800",children:"Evidence against:"}),e.jsx("p",{className:"text-sm text-gray-700",children:n.watch("evidenceAgainst")||"..."})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-base font-semibold",children:["Alternative, balanced thought ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Write a more realistic thought that considers all evidence"}),e.jsx(_,{placeholder:"e.g., While I got some critical feedback, I've also done good work that was praised. One piece of criticism doesn't mean I'm incompetent - it means I have room to improve in this area...",className:"resize-none w-full min-h-[120px] text-base",rows:5,value:a.alternativeThought||"",onChange:i=>{n.setValue("alternativeThought",i.target.value,{shouldValidate:!0})},"data-testid":"textarea-alternative"}),e.jsxs("div",{className:"flex justify-between items-center text-sm",children:[n.formState.errors.alternativeThought&&e.jsx("p",{className:"text-red-500 text-sm",children:n.formState.errors.alternativeThought.message}),e.jsxs("span",{className:`${(a.alternativeThought||"").length<10?"text-red-500":"text-green-600"}`,children:[(a.alternativeThought||"").length,"/10 characters minimum"]})]})]}),e.jsxs("div",{className:"bg-gray-50 p-4 rounded-md",children:[e.jsx("h4",{className:"font-medium text-sm mb-2",children:"Tips for Alternative Thoughts:"}),e.jsxs("ul",{className:"text-xs space-y-1 text-gray-700",children:[e.jsx("li",{children:"â€¢ Consider all the evidence, not just what supports the negative thought"}),e.jsx("li",{children:'â€¢ Ask "What would I tell a friend in this situation?"'}),e.jsx("li",{children:"â€¢ Look for middle ground - avoid black and white thinking"}),e.jsx("li",{children:"â€¢ Be compassionate with yourself"})]})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:v,children:"Previous"}),e.jsx(o,{type:"button",onClick:E,"data-testid":"button-next-step",children:"Next Step"})]})]}),l===3&&e.jsxs("div",{className:"space-y-4","data-testid":"step-beliefs",children:[e.jsxs("div",{className:"bg-purple-50 p-4 rounded-lg border border-purple-200",children:[e.jsx("h3",{className:"font-medium text-sm mb-2",children:"ðŸ’¡ Why Rate Your Beliefs?"}),e.jsx("p",{className:"text-sm text-gray-700",children:"Rating how much you believe each thought shows how much the challenge process helped shift your perspective."})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(O,{control:n.control,name:"beliefInOriginal",render:({field:i})=>e.jsxs(V,{children:[e.jsx(L,{className:"text-base font-semibold",children:"How much do you believe your original thought now?"}),e.jsxs(W,{className:"text-xs italic text-gray-600 mb-2",children:['"',r.automaticThoughts,'"']}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-gray-600 min-w-[120px]",children:"Not at all (0%)"}),e.jsx(q,{children:e.jsx(ge,{value:[i.value],onValueChange:j=>i.onChange(j[0]),min:0,max:100,step:5,className:"flex-grow h-3 bg-gradient-to-r from-green-200 via-yellow-400 to-red-600","data-testid":"slider-belief-original"})}),e.jsx("span",{className:"text-sm text-gray-600 min-w-[120px]",children:"Completely (100%)"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("span",{className:"px-6 py-3 rounded-full bg-purple-600 text-white text-2xl font-bold",children:[i.value,"%"]})})]}),e.jsx(U,{})]})}),e.jsx(O,{control:n.control,name:"beliefInAlternative",render:({field:i})=>e.jsxs(V,{children:[e.jsx(L,{className:"text-base font-semibold",children:"How much do you believe your alternative thought?"}),e.jsxs(W,{className:"text-xs italic text-gray-600 mb-2",children:['"',n.watch("alternativeThought")||"Your alternative thought...",'"']}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("span",{className:"text-sm text-gray-600 min-w-[120px]",children:"Not at all (0%)"}),e.jsx(q,{children:e.jsx(ge,{value:[i.value],onValueChange:j=>i.onChange(j[0]),min:0,max:100,step:5,className:"flex-grow h-3 bg-gradient-to-r from-red-200 via-yellow-400 to-green-600","data-testid":"slider-belief-alternative"})}),e.jsx("span",{className:"text-sm text-gray-600 min-w-[120px]",children:"Completely (100%)"})]}),e.jsx("div",{className:"flex justify-center",children:e.jsxs("span",{className:"px-6 py-3 rounded-full bg-green-600 text-white text-2xl font-bold",children:[i.value,"%"]})})]}),e.jsx(U,{})]})})]}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsx(o,{type:"button",variant:"outline",onClick:v,children:"Previous"}),e.jsxs(o,{type:"submit","data-testid":"button-save-challenge",children:["Save Challenge ",e.jsx(P,{className:"ml-2 h-4 w-4"})]})]})]})]})})]}),e.jsx(F,{open:t,onOpenChange:k,modal:!1,children:e.jsxs(I,{children:[e.jsxs(H,{children:[e.jsxs(z,{className:"flex items-center gap-2",children:[e.jsx(P,{className:"h-5 w-5 text-green-600"}),"Thought Challenge Complete!"]}),e.jsx(Y,{children:"You've successfully challenged your automatic thought"})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"What you accomplished:"}),e.jsxs("ul",{className:"text-sm text-gray-700 space-y-1",children:[e.jsx("li",{children:"âœ… Examined evidence on both sides"}),e.jsx("li",{children:"âœ… Created a balanced alternative perspective"}),e.jsxs("li",{children:["âœ… Shifted your belief by ",Math.abs((n.watch("beliefInOriginal")||50)-(n.watch("beliefInAlternative")||50)),"%"]})]})]}),e.jsxs("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:[e.jsx("p",{className:"text-sm font-medium mb-1",children:"ðŸ’¡ Remember:"}),e.jsx("p",{className:"text-sm text-gray-700",children:"The goal isn't to think positive thoughts, but to think more realistic, balanced thoughts. With practice, this becomes easier!"})]})]}),e.jsx("div",{className:"flex justify-end gap-3",children:e.jsx(o,{onClick:k,"data-testid":"button-close-success",children:"Done"})})]})})]});return p!==void 0?e.jsx(F,{open:p,onOpenChange:i=>!i&&D(),children:e.jsx(I,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:w})}):w}const js={all_or_nothing:"All or Nothing Thinking",mental_filter:"Mental Filter",mind_reading:"Mind Reading",fortune_telling:"Fortune Telling",labelling:"Labelling",over_generalising:"Over-Generalising",compare_despair:"Compare and Despair",emotional_thinking:"Emotional Thinking",guilty_thinking:"Guilty Thinking",catastrophising:"Catastrophising",blaming_others:"Blaming Others",personalising:"Personalising"};function Us({limit:r,onEditRecord:b,userId:D,thoughtRecords:p,showPracticeButton:u=!0}){const{user:f}=Te(),{activeUserId:l,isViewingClientData:d}=Ae(),[t,h]=N.useState(null),[A,n]=N.useState(!1),[a,y]=N.useState(!1),[E,v]=N.useState(null),[Q,k]=N.useState(!1),[$,w]=N.useState(null),{toast:i}=ie(),j=we(),[fs,Fe]=Ce(),m=D||l,{data:Ie,isLoading:Ee,error:$e}=se({queryKey:m?[`/api/users/${m}/thoughts`]:[],enabled:!!m&&!p}),{data:G}=se({queryKey:m?[`/api/users/${m}/emotions`]:[],enabled:!!m}),{data:le}=se({queryKey:m?[`/api/users/${m}/reframe-coach/results`]:[],enabled:!!m&&u}),Me=s=>{if(!le)return null;const c=le.filter(X=>X.thoughtRecordId===s);if(c.length===0)return null;const g=c.sort((X,qe)=>new Date(qe.createdAt).getTime()-new Date(X.createdAt).getTime())[0],S=new Date(g.createdAt).getTime(),J=(Date.now()-S)/(1e3*60*60);return{lastPracticeTime:S,hoursSinceLastPractice:J,canPractice:J>=24,hoursUntilNext:J>=24?0:Math.ceil(24-J)}},C=p||Ie,{refreshAfterOperation:ce}=ze(),oe=De({mutationFn:async s=>{if(!l)throw new Error("User not authenticated");if(d)throw new Error("Cannot delete records for clients");return ne("DELETE",`/api/users/${l}/thoughts/${s}`)},onSuccess:(s,c)=>{ce("thought","delete",c,"The thought record has been deleted successfully.",!0),v(null),y(!1)},onError:s=>{var c;if(console.error("Error deleting thought record:",s),((c=s==null?void 0:s.response)==null?void 0:c.status)===404){ce("thought","delete",null,"The record no longer exists.",!0),v(null),y(!1);return}i({title:"Error",description:"Failed to delete the record. Please try again.",variant:"destructive"})}}),Be=s=>{h(s)},de=s=>{b?b(s):Fe(`/reflection?edit=${s.id}`)},Oe=s=>{v(s),y(!0)},Ve=()=>{E&&oe.mutate(E.id)},me=s=>{const c=new Date(s),g=new Date,S=new Date(g);return S.setDate(S.getDate()-1),c.toDateString()===g.toDateString()?`Today, ${te(c,"h:mm a")}`:c.toDateString()===S.toDateString()?`Yesterday, ${te(c,"h:mm a")}`:te(c,"MMM d, yyyy, h:mm a")},he=s=>!!(s.evidenceFor||s.evidenceAgainst||s.alternativePerspective);if(Ee)return e.jsxs(M,{children:[e.jsx(ee,{children:e.jsx(R,{children:"Thought Records"})}),e.jsx(B,{children:e.jsx("div",{className:"h-12 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-t-2 border-b-2 border-primary"})})})]});if($e)return e.jsxs(M,{children:[e.jsx(ee,{children:e.jsx(R,{children:"Thought Records"})}),e.jsx(B,{children:e.jsx("p",{className:"text-center text-sm text-red-500",children:"Error loading thought records. Please try again later."})})]});const Z=r&&!A&&Array.isArray(C)?C.slice(0,r):C;return e.jsxs(e.Fragment,{children:[e.jsxs(M,{children:[e.jsxs(ee,{className:"flex flex-row items-center justify-between pb-2",children:[e.jsx("div",{children:d?e.jsxs(e.Fragment,{children:[e.jsx(R,{children:"Client's Thought Records"}),e.jsx(xe,{children:"Viewing thought records and reflections for this client"})]}):e.jsxs(e.Fragment,{children:[e.jsx(R,{children:"Thought Records"}),e.jsx(xe,{children:"Your thought records and reflections"})]})}),r&&Array.isArray(C)&&C.length>r&&e.jsx(o,{variant:"ghost",onClick:()=>n(!0),className:"text-sm text-primary hover:text-primary-dark",children:"View All"})]}),e.jsx(B,{children:!C||C.length===0?e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-neutral-500",children:"No thought records yet."}),d?e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"This client has not created any thought records."}):e.jsx("p",{className:"text-sm text-neutral-400 mt-1",children:"Add reflections to your emotions to start building thought records."})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:Z==null?void 0:Z.map(s=>e.jsxs(M,{className:"overflow-hidden border-slate-200 hover:shadow-md transition-shadow duration-200 h-full flex flex-col",children:[e.jsxs("div",{className:"bg-muted/20 px-4 py-3 flex items-center justify-between border-b",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-slate-100",children:e.jsx(pe,{className:"h-3.5 w-3.5 text-slate-500"})}),e.jsx("span",{className:"text-sm font-medium",children:me(s.createdAt)})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[he(s)?e.jsxs(ue,{variant:"outline",className:"gap-1 bg-green-50 text-green-700 border-green-200",children:[e.jsx(je,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:"Challenged"})]}):e.jsxs(ue,{variant:"outline",className:"gap-1 bg-amber-50 text-amber-700 border-amber-200",children:[e.jsx(ls,{className:"h-3 w-3"}),e.jsx("span",{className:"text-xs",children:"Not Challenged"})]}),s.relatedJournalEntryIds&&s.relatedJournalEntryIds.length>0&&e.jsxs("div",{className:"flex items-center gap-1.5 px-2 py-0.5 bg-primary/10 text-primary rounded-full",title:`${s.relatedJournalEntryIds.length} linked journal ${s.relatedJournalEntryIds.length===1?"entry":"entries"}`,children:[e.jsx(K,{className:"h-3.5 w-3.5"}),e.jsx("span",{className:"text-xs font-medium",children:s.relatedJournalEntryIds.length})]}),e.jsxs(es,{children:[e.jsx(ss,{asChild:!0,children:e.jsx(o,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(cs,{className:"h-4 w-4"})})}),e.jsxs(ts,{align:"end",children:[e.jsxs(T,{onClick:()=>Be(s),children:[e.jsx(os,{className:"h-4 w-4 mr-2"}),"View Details"]}),!d&&e.jsxs(e.Fragment,{children:[!he(s)&&e.jsxs(T,{onClick:()=>w(s),children:[e.jsx(re,{className:"h-4 w-4 mr-2"}),"Challenge This Thought"]}),e.jsxs(T,{onClick:()=>de(s),children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Edit"]}),u&&(()=>{const c=Me(s.id),g=!c||c.canPractice;return e.jsx(T,{onClick:()=>{g&&(window.location.href=`/reframe-coach/practice/quick/${s.id}?userId=${m}`)},disabled:!g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Practice"]}):e.jsxs(e.Fragment,{children:[e.jsx(je,{className:"h-4 w-4 mr-2"}),"Practiced Today"]})})})(),e.jsx(as,{}),e.jsxs(T,{onClick:()=>Oe(s),className:"text-destructive focus:text-destructive",children:[e.jsx(ds,{className:"h-4 w-4 mr-2"}),"Delete"]})]}),d&&e.jsxs(e.Fragment,{children:[e.jsxs(T,{onClick:()=>{window.location.href=`/users/${m}/reframe-coach?tab=history`},children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"View Practice History"]}),(f==null?void 0:f.role)==="therapist"&&e.jsxs(T,{onClick:()=>{h(s),k(!0)},children:[e.jsx(ms,{className:"h-4 w-4 mr-2"}),"Assign Practice"]})]})]})]})]})]}),e.jsxs(B,{className:"p-4 flex-1",children:[e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-indigo-100",children:e.jsx(Ne,{className:"h-3.5 w-3.5 text-indigo-500"})}),e.jsx("h4",{className:"text-sm font-medium text-slate-700",children:"Automatic Thoughts"})]}),e.jsx("p",{className:"text-sm pl-7 text-slate-600 line-clamp-2",children:s.automaticThoughts})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-amber-100",children:e.jsx(be,{className:"h-3.5 w-3.5 text-amber-500"})}),e.jsx("h4",{className:"text-sm font-medium text-slate-700",children:"Distortions"})]}),e.jsx("div",{className:"pl-7",children:s.thoughtCategory&&s.thoughtCategory.length>0?e.jsx("div",{className:"flex flex-wrap gap-1",children:s.thoughtCategory.map((c,g)=>e.jsx("span",{className:"px-2 py-0.5 bg-amber-50 text-amber-700 rounded-full text-xs",children:js[c]||c},g))}):e.jsx("span",{className:"text-muted-foreground text-xs",children:"None identified"})})]}),e.jsxs("div",{className:"mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-blue-100",children:e.jsx(ae,{className:"h-3.5 w-3.5 text-blue-500"})}),e.jsx("h4",{className:"text-sm font-medium text-slate-700",children:"Alternative Perspective"})]}),e.jsx("p",{className:"text-sm pl-7 text-slate-600 line-clamp-2",children:s.alternativePerspective})]})]})]},s.id))})})]}),t&&e.jsx(F,{open:!!t,onOpenChange:()=>h(null),children:e.jsxs(I,{className:"max-w-3xl max-h-[80vh] overflow-y-auto custom-scrollbar",children:[e.jsxs(H,{className:"sticky top-0 bg-background z-10 pb-4",children:[e.jsxs(z,{className:"flex items-center gap-2 text-lg",children:[e.jsx("div",{className:"p-2 rounded-full bg-indigo-100",children:e.jsx(re,{className:"h-5 w-5 text-indigo-600"})}),"Thought Record Details"]}),e.jsxs(Y,{children:["Created on ",me(t.createdAt)]})]}),e.jsx("div",{className:"space-y-6 pr-1",children:e.jsx(M,{className:"border-l-4 border-l-indigo-400",children:e.jsxs(B,{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-slate-100",children:e.jsx(pe,{className:"h-4 w-4 text-slate-500"})}),"Situation"]}),e.jsx("p",{className:"text-sm pl-7",children:t.situation})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-emerald-100",children:e.jsx(ns,{className:"h-4 w-4 text-emerald-500"})}),"Emotions"]}),e.jsx("div",{className:"pl-7 flex flex-wrap gap-1",children:t.id===50?e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("span",{className:"px-2 py-0.5 bg-emerald-50 text-emerald-700 rounded-full text-xs",children:"Fear"}),e.jsx("span",{className:"px-2 py-0.5 bg-emerald-50 text-emerald-700 rounded-full text-xs",children:"Insecure"}),e.jsx("span",{className:"px-2 py-0.5 bg-emerald-50 text-emerald-700 rounded-full text-xs",children:"Inadequate"})]}):e.jsx(e.Fragment,{children:t.emotionRecordId&&G&&G.length>0?(()=>{const s=G.find(c=>c.id===t.emotionRecordId);return e.jsxs("div",{className:"flex flex-wrap gap-1",children:[(s==null?void 0:s.coreEmotion)&&e.jsx("span",{className:"px-2 py-0.5 bg-emerald-50 text-emerald-700 rounded-full text-xs",children:s.coreEmotion}),(s==null?void 0:s.primaryEmotion)&&e.jsx("span",{className:"px-2 py-0.5 bg-emerald-50 text-emerald-700 rounded-full text-xs",children:s.primaryEmotion}),(s==null?void 0:s.tertiaryEmotion)&&e.jsx("span",{className:"px-2 py-0.5 bg-emerald-50 text-emerald-700 rounded-full text-xs",children:s.tertiaryEmotion})]})})():e.jsx("span",{className:"text-muted-foreground text-xs",children:"No emotions linked"})})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-indigo-100",children:e.jsx(Ne,{className:"h-4 w-4 text-indigo-500"})}),"Automatic Thoughts"]}),e.jsx("p",{className:"text-sm pl-7",children:t.automaticThoughts})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-amber-100",children:e.jsx(be,{className:"h-4 w-4 text-amber-500"})}),"Cognitive Distortions"]}),e.jsx("div",{className:"pl-7 flex flex-wrap gap-1",children:t.cognitiveDistortions&&t.cognitiveDistortions.length>0?t.cognitiveDistortions.map((s,c)=>e.jsx("span",{className:"px-2 py-0.5 bg-amber-50 text-amber-700 rounded-full text-xs",children:s},c)):e.jsx("span",{className:"text-muted-foreground text-xs",children:"None identified"})})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-purple-100",children:e.jsx(ye,{className:"h-4 w-4 text-purple-500"})}),"Evidence For"]}),e.jsx("p",{className:"text-sm pl-7",children:t.evidenceFor||"None provided"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-purple-100",children:e.jsx(ye,{className:"h-4 w-4 text-purple-500"})}),"Evidence Against"]}),e.jsx("p",{className:"text-sm pl-7",children:t.evidenceAgainst||"None provided"})]}),e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-blue-100",children:e.jsx(ae,{className:"h-4 w-4 text-blue-500"})}),"Alternative Perspective"]}),e.jsx("p",{className:"text-sm pl-7",children:t.alternativePerspective})]}),t.reflectionNotes&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-gray-100",children:e.jsx(hs,{className:"h-4 w-4 text-gray-500"})}),"Reflection Notes"]}),e.jsx("p",{className:"text-sm pl-7",children:t.reflectionNotes})]}),t.relatedJournalEntryIds&&t.relatedJournalEntryIds.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-1 flex items-center gap-2",children:[e.jsx("div",{className:"p-1.5 rounded-full bg-primary/10",children:e.jsx(K,{className:"h-4 w-4 text-primary"})}),"Connected Journal Entries"]}),e.jsx("div",{className:"pl-7",children:e.jsx("div",{className:"flex flex-wrap gap-1",children:t.relatedJournalEntryIds.map(s=>e.jsxs(o,{variant:"outline",size:"sm",className:"h-7 px-2 py-0 text-xs",onClick:()=>window.location.href=`/journals/${s}`,children:["Entry #",s]},s))})})]})]})})}),e.jsxs("div",{className:"flex justify-end space-x-2 mt-6",children:[!d&&e.jsxs(o,{onClick:()=>{de(t),h(null)},className:"text-primary hover:text-primary-dark",variant:"outline",children:[e.jsx(fe,{className:"h-4 w-4 mr-2"}),"Edit Record"]}),u&&!d&&e.jsxs(o,{onClick:()=>{window.location.href=`/reframe-coach/practice/quick/${t.id}?userId=${m}`},className:"bg-amber-500 hover:bg-amber-600 text-white",children:[e.jsx(ve,{className:"h-4 w-4 mr-2"}),"Practice Reframing"]}),d&&e.jsxs(o,{onClick:()=>{const s=`/users/${m}/reframe-coach?tab=history`;console.log("Navigating to practice history:",s),window.location.href=s},className:"bg-blue-500 hover:bg-blue-600 text-white",children:[e.jsx(K,{className:"h-4 w-4 mr-2"}),"View Practice History"]})]})]})}),e.jsx(Je,{open:a,onOpenChange:y,children:e.jsxs(Re,{children:[e.jsxs(Ke,{children:[e.jsx(Ue,{children:"Are you sure?"}),e.jsx(Qe,{children:"This will permanently delete this thought record. This action cannot be undone."})]}),e.jsxs(Ge,{children:[e.jsx(Ze,{onClick:()=>v(null),children:"Cancel"}),e.jsx(Xe,{onClick:Ve,className:"bg-destructive text-destructive-foreground",children:oe.isPending?"Deleting...":"Delete"})]})]})}),t&&e.jsx(F,{open:Q,onOpenChange:k,children:e.jsxs(I,{children:[e.jsxs(H,{children:[e.jsx(z,{children:"Assign Reframe Practice"}),e.jsx(Y,{children:"Create a reframing practice assignment for this client based on their thought record."})]}),e.jsx(us,{thoughtRecord:t,clientId:l,onSuccess:()=>{k(!1),h(null)}})]})}),$&&e.jsx(F,{open:!!$,onOpenChange:()=>w(null),children:e.jsx(I,{className:"max-w-4xl max-h-[90vh] overflow-y-auto",children:e.jsx(ps,{thoughtRecord:$,onComplete:()=>{m&&j.invalidateQueries({queryKey:[`/api/users/${m}/thoughts`]}),w(null),i({title:"Success! ðŸŽ‰",description:"You've successfully challenged this thought."})},onCancel:()=>w(null)})})})]})}export{ps as T,Us as a};
