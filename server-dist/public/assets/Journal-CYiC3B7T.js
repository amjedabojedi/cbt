import{c as xe,F as et,r as p,j as e,P as ts,Z as st,_ as Je,b as rs,u as As,n as Es,C as h,e as g,f as N,g as z,a as u,B as k,X as _e,h as q,D as xs,y as tt,k as rt,l as hs,T as ge,t as pe,v as je,w as fe}from"./index-BJDVYPr2.js";import{u as ye}from"./useQuery-CVl6tFXz.js";import{u as K}from"./useMutation-4_CoT2bx.js";import{u as Ds,C as we}from"./use-active-user-CkIppDip.js";import{u as at}from"./use-refresh-data-Dq9XIZaR.js";import{B as nt,M as it}from"./BackToClientsButton-_c3Gvoq3.js";import{I as me}from"./input-C744jVRX.js";import{T as He}from"./textarea-8UmQ7iuL.js";import{B as D,a as lt,f as ot,D as ct,b as dt,c as mt,d as ze,e as xt,L as ht}from"./Header-HmO9KIvP.js";import{D as Z,a as ee,b as se,c as te,d as ke,e as de}from"./dialog-BkbRhY2O.js";import{T as Ye,a as Qe,b as V,c as oe}from"./tabs-DZkkmdmK.js";import{A as ut,a as gt,b as pt,c as jt}from"./accordion-C_vhZxL6.js";import{u as ft,F as vt,a as us,b as gs,c as ps,d as js,f as fs,e as vs,z as Ie,t as bt}from"./form-Bn3qej8w.js";import{P as Nt}from"./progress-XD4z056s.js";import{S as Ce}from"./sparkles-aDL3aOOp.js";import{H as Te,M as Le,B as bs}from"./target-7abParum.js";import{C as Se}from"./circle-check-big-D7NcmSYY.js";import{P as Ms}from"./plus-CIrJHrh4.js";import{C as yt}from"./chevron-left-DkowiYxd.js";import{C as re}from"./check-CPyQFfyd.js";import{T as Ge}from"./trending-up-CZSEG5Sb.js";import{R as ve,o as Oe,X as qe,Y as We,T as be,p as Ns,q as wt,B as kt}from"./generateCategoricalChart-CFBGWCRH.js";import{a as ys,L as Ne,s as ce}from"./LineChart-D-Uu3kL0.js";import{P as Ct,a as Tt}from"./PieChart-PYX3tuHq.js";import{B as St}from"./BarChart-BD1_1xzo.js";import{C as Xe}from"./calendar-Ck4F2mgv.js";import{e as Be,E as At}from"./eachDayOfInterval-D7CfGF_P.js";import{f as F}from"./format-CrnBQ42y.js";import{A as Et}from"./AppLayout-B4pR-pjA.js";import{B as ws}from"./book-DG6mmprG.js";import{I as ks}from"./info-PLI2XuV7.js";import{S as Ue}from"./square-pen-BwPwTV1q.js";import{T as Cs}from"./trash-2-ZtlY59XR.js";import{B as Ve}from"./brain-circuit-ClF974iG.js";import{L as Dt}from"./link-2-BMm9hW3F.js";import{S as Mt}from"./send-D_NmVAMV.js";import{A as Pt}from"./activity-B2O4100s.js";import"./utils-km2FGkQ4.js";import"./index-ZMpGrT0S.js";import"./index-epKMAjhH.js";import"./chevron-down-JR_7gpC-.js";import"./label-DKKVfa8V.js";import"./en-US-9SRVm7yB.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $t=xe("ExternalLink",[["path",{d:"M15 3h6v6",key:"1q9fwt"}],["path",{d:"M10 14 21 3",key:"gplh6r"}],["path",{d:"M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6",key:"a6xqqp"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ft=xe("MessageSquarePlus",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}],["path",{d:"M12 7v6",key:"lw1j43"}],["path",{d:"M9 10h6",key:"9gxzsh"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ze=xe("SquareCheckBig",[["path",{d:"M21 10.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h12.5",key:"1uzm8b"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=xe("Tag",[["path",{d:"M12.586 2.586A2 2 0 0 0 11.172 2H4a2 2 0 0 0-2 2v7.172a2 2 0 0 0 .586 1.414l8.704 8.704a2.426 2.426 0 0 0 3.42 0l6.58-6.58a2.426 2.426 0 0 0 0-3.42z",key:"vktsd0"}],["circle",{cx:"7.5",cy:"7.5",r:".5",fill:"currentColor",key:"kqv944"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rt=xe("Unlink",[["path",{d:"m18.84 12.25 1.72-1.71h-.02a5.004 5.004 0 0 0-.12-7.07 5.006 5.006 0 0 0-6.95 0l-1.72 1.71",key:"yqzxt4"}],["path",{d:"m5.17 11.75-1.71 1.71a5.004 5.004 0 0 0 .12 7.07 5.006 5.006 0 0 0 6.95 0l1.71-1.71",key:"4qinb0"}],["line",{x1:"8",x2:"8",y1:"2",y2:"5",key:"1041cp"}],["line",{x1:"2",x2:"5",y1:"8",y2:"8",key:"14m1p5"}],["line",{x1:"16",x2:"16",y1:"19",y2:"22",key:"rzdirn"}],["line",{x1:"19",x2:"22",y1:"16",y2:"16",key:"ox905f"}]]);var as="Avatar",[zt,Rr]=et(as),[It,Ps]=zt(as),$s=p.forwardRef((l,m)=>{const{__scopeAvatar:a,...n}=l,[T,v]=p.useState("idle");return e.jsx(It,{scope:a,imageLoadingStatus:T,onImageLoadingStatusChange:v,children:e.jsx(ts.span,{...n,ref:m})})});$s.displayName=as;var Fs="AvatarImage",Rs=p.forwardRef((l,m)=>{const{__scopeAvatar:a,src:n,onLoadingStatusChange:T=()=>{},...v}=l,o=Ps(Fs,a),C=Lt(n,v),x=st(j=>{T(j),o.onImageLoadingStatusChange(j)});return Je(()=>{C!=="idle"&&x(C)},[C,x]),C==="loaded"?e.jsx(ts.img,{...v,ref:m,src:n}):null});Rs.displayName=Fs;var zs="AvatarFallback",Is=p.forwardRef((l,m)=>{const{__scopeAvatar:a,delayMs:n,...T}=l,v=Ps(zs,a),[o,C]=p.useState(n===void 0);return p.useEffect(()=>{if(n!==void 0){const x=window.setTimeout(()=>C(!0),n);return()=>window.clearTimeout(x)}},[n]),o&&v.imageLoadingStatus!=="loaded"?e.jsx(ts.span,{...T,ref:m}):null});Is.displayName=zs;function Ts(l,m){return l?m?(l.src!==m&&(l.src=m),l.complete&&l.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Lt(l,{referrerPolicy:m,crossOrigin:a}){const n=qt(),T=p.useRef(null),v=n?(T.current||(T.current=new window.Image),T.current):null,[o,C]=p.useState(()=>Ts(v,l));return Je(()=>{C(Ts(v,l))},[v,l]),Je(()=>{const x=w=>()=>{C(w)};if(!v)return;const j=x("loaded"),S=x("error");return v.addEventListener("load",j),v.addEventListener("error",S),m&&(v.referrerPolicy=m),typeof a=="string"&&(v.crossOrigin=a),()=>{v.removeEventListener("load",j),v.removeEventListener("error",S)}},[v,a,m]),o}function Ot(){return()=>{}}function qt(){return p.useSyncExternalStore(Ot,()=>!0,()=>!1)}var Ls=$s,Os=Rs,qs=Is;const es=p.forwardRef(({className:l,...m},a)=>e.jsx(Ls,{ref:a,className:rs("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",l),...m}));es.displayName=Ls.displayName;const Wt=p.forwardRef(({className:l,...m},a)=>e.jsx(Os,{ref:a,className:rs("aspect-square h-full w-full",l),...m}));Wt.displayName=Os.displayName;const ss=p.forwardRef(({className:l,...m},a)=>e.jsx(qs,{ref:a,className:rs("flex h-full w-full items-center justify-center rounded-full bg-muted",l),...m}));ss.displayName=qs.displayName;function Q(l){const m={happiness:{color:"bg-yellow-100 border-yellow-300 text-yellow-800",description:"A feeling of joy, pleasure, or contentment"},joy:{color:"bg-yellow-100 border-yellow-300 text-yellow-800",description:"An intense feeling of great happiness"},excited:{color:"bg-yellow-100 border-yellow-300 text-yellow-800",description:"Feeling enthusiastic and eager"},content:{color:"bg-green-100 border-green-300 text-green-800",description:"A state of peaceful happiness and satisfaction"},satisfied:{color:"bg-green-100 border-green-300 text-green-800",description:"Feeling that your needs or desires have been fulfilled"},proud:{color:"bg-purple-100 border-purple-300 text-purple-800",description:"Feeling deep pleasure or satisfaction from achievements"},optimistic:{color:"bg-blue-100 border-blue-300 text-blue-800",description:"Hopeful and confident about the future"},grateful:{color:"bg-green-100 border-green-300 text-green-800",description:"Feeling thankful and appreciative"},relief:{color:"bg-blue-100 border-blue-300 text-blue-800",description:"A feeling of reassurance when anxiety or distress has been reduced"},love:{color:"bg-pink-100 border-pink-300 text-pink-800",description:"A deep feeling of affection, care, and connection"},anger:{color:"bg-red-100 border-red-300 text-red-800",description:"A strong feeling of annoyance, displeasure, or hostility"},anxiety:{color:"bg-orange-100 border-orange-300 text-orange-800",description:"Feeling of worry, nervousness, or unease about something"},fear:{color:"bg-purple-100 border-purple-300 text-purple-800",description:"An unpleasant emotion caused by the threat of danger, pain, or harm"},sadness:{color:"bg-blue-100 border-blue-300 text-blue-800",description:"Feeling or showing sorrow; unhappy"},grief:{color:"bg-indigo-100 border-indigo-300 text-indigo-800",description:"Deep sorrow, especially caused by someone's death"},frustration:{color:"bg-amber-100 border-amber-300 text-amber-800",description:"Feeling of being upset or annoyed as a result of being unable to change or achieve something"},disappointment:{color:"bg-stone-100 border-stone-300 text-stone-800",description:"Sadness or displeasure caused by the non-fulfillment of hopes or expectations"},guilt:{color:"bg-slate-100 border-slate-300 text-slate-800",description:"A feeling of having done wrong or failed in an obligation"},shame:{color:"bg-rose-100 border-rose-300 text-rose-800",description:"A painful feeling of humiliation or distress caused by consciousness of wrong or foolish behavior"},jealousy:{color:"bg-lime-100 border-lime-300 text-lime-800",description:"Feeling or showing envy of someone's achievements or advantages"},stress:{color:"bg-orange-100 border-orange-300 text-orange-800",description:"A state of mental or emotional strain or tension"},overwhelmed:{color:"bg-orange-100 border-orange-300 text-orange-800",description:"Feeling buried or drowning beneath a huge weight of emotions or tasks"},surprised:{color:"bg-violet-100 border-violet-300 text-violet-800",description:"Feeling astonished or taken aback by an unexpected event"},confused:{color:"bg-slate-100 border-slate-300 text-slate-800",description:"Unable to think clearly or understand something"},curious:{color:"bg-teal-100 border-teal-300 text-teal-800",description:"Eager to know or learn something"},indifferent:{color:"bg-gray-100 border-gray-300 text-gray-800",description:"Having no particular interest or sympathy; unconcerned"},bored:{color:"bg-gray-100 border-gray-300 text-gray-800",description:"Feeling weary because one is unoccupied or lacks interest"},calm:{color:"bg-teal-100 border-teal-300 text-teal-800",description:"Not showing or feeling nervousness, anger, or other strong emotions"},nostalgic:{color:"bg-amber-100 border-amber-300 text-amber-800",description:"A sentimental longing for the past"},work:{color:"bg-cyan-100 border-cyan-300 text-cyan-800",description:"Professional activities, career, or job-related concerns"},family:{color:"bg-indigo-100 border-indigo-300 text-indigo-800",description:"Relationships with relatives, family dynamics, or home life"},health:{color:"bg-emerald-100 border-emerald-300 text-emerald-800",description:"Physical or mental wellbeing, fitness, or medical concerns"},relationships:{color:"bg-pink-100 border-pink-300 text-pink-800",description:"Connections with others, romantic partnerships, or friendships"},"personal growth":{color:"bg-lime-100 border-lime-300 text-lime-800",description:"Self-improvement, learning, or personal development"},goals:{color:"bg-blue-100 border-blue-300 text-blue-800",description:"Objectives, aspirations, or targets you're working towards"},challenges:{color:"bg-orange-100 border-orange-300 text-orange-800",description:"Difficulties, obstacles, or problems to overcome"},success:{color:"bg-green-100 border-green-300 text-green-800",description:"Achievements, accomplishments, or positive outcomes"},failure:{color:"bg-red-100 border-red-300 text-red-800",description:"Setbacks, disappointments, or unsuccessful attempts"},dreams:{color:"bg-purple-100 border-purple-300 text-purple-800",description:"Aspirations, hopes, or literal dreams during sleep"},conflict:{color:"bg-amber-100 border-amber-300 text-amber-800",description:"Disagreements, arguments, or opposing viewpoints"},finances:{color:"bg-green-100 border-green-300 text-green-800",description:"Money matters, budget, income, or expenses"},spirituality:{color:"bg-indigo-100 border-indigo-300 text-indigo-800",description:"Faith, belief systems, or connection to something greater"},creativity:{color:"bg-fuchsia-100 border-fuchsia-300 text-fuchsia-800",description:"Artistic expression, innovation, or imaginative activities"},education:{color:"bg-amber-100 border-amber-300 text-amber-800",description:"Learning, school, university, or academic pursuits"},travel:{color:"bg-blue-100 border-blue-300 text-blue-800",description:"Journeys, trips, or experiences in different places"},hobbies:{color:"bg-teal-100 border-teal-300 text-teal-800",description:"Activities done for pleasure, interests, or pastimes"},decisions:{color:"bg-violet-100 border-violet-300 text-violet-800",description:"Choices, options, or crossroads in life"},memories:{color:"bg-cyan-100 border-cyan-300 text-cyan-800",description:"Past experiences, recollections, or reminiscences"},future:{color:"bg-sky-100 border-sky-300 text-sky-800",description:"What lies ahead, planning, or anticipation of coming events"}},a=Object.keys(m).find(n=>n.toLowerCase()===l.toLowerCase());return a?m[a]:{color:"bg-gray-100 border-gray-300 text-gray-800",description:"An emotional state or feeling"}}const Bt=({words:l={},height:m=300,className:a="",maxTags:n=30})=>{const T=p.useMemo(()=>{const x=Object.values(l);return x.length===0?{min:0,max:0}:{min:Math.min(...x),max:Math.max(...x)}},[l]),v=(x,j)=>{try{const{color:t}=Q(x);if(t)return t}catch(t){console.warn(`No color mapping found for emotion: ${x}`,t)}const{min:S,max:w}=T;if(S===w)return"bg-blue-100 border-blue-300 text-blue-800";const d=(j-S)/(w-S);return d<.33?"bg-blue-100 border-blue-300 text-blue-800":d<.66?"bg-purple-100 border-purple-300 text-purple-800":"bg-red-100 border-red-300 text-red-800"},o=p.useMemo(()=>Object.entries(l).sort((x,j)=>j[1]-x[1]).slice(0,n),[l,n]),C=(x,j)=>{try{const{description:S}=Q(x);return`${x}: ${S} (mentioned ${j} time${j!==1?"s":""})`}catch{return`${x}: mentioned ${j} time${j!==1?"s":""}`}};return e.jsxs("div",{className:`flex flex-wrap justify-center items-center gap-3 p-4 overflow-hidden ${a}`,style:{height:m,maxHeight:m},children:[o.map(([x,j])=>e.jsx("span",{className:`${v(x,j)} font-medium px-2.5 py-1 inline-block rounded-md border`,style:{fontSize:12+Math.floor((j-T.min)/(T.max-T.min||1)*20),maxWidth:"100%",textOverflow:"ellipsis",overflow:"hidden",whiteSpace:"nowrap"},title:C(x,j),children:x},x)),o.length===0&&e.jsx("div",{className:"text-gray-400 italic text-sm",children:"No emotions tracked yet"})]})},Ut=Ie.object({title:Ie.string().min(3,"Title must be at least 3 characters"),content:Ie.string().min(20,"Please write at least 20 characters")});function Vt({onEntryCreated:l}){var ie,W;As();const{toast:m}=Es(),{activeUserId:a}=Ds(),[n,T]=p.useState(1),[v,o]=p.useState(!1),[C,x]=p.useState(!1),[j,S]=p.useState(null),[w,d]=p.useState([]),[t,c]=p.useState(""),f=3,b=ft({resolver:bt(Ut),defaultValues:{title:"",content:""}}),A=async i=>{switch(i){case 1:return await b.trigger("title");case 2:return await b.trigger("content");case 3:return!0;default:return!1}},M=async()=>{await A(n)&&(n===2?await I():n<f&&T(n+1))},B=()=>{n>1&&T(n-1)},I=async()=>{if(a){x(!0);try{const i=b.getValues(),$=await(await q("POST","/api/journal",{userId:a,title:i.title,content:i.content})).json();if(S($),$.emotions||$.topics){const Ae=[...$.emotions||[],...$.topics||[]];d(Ae)}T(3)}catch{m({title:"Error",description:"Failed to create journal entry",variant:"destructive"})}finally{x(!1)}}},O=async()=>{if(!(!j||!a))try{await q("POST",`/api/journal/${j.id}/tags`,{selectedTags:w}),xs.invalidateQueries({queryKey:[`/api/users/${a}/journal`]}),xs.invalidateQueries({queryKey:[`/api/users/${a}/journal/stats`]}),o(!0)}catch{m({title:"Error",description:"Failed to save tags",variant:"destructive"})}},J=i=>{d(L=>L.includes(i)?L.filter($=>$!==i):[...L,i])},P=()=>{t.trim()&&(J(t.trim()),c(""))},ae=()=>{b.reset(),T(1),S(null),d([]),o(!1),l&&l()},ne=n/f*100;return e.jsxs(e.Fragment,{children:[e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{children:[e.jsx(N,{children:"Journal Entry Wizard"}),e.jsxs(z,{children:["Step ",n," of ",f]})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(Nt,{value:ne,className:"h-2"}),e.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[e.jsx("span",{className:n>=1?"text-blue-600 font-medium":"",children:"1. Title"}),e.jsx("span",{className:n>=2?"text-blue-600 font-medium":"",children:"2. Write"}),e.jsx("span",{className:n>=3?"text-blue-600 font-medium":"",children:"3. Review Tags"})]})]})]}),e.jsx(u,{children:e.jsx(vt,{...b,children:e.jsxs("div",{className:"space-y-6",children:[n===1&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("h3",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Why Title Your Entry?"]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"A clear title helps you quickly identify and find entries later. Think of it as a headline that captures the main theme or event of your day."})]}),e.jsx(us,{control:b.control,name:"title",render:({field:i})=>e.jsxs(gs,{children:[e.jsxs(ps,{className:"text-lg flex items-center gap-2",children:["Entry Title ",e.jsx("span",{className:"text-red-500 text-xl",children:"*"})]}),e.jsx(js,{children:e.jsx(me,{placeholder:"e.g., A Challenging Day at Work, Weekend Reflections...",className:"text-base",...i,"data-testid":"input-journal-title"})}),e.jsx(fs,{children:"Give your entry a descriptive title (at least 3 characters)"}),e.jsx(vs,{})]})})]}),n===2&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("h3",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Why Journal?"]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"Writing helps you process emotions, understand patterns, and gain insights. Express yourself freely without judgment - this is your safe space."})]}),e.jsx(us,{control:b.control,name:"content",render:({field:i})=>e.jsxs(gs,{children:[e.jsxs(ps,{className:"text-lg flex items-center gap-2",children:["What's on your mind? ",e.jsx("span",{className:"text-red-500 text-xl",children:"*"})]}),e.jsx(js,{children:e.jsx(He,{placeholder:"Write about your thoughts, feelings, experiences... Be as detailed as you like.",className:"resize-none min-h-[200px] text-base",...i,"data-testid":"textarea-journal-content"})}),e.jsx(fs,{children:"Write at least 20 characters to capture your thoughts"}),e.jsx(vs,{}),i.value&&i.value.length<20&&e.jsxs("p",{className:"text-sm text-amber-600 mt-2",children:["Keep writing... (",i.value.length,"/20 characters minimum)"]})]})})]}),n===3&&e.jsx("div",{className:"space-y-4",children:C?e.jsxs("div",{className:"flex flex-col items-center justify-center py-12 space-y-4",children:[e.jsx("div",{className:"animate-spin h-12 w-12 border-4 border-primary border-t-transparent rounded-full"}),e.jsx("p",{className:"text-lg font-medium",children:"AI is analyzing your entry..."}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Detecting emotions and themes"})]}):j?e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-blue-50 dark:bg-blue-950/30 p-4 rounded-lg border border-blue-200 dark:border-blue-800",children:[e.jsxs("h3",{className:"font-medium text-sm mb-2 flex items-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),"Review AI-Detected Tags"]}),e.jsx("p",{className:"text-sm text-gray-700 dark:text-gray-300",children:"AI has identified emotions and topics in your entry. Review and select the tags that feel right. You can also add your own custom tags."})]}),j.aiAnalysis&&e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-primary"}),"AI Insights"]})}),e.jsx(u,{children:e.jsx("p",{className:"text-sm text-muted-foreground",children:j.aiAnalysis})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-rose-500"}),"Emotions"]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(ie=j.emotions)==null?void 0:ie.map((i,L)=>{const{color:$}=Q(i);return e.jsxs(D,{variant:w.includes(i)?"default":"outline",className:`cursor-pointer hover:opacity-80 transition-colors ${w.includes(i)?"":$}`,onClick:()=>J(i),children:[i,w.includes(i)&&e.jsx(Se,{className:"h-3 w-3 ml-1"})]},`${i}-${L}`)}),(!j.emotions||j.emotions.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No emotions detected"})]})})]}),e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-blue-500"}),"Topics"]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(W=j.topics)==null?void 0:W.map((i,L)=>{const{color:$}=Q(i);return e.jsxs(D,{variant:w.includes(i)?"default":"outline",className:`cursor-pointer hover:opacity-80 transition-colors ${w.includes(i)?"":$}`,onClick:()=>J(i),children:[i,w.includes(i)&&e.jsx(Se,{className:"h-3 w-3 ml-1"})]},`${i}-${L}`)}),(!j.topics||j.topics.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No topics detected"})]})})]})]}),e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ms,{className:"h-4 w-4 text-green-500"}),"Add Custom Tag"]})}),e.jsx(u,{children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(me,{value:t,onChange:i=>c(i.target.value),placeholder:"Enter a custom tag",onKeyDown:i=>{i.key==="Enter"&&(i.preventDefault(),P())}}),e.jsx(k,{type:"button",onClick:P,disabled:!t.trim(),size:"sm",children:"Add"})]})})]}),e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsxs(N,{className:"text-sm flex items-center gap-2",children:[e.jsx(Ze,{className:"h-4 w-4 text-purple-500"}),"Selected Tags (",w.length,")"]})}),e.jsx(u,{children:w.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((i,L)=>e.jsxs(D,{className:"bg-primary/20 text-primary border-primary/30 hover:bg-primary/30 cursor-pointer flex items-center gap-1",onClick:()=>J(i),children:[i,e.jsx(_e,{className:"h-3 w-3"})]},`selected-${i}-${L}`))}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No tags selected. Click on emotions or topics above to select them."})})]})]}):null}),e.jsxs("div",{className:"flex justify-between pt-4",children:[e.jsxs(k,{type:"button",variant:"outline",onClick:B,disabled:n===1||C,children:[e.jsx(yt,{className:"mr-2 h-4 w-4"}),"Previous"]}),n<f?e.jsxs(k,{type:"button",onClick:M,disabled:C,children:[n===2?"Analyze Entry":"Next",e.jsx(lt,{className:"ml-2 h-4 w-4"})]}):e.jsxs(k,{type:"button",onClick:O,disabled:C,"data-testid":"button-complete-journal",children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Save Entry"]})]})]})})})]}),e.jsx(Z,{open:v,onOpenChange:i=>{o(i),i||ae()},children:e.jsxs(ee,{children:[e.jsxs(se,{children:[e.jsxs(te,{className:"flex items-center gap-2 text-green-600",children:[e.jsx(re,{className:"h-5 w-5"}),"Journal Entry Saved!"]}),e.jsxs(ke,{children:["Your entry has been saved with ",w.length," tag",w.length!==1?"s":"","."]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs(h,{children:[e.jsx(g,{className:"pb-2",children:e.jsx(N,{className:"text-sm",children:"Entry Summary"})}),e.jsxs(u,{children:[e.jsx("p",{className:"font-medium",children:b.getValues("title")}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1 line-clamp-2",children:b.getValues("content")})]})]}),w.length>0&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Selected Tags:"}),e.jsx("div",{className:"flex flex-wrap gap-2",children:w.map((i,L)=>e.jsx(D,{variant:"secondary",children:i},L))})]})]}),e.jsx(de,{children:e.jsx(k,{onClick:ae,children:"Write Another Entry"})})]})})]})}const Ss=["#8884d8","#82ca9d","#ffc658","#ff7c7c","#a18dff","#ff9f9f","#6ec9c9","#ffb347","#c9a0dc","#99c9ff"];function Kt({userId:l}){const[m,a]=p.useState("month"),{data:n=[],isLoading:T}=ye({queryKey:[`/api/users/${l}/journal`],enabled:!!l}),v=()=>{let d;if(m==="week")d=ce(new Date,7);else if(m==="month")d=ce(new Date,30);else{if(n.length===0)return[];d=new Date(Math.min(...n.map(c=>new Date(c.createdAt).getTime())))}return Be({start:d,end:new Date}).map(c=>{const f=F(c,"yyyy-MM-dd"),b=n.filter(I=>F(new Date(I.createdAt),"yyyy-MM-dd")===f),A=b.length>0?b.reduce((I,O)=>I+(O.sentimentPositive||0),0)/b.length*100:0,M=b.length>0?b.reduce((I,O)=>I+(O.sentimentNegative||0),0)/b.length*100:0,B=b.length>0?b.reduce((I,O)=>I+(O.sentimentNeutral||0),0)/b.length*100:0;return{date:F(c,"MMM d"),positive:parseFloat(A.toFixed(1)),negative:parseFloat(M.toFixed(1)),neutral:parseFloat(B.toFixed(1)),count:b.length}})},o=()=>Be({start:ce(new Date,29),end:new Date}).map(t=>{const c=F(t,"yyyy-MM-dd"),f=n.filter(b=>F(new Date(b.createdAt),"yyyy-MM-dd")===c);return{date:F(t,"MMM d"),count:f.length}}),C=()=>{const d={};return n.forEach(t=>{t.emotions&&Array.isArray(t.emotions)&&t.emotions.forEach(c=>{d[c]=(d[c]||0)+1})}),Object.entries(d).map(([t,c])=>({name:t,value:c})).sort((t,c)=>c.value-t.value).slice(0,8)},x=()=>{const d={};return n.forEach(t=>{t.topics&&Array.isArray(t.topics)&&t.topics.forEach(c=>{d[c]=(d[c]||0)+1})}),Object.entries(d).map(([t,c])=>({topic:t,count:c})).sort((t,c)=>c.count-t.count).slice(0,10)},j=()=>{let d;if(m==="week")d=ce(new Date,7);else if(m==="month")d=ce(new Date,30);else{if(n.length===0)return[];d=new Date(Math.min(...n.map(c=>new Date(c.createdAt).getTime())))}return Be({start:d,end:new Date}).map(c=>{const f=F(c,"yyyy-MM-dd"),b=n.filter(M=>F(new Date(M.createdAt),"yyyy-MM-dd")===f&&M.mood),A=b.length>0?b.reduce((M,B)=>M+(B.mood||0),0)/b.length:0;return{date:F(c,"MMM d"),mood:parseFloat(A.toFixed(1)),count:b.length}})},S=()=>{var b;const d=n.length,t=n.length>0?n.reduce((A,M)=>A+(M.sentimentPositive||0),0)/n.length*100:0,c=n.filter(A=>A.mood).length>0?n.filter(A=>A.mood).reduce((A,M)=>A+(M.mood||0),0)/n.filter(A=>A.mood).length:0,f=((b=C()[0])==null?void 0:b.name)||"None";return{totalEntries:d,avgPositivity:parseFloat(t.toFixed(1)),avgMood:parseFloat(c.toFixed(1)),mostCommonEmotion:f}};if(T)return e.jsx("div",{className:"flex items-center justify-center py-12",children:e.jsx("div",{className:"animate-spin h-8 w-8 border-4 border-primary border-t-transparent rounded-full"})});if(n.length===0)return e.jsx(h,{children:e.jsx(u,{className:"py-12 text-center",children:e.jsx("p",{className:"text-muted-foreground",children:"No journal entries yet. Start writing to see insights!"})})});const w=S();return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium",children:"Total Entries"})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:w.totalEntries}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Journal entries written"})]})]}),e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium",children:"Avg Positivity"})}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold text-green-600",children:[w.avgPositivity,"%"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Positive sentiment"})]})]}),e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium",children:"Avg Mood"})}),e.jsxs(u,{children:[e.jsxs("div",{className:"text-2xl font-bold text-blue-600",children:[w.avgMood,"/10"]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Self-reported mood"})]})]}),e.jsxs(h,{children:[e.jsx(g,{className:"pb-3",children:e.jsx(N,{className:"text-sm font-medium",children:"Most Common"})}),e.jsxs(u,{children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:w.mostCommonEmotion}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Detected emotion"})]})]})]}),e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5 text-primary"}),e.jsx(N,{children:"Sentiment Trends"})]}),e.jsx(Ye,{value:m,onValueChange:d=>a(d),className:"w-auto",children:e.jsxs(Qe,{children:[e.jsx(V,{value:"week",children:"Week"}),e.jsx(V,{value:"month",children:"Month"}),e.jsx(V,{value:"all",children:"All Time"})]})})]}),e.jsx(z,{children:"AI-detected sentiment in your journal entries"})]}),e.jsx(u,{children:e.jsx(ve,{width:"100%",height:300,children:e.jsxs(ys,{data:v(),children:[e.jsx(Oe,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"date"}),e.jsx(We,{domain:[0,100]}),e.jsx(be,{}),e.jsx(Ns,{}),e.jsx(Ne,{type:"monotone",dataKey:"positive",stroke:"#82ca9d",strokeWidth:2,name:"Positive %"}),e.jsx(Ne,{type:"monotone",dataKey:"negative",stroke:"#ff7c7c",strokeWidth:2,name:"Negative %"}),e.jsx(Ne,{type:"monotone",dataKey:"neutral",stroke:"#8884d8",strokeWidth:2,name:"Neutral %"})]})})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ot,{className:"h-5 w-5 text-primary"}),e.jsx(N,{children:"Detected Emotions"})]}),e.jsx(z,{children:"AI-identified emotions in your writing"})]}),e.jsx(u,{children:C().length>0?e.jsx(ve,{width:"100%",height:300,children:e.jsxs(Ct,{children:[e.jsx(Tt,{data:C(),cx:"50%",cy:"50%",labelLine:!1,label:({name:d,percent:t})=>`${d} ${(t*100).toFixed(0)}%`,outerRadius:80,fill:"#8884d8",dataKey:"value",children:C().map((d,t)=>e.jsx(wt,{fill:Ss[t%Ss.length]},`cell-${t}`))}),e.jsx(be,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:"No emotions detected yet"})})]}),e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Y,{className:"h-5 w-5 text-primary"}),e.jsx(N,{children:"Topic Analysis"})]}),e.jsx(z,{children:"Common themes in your journal"})]}),e.jsx(u,{children:x().length>0?e.jsx(ve,{width:"100%",height:300,children:e.jsxs(St,{data:x(),children:[e.jsx(Oe,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"topic",angle:-45,textAnchor:"end",height:100}),e.jsx(We,{}),e.jsx(be,{}),e.jsx(kt,{dataKey:"count",fill:"#8884d8"})]})}):e.jsx("div",{className:"flex items-center justify-center h-[300px] text-muted-foreground",children:"No topics detected yet"})})]})]}),e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Xe,{className:"h-5 w-5 text-primary"}),e.jsx(N,{children:"30-Day Writing Calendar"})]}),e.jsx(z,{children:"Your journaling consistency over the past month"})]}),e.jsxs(u,{children:[e.jsx("div",{className:"grid grid-cols-10 gap-1",children:o().map((d,t)=>{const c=d.count,f=c===0?"bg-gray-100 dark:bg-gray-800":c===1?"bg-green-200 dark:bg-green-900":c===2?"bg-green-400 dark:bg-green-700":"bg-green-600 dark:bg-green-500";return e.jsx("div",{className:`aspect-square rounded ${f} flex items-center justify-center text-xs font-medium relative group`,title:`${d.date}: ${c} entries`,children:e.jsxs("div",{className:"opacity-0 group-hover:opacity-100 absolute -top-12 left-1/2 transform -translate-x-1/2 bg-black text-white text-xs rounded px-2 py-1 whitespace-nowrap z-10",children:[d.date,": ",c," ",c===1?"entry":"entries"]})},t)})}),e.jsxs("div",{className:"flex items-center justify-center gap-4 mt-4 text-xs text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-100 dark:bg-gray-800 rounded"}),e.jsx("span",{children:"None"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-200 dark:bg-green-900 rounded"}),e.jsx("span",{children:"1 entry"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 dark:bg-green-700 rounded"}),e.jsx("span",{children:"2 entries"})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("div",{className:"w-3 h-3 bg-green-600 dark:bg-green-500 rounded"}),e.jsx("span",{children:"3+ entries"})]})]})]})]}),n.some(d=>d.mood)&&e.jsxs(h,{children:[e.jsxs(g,{children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ge,{className:"h-5 w-5 text-primary"}),e.jsx(N,{children:"Mood Trends"})]}),e.jsx(Ye,{value:m,onValueChange:d=>a(d),className:"w-auto",children:e.jsxs(Qe,{children:[e.jsx(V,{value:"week",children:"Week"}),e.jsx(V,{value:"month",children:"Month"}),e.jsx(V,{value:"all",children:"All Time"})]})})]}),e.jsx(z,{children:"Your self-reported mood ratings over time"})]}),e.jsx(u,{children:e.jsx(ve,{width:"100%",height:300,children:e.jsxs(ys,{data:j(),children:[e.jsx(Oe,{strokeDasharray:"3 3"}),e.jsx(qe,{dataKey:"date"}),e.jsx(We,{domain:[0,10]}),e.jsx(be,{}),e.jsx(Ns,{}),e.jsx(Ne,{type:"monotone",dataKey:"mood",stroke:"#8884d8",strokeWidth:2,name:"Mood Rating"})]})})})]})]})}function Ke(l){return{"all-or-nothing thinking":"Viewing situations in absolute, black-and-white categories without considering middle ground.",catastrophizing:"Expecting the worst possible outcome and exaggerating the importance of negative events.","emotional reasoning":"Believing that feelings reflect realityâ€”'I feel it, therefore it must be true.'","fortune telling":"Predicting negative outcomes without adequate evidence.",labeling:"Attaching a negative label to yourself or others instead of describing specific behaviors.",magnification:"Exaggerating the importance of problems or shortcomings while minimizing successes.","mental filtering":"Focusing exclusively on negative aspects while filtering out all positive information.","mind reading":"Assuming you know what others are thinking without sufficient evidence.",overgeneralization:"Drawing broad negative conclusions based on a single incident.",personalization:"Believing you're responsible for external events outside your control.","should statements":"Imposing rigid demands on yourself or others with 'should', 'must', or 'ought to' statements.","disqualifying the positive":"Rejecting positive experiences by insisting they 'don't count'.","jumping to conclusions":"Making negative interpretations without supporting facts.",minimization:"Downplaying or dismissing your positive qualities or achievements."}[l.toLowerCase()]||"A pattern of thought that may distort your perception of reality or situations."}function zr(){var is,ls,os,cs,ds;const{toast:l}=Es(),m=tt(),{user:a}=As();rt();const{activeUserId:n,isViewingSelf:T}=Ds(),{refreshAfterOperation:v}=at(),o=n,[C,x]=p.useState((a==null?void 0:a.role)==="therapist"||(a==null?void 0:a.role)==="admin"?"history":"write"),[j,S]=p.useState(!1),[w,d]=p.useState(!1),[t,c]=p.useState(null),[f,b]=p.useState(null),[A,M]=p.useState(""),[B,I]=p.useState(""),[O,J]=p.useState(""),[P,ae]=p.useState([]),[ne,ie]=p.useState([]),[W,i]=p.useState(""),[L,$]=p.useState(!1),[Ae,le]=p.useState(!1),[he,ue]=p.useState([]),{data:_=[],isLoading:Ws}=ye({queryKey:["/api/users/:userId/journal",o],queryFn:async()=>o?await(await q("GET",`/api/users/${o}/journal`)).json():[],enabled:!!o}),{data:E={totalEntries:0,emotions:{},topics:{},sentimentOverTime:[],tagsFrequency:{},sentimentPatterns:null}}=ye({queryKey:["/api/users/:userId/journal/stats",o],queryFn:async()=>o?await(await q("GET",`/api/users/${o}/journal/stats`)).json():{totalEntries:0,emotions:{},topics:{},sentimentOverTime:[],tagsFrequency:{},sentimentPatterns:null},enabled:!!o}),{data:G=[]}=ye({queryKey:["/api/users/:userId/thoughts",o],queryFn:async()=>o?await(await q("GET",`/api/users/${o}/thoughts`)).json():[],enabled:!!o}),Ee=K({mutationFn:async s=>{if(!o)throw new Error("User not authenticated");return(await q("POST","/api/journal",s)).json()},onSuccess:s=>{v("journal","create",s.id,"Journal entry created successfully! You can view it in your journal history.",!1),M(""),I(""),x("history")},onError:s=>{l({title:"Error Creating Entry",description:s.message,variant:"destructive"})}}),De=K({mutationFn:async({id:s,updates:r})=>{if(!o)throw new Error("User not authenticated");return(await q("PATCH",`/api/journal/${s}`,r)).json()},onSuccess:(s,r)=>{v("journal","update",r.id,"Your journal entry has been updated.",!1),S(!1),M(""),I("")},onError:s=>{l({title:"Error Updating Entry",description:s.message,variant:"destructive"})}}),Me=K({mutationFn:async s=>{if(!o)throw new Error("User not authenticated");await q("DELETE",`/api/journal/${s}`)},onSuccess:(s,r)=>{v("journal","delete",r,"Your journal entry has been deleted.",!1),S(!1),$(!1),c(null),x("list")},onError:s=>{l({title:"Error Deleting Entry",description:s.message,variant:"destructive"})}}),Pe=K({mutationFn:async({entryId:s,comment:r})=>{if(!o)throw new Error("User not authenticated");return console.log("Sending comment API request to:",`/api/journal/${s}/comments`),(await q("POST",`/api/journal/${s}/comments`,{content:r})).json()},onSuccess:s=>{if(console.log("Comment added successfully:",s),v("journal_comment","create",t==null?void 0:t.id,"Your comment has been added to the journal entry.",!1),t){const y=[...Array.isArray(t.comments)?t.comments:[],s];c({...t,comments:y}),J("")}},onError:s=>{console.error("Error adding comment:",s),l({title:"Error Adding Comment",description:s.message,variant:"destructive"})}}),X=K({mutationFn:async()=>!t||!o?null:(await q("PATCH",`/api/journal/${t.id}`,{userSelectedTags:P})).json(),onSuccess:s=>{s&&(v("journal_tags","update",s.id,"Tags have been updated successfully.",!1),c(s),m.invalidateQueries({queryKey:["/api/users/:userId/journal/stats",o]}),C==="stats"&&(x("view"),setTimeout(()=>x("stats"),100)),l({title:"Tags Updated",description:"Your tags have been updated."}))},onError:s=>{l({title:"Error Updating Tags",description:s.message,variant:"destructive"})}}),$e=K({mutationFn:async()=>!t||!o?null:(await q("PATCH",`/api/journal/${t.id}`,{userSelectedDistortions:ne})).json(),onSuccess:s=>{s&&(v("journal_distortions","update",s.id,"Your selected cognitive distortions have been updated.",!1),c(s),m.invalidateQueries({queryKey:["/api/users/:userId/journal/stats",o]}))},onError:s=>{l({title:"Error Updating Distortions",description:s.message,variant:"destructive"})}}),Bs=K({mutationFn:async s=>{if(!t||!o)throw console.error("Missing currentEntry or userId",{currentEntry:t,userId:o}),new Error("Missing required data for linking");return console.log("Linking thought record:",s,"to journal entry:",t.id),(await q("POST",`/api/users/${o}/journal/${t.id}/link-thought`,{thoughtRecordId:s})).json()},onSuccess:s=>{console.log("Record linked successfully:",s),v("journal_link_thought","update",s.id,"Thought record has been linked to this journal entry.",!1),ns(s),m.invalidateQueries({queryKey:["/api/users/:userId/thoughts",o]}),le(!1)},onError:s=>{console.error("Error linking thought record:",s),l({title:"Error Linking Record",description:s.message,variant:"destructive"})}}),Us=K({mutationFn:async s=>{if(!t||!o)throw console.error("Missing currentEntry or userId",{currentEntry:t,userId:o}),new Error("Missing required data for unlinking");return console.log("Unlinking thought record:",s,"from journal entry:",t.id),(await q("DELETE",`/api/users/${o}/journal/${t.id}/link-thought/${s}`)).json()},onSuccess:s=>{console.log("Record unlinked successfully:",s),v("journal_unlink_thought","update",s.id,"Thought record has been unlinked from this journal entry.",!1),ns(s),m.invalidateQueries({queryKey:["/api/users/:userId/thoughts",o]})},onError:s=>{console.error("Error unlinking thought record:",s),l({title:"Error Unlinking Record",description:s.message,variant:"destructive"})}}),ns=async(s,r=!1)=>{if(c(s),ae(s.userSelectedTags||s.emotions||[]),ie(s.userSelectedDistortions||s.detectedDistortions||[]),r&&d(!0),s.relatedThoughtRecordIds&&s.relatedThoughtRecordIds.length>0&&G.length>0){const y=G.filter(R=>{var ms;return(ms=s.relatedThoughtRecordIds)==null?void 0:ms.includes(R.id)});ue(y)}else ue([])},Vs=()=>{!A.trim()||!B.trim()||(t?De.mutate({id:t.id,updates:{title:A,content:B}}):Ee.mutate({title:A,content:B}))},Ks=s=>{c(s),M(s.title),I(s.content),S(!0)},Js=s=>{c(s),$(!0)},_s=()=>{t&&Me.mutate(t.id)},Fe=s=>{if(s.relatedThoughtRecordIds&&s.relatedThoughtRecordIds.length>0&&G.length>0){const r=G.filter(y=>{var R;return(R=s.relatedThoughtRecordIds)==null?void 0:R.includes(y.id)});ue(r)}else ue([]);b(s)},U=s=>{ae(r=>r.includes(s)?r.filter(y=>y!==s):[...r,s])},Hs=s=>{ie(r=>r.includes(s)?r.filter(y=>y!==s):[...r,s])},Ys=s=>{s.preventDefault(),X.mutate()},Re=s=>{s&&t&&X.mutate(),d(!1),x("view")},Qs=s=>{s.preventDefault(),$e.mutate()},Gs=s=>{s.preventDefault(),!(!O.trim()||!t)&&(console.log("Adding comment:",O,"to entry:",t.id),Pe.mutate({entryId:t.id,comment:O}))},Xs=s=>{Bs.mutate(s)},Zs=s=>{Us.mutate(s)},H=T||(a==null?void 0:a.role)==="client";return e.jsx(Et,{title:"Journal",children:e.jsxs("div",{className:"container py-6 px-8 max-w-6xl ml-4",children:[e.jsx(nt,{}),e.jsx(it,{title:"Journal",description:"Reflect on your thoughts, feelings, and experiences through daily journaling",badges:[]}),E.totalEntries>0&&e.jsxs(h,{className:"mb-6 bg-gradient-to-br from-primary/5 to-primary/10 border-primary/20",children:[e.jsx(g,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ws,{className:"h-5 w-5 text-primary"}),e.jsx(N,{className:"text-lg",children:"Overall Progress"})]})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"text-center p-3 bg-white/50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-primary",children:E.totalEntries}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Total Entries"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-teal-600",children:Object.keys(E.emotions).length>0?Object.entries(E.emotions).sort((s,r)=>r[1]-s[1])[0][0]:"None"}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Most Common Emotion"})]}),e.jsxs("div",{className:"text-center p-3 bg-white/50 dark:bg-slate-800/50 rounded-lg",children:[e.jsx("div",{className:"text-2xl font-bold text-rose-600",children:Object.keys(E.emotions).length}),e.jsx("div",{className:"text-sm text-muted-foreground",children:"Unique Emotions"})]})]})})]}),e.jsxs(Ye,{value:C,onValueChange:x,defaultValue:(a==null?void 0:a.role)==="therapist"||(a==null?void 0:a.role)==="admin"?"history":"write",children:[e.jsxs(Qe,{className:"mb-4",children:[(a==null?void 0:a.role)==="client"&&e.jsxs(V,{value:"write",children:[e.jsx(Ft,{className:"mr-2 h-4 w-4"}),"Write Entry"]}),e.jsxs(V,{value:"history",children:[e.jsx(Y,{className:"mr-2 h-4 w-4"}),(a==null?void 0:a.role)==="therapist"||(a==null?void 0:a.role)==="admin"?"Client's Journal":"My Journal"]}),e.jsxs(V,{value:"insights",children:[e.jsx(Ge,{className:"mr-2 h-4 w-4"}),"Insights"]})]}),(a==null?void 0:a.role)==="client"&&e.jsxs(oe,{value:"write",children:[e.jsx(ut,{type:"single",collapsible:!0,className:"mb-6 bg-teal-50 dark:bg-teal-950/30 rounded-lg px-4",children:e.jsxs(gt,{value:"why-journal",className:"border-0",children:[e.jsx(pt,{className:"text-base font-medium hover:no-underline py-3",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(we,{className:"h-5 w-5 mr-2 text-teal-600 dark:text-teal-400"}),"Why Journal?"]})}),e.jsxs(jt,{className:"text-sm text-muted-foreground pb-4",children:[e.jsx("p",{className:"mb-3",children:"Journaling is a powerful tool for self-reflection and emotional processing. It helps you understand patterns in your thoughts and feelings, track your progress, and gain valuable insights into your mental well-being."}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"bg-white dark:bg-slate-900/50 p-3 rounded-md",children:[e.jsx("h4",{className:"font-medium text-foreground mb-1",children:"Process Emotions"}),e.jsx("p",{children:"Writing about your feelings helps you make sense of them and reduces emotional intensity. It's a safe space to express yourself without judgment."})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900/50 p-3 rounded-md",children:[e.jsx("h4",{className:"font-medium text-foreground mb-1",children:"Track Patterns"}),e.jsx("p",{children:"Over time, your journal entries reveal patterns in your mood, triggers, and coping strategies, helping you understand yourself better."})]}),e.jsxs("div",{className:"bg-white dark:bg-slate-900/50 p-3 rounded-md",children:[e.jsx("h4",{className:"font-medium text-foreground mb-1",children:"Support Growth"}),e.jsx("p",{children:"Regular journaling documents your journey, celebrates progress, and provides insights that support your ongoing mental health and personal growth."})]})]})]})]})}),e.jsx(Vt,{onEntryCreated:()=>x("history")})]}),e.jsx(oe,{value:"history",children:Ws?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:[1,2,3,4,5,6].map(s=>e.jsxs(h,{className:"animate-pulse",children:[e.jsx(g,{className:"h-24 bg-muted/50"}),e.jsxs(u,{className:"h-40 space-y-2",children:[e.jsx("div",{className:"h-4 w-3/4 bg-muted rounded"}),e.jsx("div",{className:"h-20 bg-muted rounded"})]})]},s))}):_.length>0?e.jsx("div",{className:"grid gap-4 md:grid-cols-2",children:_.map(s=>e.jsxs(h,{className:"overflow-hidden",children:[e.jsxs(g,{className:"pb-2",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(N,{className:"text-lg",children:s.title}),e.jsxs(ct,{children:[e.jsx(dt,{asChild:!0,children:e.jsx(k,{variant:"ghost",size:"icon",className:"h-8 w-8",children:e.jsx(At,{className:"h-4 w-4"})})}),e.jsxs(mt,{align:"end",children:[e.jsxs(ze,{onClick:()=>Fe(s),children:[e.jsx(ks,{className:"h-4 w-4 mr-2"}),"View Details"]}),H&&e.jsxs(e.Fragment,{children:[e.jsxs(ze,{onClick:()=>Ks(s),children:[e.jsx(Ue,{className:"h-4 w-4 mr-2"}),"Edit"]}),e.jsx(xt,{}),e.jsxs(ze,{onClick:()=>Js(s),className:"text-destructive focus:text-destructive",children:[e.jsx(Cs,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})]})]}),e.jsxs(z,{className:"flex items-center text-xs",children:[e.jsx(Xe,{className:"mr-1 h-3 w-3"}),F(new Date(s.createdAt),"MMM d, yyyy")]})]}),e.jsxs(u,{className:"pb-2",children:[e.jsx("div",{className:"cursor-pointer",onClick:()=>Fe(s),children:e.jsx("p",{className:"text-sm line-clamp-3 mb-2",children:s.content})}),s.userSelectedTags&&s.userSelectedTags.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mt-1",children:[s.userSelectedTags.slice(0,3).map((r,y)=>e.jsx(D,{variant:"outline",className:"text-xs",children:r},y)),s.userSelectedTags.length>3&&e.jsxs(D,{variant:"outline",className:"text-xs",children:["+",s.userSelectedTags.length-3," more"]})]})]}),e.jsxs(hs,{className:"pt-0",children:[e.jsxs(k,{variant:"ghost",size:"sm",className:"text-xs text-muted-foreground p-0 h-auto",onClick:()=>Fe(s),children:[e.jsx(ks,{className:"mr-1 h-3 w-3"}),"View Details"]}),s.comments&&s.comments.length>0&&e.jsxs("div",{className:"ml-auto flex items-center text-xs text-muted-foreground",children:[e.jsx(Le,{className:"mr-1 h-3 w-3"}),s.comments.length]})]})]},s.id))}):e.jsx(h,{children:e.jsxs(g,{children:[e.jsx(N,{children:"No Journal Entries"}),e.jsx(z,{children:(a==null?void 0:a.role)==="client"?"You haven't created any journal entries yet. Switch to the 'Write Entry' tab to get started.":"This client hasn't created any journal entries yet."})]})})}),e.jsx(oe,{value:"view",children:t&&e.jsx("div",{className:"space-y-8",children:e.jsxs(h,{children:[e.jsx(g,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold tracking-tight mb-1",children:t.title||"Untitled Entry"}),e.jsxs("div",{className:"flex items-center gap-2 text-sm text-muted-foreground",children:[e.jsx(Xe,{size:14}),e.jsx("span",{children:F(new Date(t.createdAt),"MMMM d, yyyy 'at' h:mm a")}),t.updatedAt&&t.updatedAt!==t.createdAt&&e.jsxs("span",{className:"text-xs italic",children:["(edited ",F(new Date(t.updatedAt),"MMM d, yyyy"),")"]})]})]}),H&&e.jsxs("div",{className:"flex gap-2",children:[e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>{M(t.title),I(t.content),S(!0)},children:[e.jsx(Ue,{size:16,className:"mr-1"}),"Edit"]}),e.jsx(k,{variant:"ghost",size:"icon",onClick:()=>$(!0),children:e.jsx(Cs,{size:16})})]})]})}),e.jsxs(u,{className:"space-y-6",children:[e.jsx("div",{className:"whitespace-pre-wrap p-4 border rounded-md bg-white shadow-sm",children:t.content}),e.jsxs("div",{className:"p-4 border rounded-md bg-slate-50/50",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Y,{size:16}),"Tag Editor"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h5",{className:"text-xs font-semibold flex items-center gap-1",children:[e.jsx(Te,{size:14,className:"text-red-500"}),"Suggested Emotions"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:(is=t.emotions)==null?void 0:is.map((s,r)=>e.jsxs(D,{variant:"outline",className:`
                                cursor-pointer
                                ${P.includes(s)?"bg-red-100 border-red-200":"bg-white hover:bg-red-50"}
                              `,onClick:()=>U(s),children:[s,P.includes(s)&&e.jsx(re,{size:12,className:"ml-1"})]},`emotion-${r}`))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h5",{className:"text-xs font-semibold flex items-center gap-1",children:[e.jsx(ht,{size:14,className:"text-amber-500"}),"Topics"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:(ls=t.topics)==null?void 0:ls.map((s,r)=>e.jsxs(D,{variant:"outline",className:`
                                cursor-pointer
                                ${P.includes(s)?"bg-amber-100 border-amber-200":"bg-white hover:bg-amber-50"}
                              `,onClick:()=>U(s),children:[s,P.includes(s)&&e.jsx(re,{size:12,className:"ml-1"})]},`topic-${r}`))})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("h5",{className:"text-xs font-semibold flex items-center gap-1",children:[e.jsx(Ze,{size:14,className:"text-blue-500"}),"Selected Tags"]}),e.jsx("div",{className:"flex flex-wrap gap-1",children:P.length>0?P.map((s,r)=>e.jsxs(D,{variant:"outline",className:"bg-blue-100 border-blue-200",children:[s,e.jsx(_e,{size:12,className:"ml-1 cursor-pointer",onClick:()=>U(s)})]},`selected-${r}`)):e.jsx("p",{className:"text-xs text-muted-foreground",children:"No tags selected yet"})})]})]}),H&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"flex gap-2 mt-4",children:[e.jsx(me,{type:"text",placeholder:"Add a custom tag...",value:W,onChange:s=>i(s.target.value),onKeyDown:s=>{s.key==="Enter"&&W.trim()&&(s.preventDefault(),U(W.trim()),i(""))}}),e.jsx(k,{size:"sm",onClick:()=>{W.trim()&&(U(W.trim()),i(""))},children:"Add"})]}),e.jsx(k,{onClick:Ys,disabled:X.isPending,className:"w-full mt-3",size:"sm",children:X.isPending?"Saving...":"Save Selected Tags"})]})]}),t.detectedDistortions&&t.detectedDistortions.length>0&&e.jsxs("div",{className:"p-4 border rounded-md bg-orange-50/50",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Ve,{size:16,className:"text-orange-500"}),"Detected Cognitive Distortions"]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:t.detectedDistortions.map(s=>e.jsx(ge,{children:e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(D,{variant:"outline",className:`
                                    cursor-pointer
                                    ${ne.includes(s)?"bg-orange-200 border-orange-300":"bg-orange-50 border-orange-100 hover:bg-orange-100"}
                                  `,onClick:()=>Hs(s),children:[s,ne.includes(s)&&e.jsx(re,{size:12,className:"ml-1 text-orange-600"})]})}),e.jsx(fe,{children:e.jsx("div",{className:"max-w-xs",children:Ke(s)})})]})},s))}),H&&e.jsx(k,{onClick:Qs,disabled:$e.isPending,className:"w-full",size:"sm",variant:"outline",children:$e.isPending?"Saving...":"Confirm Selected Distortions"})]}),t.aiAnalysis&&e.jsxs("div",{className:"p-4 border rounded-md bg-violet-50/50",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-3 flex items-center gap-2",children:[e.jsx(Ce,{size:16,className:"text-violet-500"}),"AI Analysis"]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap",children:t.aiAnalysis})]}),e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("div",{className:"flex justify-between items-center mb-3",children:[e.jsxs("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[e.jsx(bs,{size:16}),"Related Thought Records"]}),H&&e.jsxs(k,{variant:"outline",size:"sm",onClick:()=>le(!0),children:[e.jsx(Dt,{size:14,className:"mr-1"}),"Link Record"]})]}),he.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:he.map(s=>e.jsxs(h,{className:"border",children:[e.jsxs(g,{className:"p-3",children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(N,{className:"text-sm",children:"Thought Record"}),H&&e.jsx(k,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>Zs(s.id),children:e.jsx(Rt,{size:14})})]}),e.jsx(z,{className:"text-xs",children:F(new Date(s.createdAt),"MMM d, yyyy")})]}),e.jsxs(u,{className:"p-3 pt-0",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:"Automatic Thoughts:"}),e.jsx("p",{className:"text-xs line-clamp-2 mb-2",children:s.automaticThoughts}),s.cognitiveDistortions&&s.cognitiveDistortions.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1 mb-2",children:[s.cognitiveDistortions.slice(0,2).map((r,y)=>e.jsx(D,{variant:"outline",className:"text-[10px] py-0 px-1 bg-orange-50",children:r},y)),s.cognitiveDistortions.length>2&&e.jsxs(D,{variant:"outline",className:"text-[10px] py-0 px-1",children:["+",s.cognitiveDistortions.length-2]})]})]}),e.jsx(hs,{className:"p-3 pt-0",children:e.jsx(k,{variant:"link",className:"p-0 h-auto text-xs",asChild:!0,children:e.jsxs("a",{href:`/thought-records/${s.id}`,children:[e.jsx($t,{size:12,className:"mr-1"}),"View Full Record"]})})})]},s.id))}):e.jsxs("div",{className:"text-center py-6 px-4 border border-dashed rounded",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"No thought records linked to this journal entry yet."}),H&&e.jsx(k,{variant:"link",onClick:()=>le(!0),className:"mt-2",children:"Link a thought record"})]})]}),e.jsxs("div",{className:"p-4 border rounded-md",children:[e.jsxs("h4",{className:"text-sm font-semibold mb-4 flex items-center gap-2",children:[e.jsx(Le,{size:16}),"Comments"]}),t.comments&&t.comments.length>0?e.jsx("div",{className:"space-y-4 mb-4",children:t.comments.map(s=>{var r,y,R;return e.jsxs("div",{className:"flex gap-3",children:[e.jsx(es,{className:"h-8 w-8",children:e.jsx(ss,{className:"text-xs bg-primary/10",children:((y=(r=s.user)==null?void 0:r.name)==null?void 0:y.substring(0,2))||"U"})}),e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-baseline gap-2",children:[e.jsx("p",{className:"text-sm font-medium",children:((R=s.user)==null?void 0:R.name)||"User"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:F(new Date(s.createdAt),"MMM d, yyyy 'at' h:mm a")})]}),e.jsx("p",{className:"text-sm mt-1",children:s.comment})]})]},s.id)})}):e.jsx("div",{className:"text-center py-4 mb-4",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No comments yet. Be the first to comment."})}),e.jsxs("form",{onSubmit:Gs,className:"flex gap-2 items-start",children:[e.jsx(es,{className:"h-8 w-8",children:e.jsx(ss,{className:"text-xs bg-primary/10",children:((os=a==null?void 0:a.username)==null?void 0:os.substring(0,2))||"U"})}),e.jsxs("div",{className:"flex-1 flex gap-2",children:[e.jsx(He,{placeholder:"Add a comment...",value:O,onChange:s=>J(s.target.value),className:"min-h-0 h-10 resize-none"}),e.jsx(k,{type:"submit",size:"icon",disabled:!O.trim()||Pe.isPending,children:Pe.isPending?e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-background border-t-transparent rounded-full"}):e.jsx(Mt,{size:16})})]})]})]})]})]})})}),e.jsx(oe,{value:"stats",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-12 gap-6",children:[e.jsxs(h,{className:"lg:col-span-12",children:[e.jsx(g,{children:e.jsx(N,{className:"text-xl",children:"Journal Stats Overview"})}),e.jsx(u,{children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2 p-4 border rounded-md",children:[e.jsx("div",{className:"bg-blue-100 p-3 rounded-md",children:e.jsx(Ue,{className:"h-5 w-5 text-blue-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Entries"}),e.jsx("p",{className:"text-2xl font-bold",children:E.totalEntries})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-4 border rounded-md",children:[e.jsx("div",{className:"bg-orange-100 p-3 rounded-md",children:e.jsx(Ve,{className:"h-5 w-5 text-orange-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Identified Cognitive Patterns"}),e.jsx("p",{className:"text-2xl font-bold",children:_.filter(s=>s.detectedDistortions&&s.detectedDistortions.length>0||s.userSelectedDistortions&&s.userSelectedDistortions.length>0).length})]})]}),e.jsxs("div",{className:"flex items-center gap-2 p-4 border rounded-md",children:[e.jsx("div",{className:"bg-green-100 p-3 rounded-md",children:e.jsx(Pt,{className:"h-5 w-5 text-green-600"})}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Avg. Entry Length"}),e.jsx("p",{className:"text-2xl font-bold",children:_.length>0?Math.round(_.reduce((s,r)=>s+r.content.length,0)/_.length):0})]})]})]})})]}),e.jsxs(h,{className:"lg:col-span-12",children:[e.jsxs(g,{children:[e.jsx(N,{className:"text-lg",children:"Emotions Word Cloud"}),e.jsx(z,{children:"Visual representation of emotions expressed in your journal entries"})]}),e.jsx(u,{children:e.jsx("div",{className:"h-48 w-full",children:Object.keys(E.emotions).length>0?e.jsx(Bt,{words:E.emotions,height:180,maxTags:40}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Not enough emotions tracked in your journal entries yet."})})})})]}),e.jsxs(h,{className:"lg:col-span-6",children:[e.jsxs(g,{children:[e.jsx(N,{className:"text-lg",children:"Emotional Patterns"}),e.jsx(z,{children:"Most frequent emotions in your journal entries"})]}),e.jsx(u,{className:"p-4",children:Object.keys(E.emotions).length>0?e.jsx("div",{className:"space-y-3",children:Object.entries(E.emotions).sort((s,r)=>r[1]-s[1]).slice(0,5).map(([s,r])=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"w-full flex-1",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r})]}),e.jsx("div",{className:"h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-blue-500 rounded-full",style:{width:`${Math.min(100,r/Math.max(...Object.values(E.emotions))*100)}%`}})})]})},s))}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Not enough data to display emotional patterns yet."})})})]}),e.jsxs(h,{className:"lg:col-span-6",children:[e.jsxs(g,{children:[e.jsx(N,{className:"text-lg",children:"Sentiment Distribution"}),e.jsx(z,{children:"Overall emotional tone of your journal entries"})]}),e.jsx(u,{className:"p-4",children:E.sentimentPatterns?e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"h-40 flex items-center justify-center",children:e.jsxs("div",{className:"grid grid-cols-3 gap-3 w-full max-w-md",children:[e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"h-28 w-28 rounded-full border-4 border-green-400 flex items-center justify-center",children:e.jsxs("p",{className:"text-2xl font-bold text-green-500",children:[E.sentimentPatterns.positive,"%"]})}),e.jsx("p",{className:"mt-2 text-sm font-medium",children:"Positive"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"h-28 w-28 rounded-full border-4 border-gray-300 flex items-center justify-center",children:e.jsxs("p",{className:"text-2xl font-bold text-gray-500",children:[E.sentimentPatterns.neutral,"%"]})}),e.jsx("p",{className:"mt-2 text-sm font-medium",children:"Neutral"})]}),e.jsxs("div",{className:"flex flex-col items-center",children:[e.jsx("div",{className:"h-28 w-28 rounded-full border-4 border-red-400 flex items-center justify-center",children:e.jsxs("p",{className:"text-2xl font-bold text-red-500",children:[E.sentimentPatterns.negative,"%"]})}),e.jsx("p",{className:"mt-2 text-sm font-medium",children:"Negative"})]})]})}),e.jsxs("div",{className:"flex justify-center space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-sm mr-1"}),"Positive"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-300 rounded-sm mr-1"}),"Neutral"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-sm mr-1"}),"Negative"]})]})]}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Not enough data to display sentiment trends yet. Keep journaling!"})})})]}),e.jsxs(h,{className:"lg:col-span-6",children:[e.jsxs(g,{children:[e.jsx(N,{className:"text-lg",children:"Topics & Themes"}),e.jsx(z,{children:"Common themes in your journaling"})]}),e.jsx(u,{className:"p-4",children:Object.keys(E.topics).length>0?e.jsx("div",{className:"space-y-3",children:Object.entries(E.topics).sort((s,r)=>r[1]-s[1]).slice(0,5).map(([s,r])=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"w-full flex-1",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("p",{className:"text-sm font-medium",children:s}),e.jsx("p",{className:"text-sm text-muted-foreground",children:r})]}),e.jsx("div",{className:"h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-amber-500 rounded-full",style:{width:`${Math.min(100,r/Math.max(...Object.values(E.topics))*100)}%`}})})]})},s))}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Not enough data to display topics yet."})})})]}),e.jsxs(h,{className:"lg:col-span-12",children:[e.jsxs(g,{children:[e.jsx(N,{className:"text-lg",children:"Cognitive Distortion Patterns"}),e.jsx(z,{children:"Thinking patterns identified in your journal entries"})]}),e.jsx(u,{className:"p-4",children:(()=>{const s={};return _.forEach(r=>{const y=[...r.detectedDistortions||[],...r.userSelectedDistortions||[]];new Set(y).forEach(R=>{s[R]=(s[R]||0)+1})}),Object.keys(s).length>0?e.jsx("div",{className:"space-y-3",children:Object.entries(s).sort((r,y)=>y[1]-r[1]).map(([r,y])=>e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"w-full flex-1",children:[e.jsxs("div",{className:"flex justify-between mb-1",children:[e.jsx("p",{className:"text-sm font-medium",children:r}),e.jsx("p",{className:"text-sm text-muted-foreground",children:y})]}),e.jsx("div",{className:"h-2 bg-slate-100 rounded-full overflow-hidden",children:e.jsx("div",{className:"h-full bg-orange-500 rounded-full",style:{width:`${Math.min(100,y/Math.max(...Object.values(s))*100)}%`}})}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:Ke(r)})]})},r))}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"No cognitive distortions identified yet."})})})()})]}),e.jsxs(h,{className:"lg:col-span-12",children:[e.jsxs(g,{children:[e.jsx(N,{className:"text-lg",children:"Sentiment Over Time"}),e.jsx(z,{children:"Tracking your emotional tone across journal entries"})]}),e.jsx(u,{className:"px-2",children:E.sentimentOverTime&&E.sentimentOverTime.length>2?e.jsx("div",{className:"h-64 w-full",children:e.jsxs("div",{className:"h-full w-full grid grid-cols-1",children:[E.sentimentOverTime.map((s,r)=>e.jsxs("div",{className:"flex items-center w-full mb-2",children:[e.jsx("div",{className:"w-24 text-xs text-muted-foreground",children:new Date(s.date).toLocaleDateString("en-US",{month:"short",day:"numeric"})}),e.jsxs("div",{className:"flex-1 flex h-6 rounded-md overflow-hidden",children:[e.jsx("div",{className:"bg-green-400",style:{width:`${s.positive*100}%`},title:`Positive: ${Math.round(s.positive*100)}%`}),e.jsx("div",{className:"bg-gray-300",style:{width:`${s.neutral*100}%`},title:`Neutral: ${Math.round(s.neutral*100)}%`}),e.jsx("div",{className:"bg-red-400",style:{width:`${s.negative*100}%`},title:`Negative: ${Math.round(s.negative*100)}%`})]})]},r)),e.jsxs("div",{className:"flex justify-end space-x-4 text-xs text-muted-foreground mt-2",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-green-400 rounded-sm mr-1"}),"Positive"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-gray-300 rounded-sm mr-1"}),"Neutral"]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-3 h-3 bg-red-400 rounded-sm mr-1"}),"Negative"]})]})]})}):e.jsx("div",{className:"text-center py-8",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Not enough data to display sentiment trends yet. Keep journaling!"})})})]})]})}),e.jsx(oe,{value:"insights",children:o&&e.jsx(Kt,{userId:o})})]}),e.jsx(Z,{open:j,onOpenChange:S,children:e.jsxs(ee,{className:"max-w-xl",children:[e.jsx(se,{children:e.jsx(te,{children:t?"Edit Journal Entry":"Create Journal Entry"})}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"title",className:"block text-sm font-medium",children:"Title"}),e.jsx(me,{id:"title",value:A,onChange:s=>M(s.target.value),placeholder:"Entry title"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium",children:"Content"}),e.jsx(He,{id:"content",value:B,onChange:s=>I(s.target.value),placeholder:"Write about your thoughts, feelings, or experiences...",className:"min-h-[200px]"})]})]}),e.jsxs(de,{children:[e.jsx(k,{variant:"outline",onClick:()=>S(!1),children:"Cancel"}),e.jsx(k,{onClick:Vs,disabled:!A.trim()||!B.trim()||Ee.isPending||De.isPending,children:Ee.isPending||De.isPending?e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-background border-t-transparent rounded-full"}):t?"Save Changes":"Create Entry"})]})]})}),e.jsx(Z,{open:L,onOpenChange:$,children:e.jsxs(ee,{className:"max-w-md",children:[e.jsx(se,{children:e.jsx(te,{children:"Delete Journal Entry"})}),e.jsx("div",{className:"py-4",children:e.jsx("p",{children:"Are you sure you want to delete this journal entry? This action cannot be undone."})}),e.jsxs(de,{children:[e.jsx(k,{variant:"outline",onClick:()=>$(!1),children:"Cancel"}),e.jsx(k,{variant:"destructive",onClick:_s,disabled:Me.isPending,children:Me.isPending?e.jsx("div",{className:"animate-spin h-4 w-4 border-2 border-background border-t-transparent rounded-full"}):"Delete"})]})]})}),e.jsx(Z,{open:Ae,onOpenChange:le,children:e.jsxs(ee,{className:"max-w-2xl",children:[e.jsxs(se,{children:[e.jsx(te,{children:"Link a Thought Record"}),e.jsx(ke,{children:"Select a thought record to link to this journal entry."})]}),e.jsx("div",{className:"py-4",children:G.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 max-h-[400px] overflow-y-auto p-1",children:G.filter(s=>!((t==null?void 0:t.relatedThoughtRecordIds)||[]).includes(s.id)).map(s=>e.jsxs(h,{className:"cursor-pointer hover:border-primary",onClick:()=>Xs(s.id),children:[e.jsxs(g,{className:"p-3",children:[e.jsx(N,{className:"text-sm",children:"Thought Record"}),e.jsx(z,{className:"text-xs",children:F(new Date(s.createdAt),"MMM d, yyyy")})]}),e.jsxs(u,{className:"p-3 pt-0",children:[e.jsx("p",{className:"text-xs font-medium mb-1",children:"Automatic Thoughts:"}),e.jsx("p",{className:"text-xs line-clamp-2 mb-2",children:s.automaticThoughts}),s.cognitiveDistortions&&s.cognitiveDistortions.length>0&&e.jsxs("div",{className:"flex flex-wrap gap-1",children:[s.cognitiveDistortions.slice(0,2).map((r,y)=>e.jsx(D,{variant:"outline",className:"text-[10px] py-0 px-1 bg-orange-50",children:r},y)),s.cognitiveDistortions.length>2&&e.jsxs(D,{variant:"outline",className:"text-[10px] py-0 px-1",children:["+",s.cognitiveDistortions.length-2]})]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("p",{children:"No thought records found. Create a thought record first to link it."}),e.jsx(k,{asChild:!0,className:"mt-4",children:e.jsx("a",{href:"/thought-records/new",children:"Create Thought Record"})})]})}),e.jsx(de,{children:e.jsx(k,{variant:"outline",onClick:()=>le(!1),children:"Cancel"})})]})}),e.jsx(Z,{open:w,onOpenChange:s=>{s||Re(!1)},children:e.jsxs(ee,{className:"max-w-3xl max-h-[80vh] overflow-hidden flex flex-col",children:[e.jsxs(se,{children:[e.jsx(te,{children:"Add Tags to Your Journal Entry"}),e.jsxs(ke,{children:["Tag your entry with emotions and topics to help organize and track your journal.",(t==null?void 0:t.aiAnalysis)&&e.jsxs("div",{className:"mt-2 p-3 bg-slate-50 rounded-md",children:[e.jsxs("div",{className:"flex items-center gap-2 text-sm mb-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-primary"}),e.jsx("span",{className:"font-medium",children:"AI-generated insights:"})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:t.aiAnalysis})]})]})]}),e.jsx("div",{className:"overflow-y-auto flex-1 pr-6 my-3",children:t&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs(h,{children:[e.jsx(g,{className:"py-3",children:e.jsx(N,{className:"text-md",children:t.title||"Untitled Entry"})}),e.jsx(u,{className:"py-2",children:e.jsx("p",{className:"line-clamp-3 text-sm text-muted-foreground",children:t.content})})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(h,{children:[e.jsx(g,{className:"py-3",children:e.jsxs(N,{className:"text-sm flex items-center",children:[e.jsx(Te,{className:"h-4 w-4 mr-2 text-rose-500"}),"Emotions"]})}),e.jsx(u,{className:"pt-0",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(cs=t.emotions)==null?void 0:cs.map((s,r)=>{const{color:y,description:R}=Q(s);return e.jsx(ge,{children:e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(D,{variant:P.includes(s)?"default":"outline",className:`cursor-pointer hover:opacity-80 transition-colors ${P.includes(s)?"":y}`,onClick:()=>U(s),children:[s,P.includes(s)&&e.jsx(Se,{className:"h-3 w-3 ml-1"})]})}),e.jsx(fe,{children:e.jsx("p",{children:R})})]})},`${s}-${r}`)}),(!t.emotions||t.emotions.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No emotions detected. Select emotions from topics or add custom tags below."})]})})]}),e.jsxs(h,{children:[e.jsx(g,{className:"py-3",children:e.jsxs(N,{className:"text-sm flex items-center",children:[e.jsx(Y,{className:"h-4 w-4 mr-2 text-blue-500"}),"Topics"]})}),e.jsx(u,{className:"pt-0",children:e.jsxs("div",{className:"flex flex-wrap gap-2",children:[(ds=t.topics)==null?void 0:ds.map((s,r)=>{const{color:y,description:R}=Q(s);return e.jsx(ge,{children:e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(D,{variant:P.includes(s)?"default":"outline",className:`cursor-pointer hover:opacity-80 transition-colors ${P.includes(s)?"":y}`,onClick:()=>U(s),children:[s,P.includes(s)&&e.jsx(Se,{className:"h-3 w-3 ml-1"})]})}),e.jsx(fe,{children:e.jsx("p",{children:R})})]})},`${s}-${r}`)}),(!t.topics||t.topics.length===0)&&e.jsx("p",{className:"text-sm text-muted-foreground",children:"No topics detected. You can add custom tags below."})]})})]})]}),e.jsxs(h,{children:[e.jsx(g,{className:"py-3",children:e.jsxs(N,{className:"text-sm flex items-center",children:[e.jsx(Ms,{className:"h-4 w-4 mr-2 text-green-500"}),"Add a Custom Tag"]})}),e.jsx(u,{className:"pt-0",children:e.jsxs("form",{onSubmit:s=>{s.preventDefault(),W.trim()&&(U(W.trim()),i(""))},className:"flex gap-2",children:[e.jsx(me,{value:W,onChange:s=>i(s.target.value),placeholder:"Enter a custom tag",className:"flex-1"}),e.jsx(k,{type:"submit",disabled:!W.trim(),size:"sm",children:"Add"})]})})]}),e.jsxs(h,{children:[e.jsx(g,{className:"py-3",children:e.jsxs(N,{className:"text-sm flex items-center",children:[e.jsx(Ze,{className:"h-4 w-4 mr-2 text-purple-500"}),"Selected Tags"]})}),e.jsx(u,{className:"pt-0",children:P.length>0?e.jsx("div",{className:"flex flex-wrap gap-2",children:P.map((s,r)=>{const{color:y,description:R}=Q(s);return e.jsx(ge,{children:e.jsxs(pe,{children:[e.jsx(je,{asChild:!0,children:e.jsxs(D,{className:"bg-primary/20 text-primary border-primary/30 hover:bg-primary/30 cursor-pointer flex items-center gap-1",onClick:()=>U(s),children:[s,e.jsx(_e,{className:"h-3 w-3"})]})}),e.jsx(fe,{children:e.jsx("p",{children:R})})]})},`selected-${s}-${r}`)})}):e.jsx("p",{className:"text-sm text-muted-foreground",children:"No tags selected yet. Click on emotions or topics above to select them."})})]})]})}),e.jsxs(de,{className:"gap-2",children:[e.jsx(k,{variant:"outline",onClick:()=>Re(!1),children:"Skip"}),e.jsx(k,{onClick:()=>Re(!0),disabled:X.isPending,children:X.isPending?e.jsxs(e.Fragment,{children:[e.jsxs("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-white",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[e.jsx("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),e.jsx("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),"Saving..."]}):e.jsxs(e.Fragment,{children:[e.jsx(re,{className:"mr-2 h-4 w-4"}),"Save Tags"]})})]})]})}),f&&e.jsx(Z,{open:!!f,onOpenChange:()=>b(null),children:e.jsxs(ee,{className:"max-w-3xl max-h-[80vh] overflow-y-auto custom-scrollbar",children:[e.jsxs(se,{className:"sticky top-0 bg-background z-10 pb-4",children:[e.jsxs(te,{className:"flex items-center gap-2 text-lg",children:[e.jsx("div",{className:"p-2 rounded-full bg-blue-100",children:e.jsx(ws,{className:"h-5 w-5 text-blue-600"})}),f.title]}),e.jsxs(ke,{children:["Created on ",F(new Date(f.createdAt),"MMM d, yyyy 'at' h:mm a")]})]}),e.jsx("div",{className:"space-y-6 pr-1",children:e.jsx(h,{className:"border-l-4 border-l-blue-400",children:e.jsxs(u,{className:"p-4 space-y-4",children:[e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Le,{className:"h-4 w-4 text-blue-500"}),"Content"]}),e.jsx("p",{className:"text-sm whitespace-pre-wrap pl-6",children:f.content})]}),f.userSelectedTags&&f.userSelectedTags.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-blue-500"}),"Tags"]}),e.jsx("div",{className:"flex flex-wrap gap-1 pl-6",children:f.userSelectedTags.map((s,r)=>e.jsx(D,{variant:"outline",className:"text-xs",children:s},r))})]}),f.aiAnalysis&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4 text-amber-500"}),"AI Insights"]}),e.jsx("p",{className:"text-sm text-muted-foreground pl-6",children:f.aiAnalysis})]}),f.emotions&&f.emotions.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Te,{className:"h-4 w-4 text-rose-500"}),"Detected Emotions"]}),e.jsx("div",{className:"flex flex-wrap gap-1 pl-6",children:f.emotions.map((s,r)=>e.jsx(D,{variant:"secondary",className:"text-xs",children:s},r))})]}),f.topics&&f.topics.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Y,{className:"h-4 w-4 text-blue-500"}),"Detected Topics"]}),e.jsx("div",{className:"flex flex-wrap gap-1 pl-6",children:f.topics.map((s,r)=>e.jsx(D,{variant:"secondary",className:"text-xs",children:s},r))})]}),f.userSelectedDistortions&&f.userSelectedDistortions.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(Ve,{className:"h-4 w-4 text-purple-500"}),"Cognitive Distortions"]}),e.jsx("div",{className:"space-y-2 pl-6",children:f.userSelectedDistortions.map((s,r)=>e.jsxs("div",{className:"text-sm",children:[e.jsxs("span",{className:"font-medium",children:[s,":"]})," ",e.jsx("span",{className:"text-muted-foreground",children:Ke(s)})]},r))})]}),he.length>0&&e.jsxs("div",{children:[e.jsxs("h3",{className:"text-sm font-medium mb-2 flex items-center gap-2",children:[e.jsx(bs,{className:"h-4 w-4 text-indigo-500"}),"Related Thought Records"]}),e.jsx("div",{className:"space-y-2 pl-6",children:he.map(s=>e.jsx(h,{className:"border",children:e.jsxs(u,{className:"p-3",children:[e.jsx("p",{className:"text-sm font-medium",children:s.situation}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:F(new Date(s.createdAt),"MMM d, yyyy")})]})},s.id))})]})]})})})]})})]})})}export{zr as default};
