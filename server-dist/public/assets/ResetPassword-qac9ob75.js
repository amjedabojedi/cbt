import{m as V,s as z,r as a,j as e,C as j,a as g,i as B,e as D,f as G,g as Y,A as m,o as u,p as x,B as y,q as b,l as H,L as M,h as P}from"./index-BJDVYPr2.js";import{I as k}from"./input-C744jVRX.js";import{u as O,F as Z,a as v,b as N,c as C,d as S,e as T,z as h,t as $}from"./form-Bn3qej8w.js";import{C as J}from"./circle-check-CkKaz49B.js";import"./label-DKKVfa8V.js";const K=h.object({password:h.string().min(8,{message:"Password must be at least 8 characters long"}).regex(/[A-Z]/,{message:"Password must contain at least one uppercase letter"}).regex(/[a-z]/,{message:"Password must contain at least one lowercase letter"}).regex(/[0-9]/,{message:"Password must contain at least one number"}),confirmPassword:h.string()}).refine(o=>o.password===o.confirmPassword,{message:"Passwords do not match",path:["confirmPassword"]});function ee(){const[,o]=V(),[F,A]=z("/reset-password/:token"),t=F?A.token:null,[i,w]=a.useState(!1),[p,I]=a.useState(!1),[E,R]=a.useState(!1),[L,f]=a.useState(!0),[c,s]=a.useState(null),l=O({resolver:$(K),defaultValues:{password:"",confirmPassword:""}});a.useEffect(()=>{(async()=>{if(!t){s("Invalid reset link. Please request a new password reset."),f(!1);return}try{(await(await P("GET",`/api/auth/verify-reset-token/${t}`)).json()).valid?R(!0):s("This password reset link has expired or is invalid. Please request a new one.")}catch(n){s("An error occurred while verifying your reset link. Please try again."),console.error("Token verification error:",n)}finally{f(!1)}})()},[t]);const q=async r=>{if(t){w(!0),s(null);try{const d=await(await P("POST","/api/auth/reset-password",{token:t,newPassword:r.password})).json();d.success?I(!0):s(d.message||"An error occurred. Please try again.")}catch(n){s("An unexpected error occurred. Please try again later."),console.error("Password reset error:",n)}finally{w(!1)}}};return L?e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 px-4 py-12 sm:px-6 lg:px-8",children:e.jsx(j,{className:"w-full max-w-md",children:e.jsxs(g,{className:"pt-6 text-center",children:[e.jsx(B,{className:"h-12 w-12 animate-spin text-gray-400 mx-auto"}),e.jsx("p",{className:"mt-4 text-gray-600",children:"Verifying your reset link..."})]})})}):e.jsx("div",{className:"flex min-h-screen items-center justify-center bg-gray-50 px-4 py-12 sm:px-6 lg:px-8",children:e.jsxs(j,{className:"w-full max-w-md",children:[e.jsxs(D,{className:"space-y-1 text-center",children:[e.jsx(G,{className:"text-2xl font-bold tracking-tight",children:"Reset your password"}),e.jsx(Y,{children:"Enter your new password below to reset your account"})]}),e.jsx(g,{children:p?e.jsxs(e.Fragment,{children:[e.jsxs(m,{variant:"default",className:"bg-green-50 border-green-200 mb-4",children:[e.jsx(J,{className:"h-4 w-4 text-green-600"}),e.jsx(u,{children:"Password reset successful!"}),e.jsx(x,{children:"Your password has been successfully reset. You can now log in with your new password."})]}),e.jsx(y,{className:"w-full",onClick:()=>o("/login"),children:"Go to Login"})]}):E?e.jsx(Z,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(q),className:"space-y-4",children:[e.jsx(v,{control:l.control,name:"password",render:({field:r})=>e.jsxs(N,{children:[e.jsx(C,{children:"New Password"}),e.jsx(S,{children:e.jsx(k,{type:"password",placeholder:"Enter new password",...r,disabled:i})}),e.jsx(T,{})]})}),e.jsx(v,{control:l.control,name:"confirmPassword",render:({field:r})=>e.jsxs(N,{children:[e.jsx(C,{children:"Confirm Password"}),e.jsx(S,{children:e.jsx(k,{type:"password",placeholder:"Confirm new password",...r,disabled:i})}),e.jsx(T,{})]})}),c&&e.jsxs(m,{variant:"destructive",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(u,{children:"Error"}),e.jsx(x,{children:c})]}),e.jsx(y,{type:"submit",className:"w-full",disabled:i,children:i?"Resetting...":"Reset Password"})]})}):e.jsxs(m,{variant:"destructive",children:[e.jsx(b,{className:"h-4 w-4"}),e.jsx(u,{children:"Invalid Link"}),e.jsx(x,{children:c||"This password reset link is invalid or has expired. Please request a new one."})]})}),e.jsx(H,{className:"flex justify-center",children:e.jsx("div",{className:"text-sm text-gray-500",children:!p&&e.jsxs(e.Fragment,{children:["Need a new reset link?"," ",e.jsx(M,{href:"/forgot-password",className:"font-medium text-blue-600 hover:text-blue-500",children:"Request again"})]})})})]})})}export{ee as default};
