import{c as je,n as fe,y as ge,r as w,j as e,i as C,B as d,C as J,e as W,f as Z,g as ee,a as se,l as re,X,h as S,u as ve,L as ye}from"./index-BJDVYPr2.js";import{u as R}from"./useQuery-CVl6tFXz.js";import{u as F}from"./useMutation-4_CoT2bx.js";import{z as p,u as Ne,t as we,F as oe,a as l,b as c,c as o,d as m,e as u,f as j}from"./form-Bn3qej8w.js";import{D as te,a as ae,b as ie,c as ne,d as le,e as ce}from"./dialog-BkbRhY2O.js";import{I as f}from"./input-C744jVRX.js";import{S as Q}from"./switch-Bz048JH0.js";import{T as de}from"./textarea-8UmQ7iuL.js";import{B as N}from"./Header-HmO9KIvP.js";import{S as me,a as ue,b as xe,c as he,d as V}from"./select-Bh-crIyN.js";import{T as E}from"./triangle-alert-B6ZFxm6X.js";import{P as Ce}from"./plus-CIrJHrh4.js";import{C as T}from"./circle-check-big-D7NcmSYY.js";import{S as Se}from"./square-pen-BwPwTV1q.js";import{A as Pe,a as De,b as ke,c as Ae,d as Fe,e as Ee,f as Ie,g as Me}from"./alert-dialog-bBvWK-5Q.js";import{C as qe}from"./circle-x-B6rDCGfP.js";import{C as Oe}from"./calendar-Ck4F2mgv.js";import{f as Le}from"./format-CrnBQ42y.js";import{A as Te}from"./AppLayout-B4pR-pjA.js";import"./utils-km2FGkQ4.js";import"./label-DKKVfa8V.js";import"./index-pLghM4Oe.js";import"./target-7abParum.js";import"./index-ZMpGrT0S.js";import"./index-epKMAjhH.js";import"./check-CPyQFfyd.js";import"./chevron-down-JR_7gpC-.js";import"./en-US-9SRVm7yB.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ye=je("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pe=je("Star",[["polygon",{points:"12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2",key:"8f66p6"}]]),Ke=p.object({name:p.string().min(1,"Name is required"),description:p.string().min(1,"Description is required"),price:p.number().min(0,"Price must be a positive number"),interval:p.enum(["month","year"]),features:p.array(p.string()).min(1,"At least one feature is required"),maxClients:p.number().min(1,"Maximum clients must be at least 1"),isActive:p.boolean().default(!0),isDefault:p.boolean().default(!1),stripePriceId:p.string().optional()});function ze(){const{toast:n}=fe(),g=ge(),[I,h]=w.useState(!1),[y,b]=w.useState(!1),[P,Y]=w.useState(null),[v,M]=w.useState(""),{data:a,isLoading:U,error:$}=R({queryKey:["/api/subscription-plans"],queryFn:async()=>{const s=await fetch("/api/subscription-plans");if(!s.ok)throw new Error("Failed to fetch subscription plans");return s.json()}}),t=Ne({resolver:we(Ke),defaultValues:{name:"",description:"",price:0,interval:"month",features:[],maxClients:5,isActive:!0,isDefault:!1,stripePriceId:""}}),q=F({mutationFn:async s=>{const r=await S("POST","/api/subscription-plans",s);if(!r.ok){const i=await r.json();throw new Error(i.message||"Failed to create subscription plan")}return await r.json()},onSuccess:()=>{n({title:"Success",description:"Subscription plan created successfully"}),g.invalidateQueries({queryKey:["/api/subscription-plans"]}),t.reset(),h(!1)},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),O=F({mutationFn:async({id:s,data:r})=>{const i=await S("PATCH",`/api/subscription-plans/${s}`,r);if(!i.ok){const L=await i.json();throw new Error(L.message||"Failed to update subscription plan")}return await i.json()},onSuccess:()=>{n({title:"Success",description:"Subscription plan updated successfully"}),g.invalidateQueries({queryKey:["/api/subscription-plans"]}),t.reset(),b(!1)},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),D=F({mutationFn:async s=>{const r=await S("POST",`/api/subscription-plans/${s}/set-default`,{});if(!r.ok){const i=await r.json();throw new Error(i.message||"Failed to set default plan")}return await r.json()},onSuccess:()=>{n({title:"Success",description:"Default plan updated successfully"}),g.invalidateQueries({queryKey:["/api/subscription-plans"]})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),k=F({mutationFn:async s=>{const r=await S("POST",`/api/subscription-plans/${s}/deactivate`,{});if(!r.ok){const i=await r.json();throw new Error(i.message||"Failed to deactivate plan")}return await r.json()},onSuccess:()=>{n({title:"Success",description:"Plan deactivated successfully"}),g.invalidateQueries({queryKey:["/api/subscription-plans"]})},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),_=s=>{q.mutate(s)},H=s=>{P&&O.mutate({id:P.id,data:s})},A=()=>{if(!v.trim())return;const s=t.getValues("features")||[];t.setValue("features",[...s,v.trim()]),M("")},K=s=>{const r=t.getValues("features")||[];t.setValue("features",r.filter((i,L)=>L!==s))},z=s=>{Y(s),t.reset({name:s.name,description:s.description,price:s.price,interval:s.interval,features:s.features,maxClients:s.maxClients,isActive:s.isActive,isDefault:s.isDefault,stripePriceId:s.stripePriceId||""}),b(!0)},G=s=>{D.mutate(s)},x=s=>{window.confirm("Are you sure you want to deactivate this plan? Existing subscribers won't be affected, but new users won't be able to subscribe to this plan.")&&k.mutate(s)},B=()=>{t.reset({name:"",description:"",price:0,interval:"month",features:[],maxClients:5,isActive:!0,isDefault:!1,stripePriceId:""}),h(!0)};return U?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2",children:"Loading subscription plans..."})]}):$?e.jsxs("div",{className:"p-4 bg-destructive/10 rounded-md border border-destructive",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Error Loading Plans"]}),e.jsx("p",{className:"text-sm mt-2",children:"Failed to load subscription plans. Please try again later."})]}):e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center sticky top-0 bg-background z-10 py-4",children:[e.jsx("h2",{className:"text-2xl font-semibold",children:"Subscription Plans"}),e.jsxs(d,{onClick:B,children:[e.jsx(Ce,{className:"h-4 w-4 mr-2"}),"Create New Plan"]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 max-h-[calc(100vh-180px)] overflow-y-auto pb-4 pr-2",children:a==null?void 0:a.map(s=>e.jsxs(J,{className:s.isActive?"":"opacity-70",children:[e.jsx(W,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsxs(Z,{className:"flex items-center",children:[s.name,s.isDefault&&e.jsxs(N,{variant:"outline",className:"ml-2 bg-yellow-100",children:[e.jsx(pe,{className:"h-3 w-3 mr-1 fill-yellow-500 text-yellow-500"}),"Default"]})]}),e.jsx(ee,{children:s.isActive?e.jsxs("span",{className:"text-green-600 text-xs font-medium flex items-center",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"Active"]}):e.jsx("span",{className:"text-muted-foreground text-xs font-medium",children:"Inactive"})})]}),e.jsxs("div",{children:[e.jsx(N,{variant:"secondary",className:"mb-1",children:s.interval==="month"?"Monthly":"Yearly"}),e.jsxs("div",{className:"text-2xl font-bold",children:["$",s.price,e.jsxs("span",{className:"text-sm font-normal",children:["/",s.interval]})]})]})]})}),e.jsxs(se,{children:[e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:s.description}),e.jsxs("div",{className:"mb-2",children:[e.jsx("span",{className:"text-sm font-medium",children:"Features:"}),e.jsx("ul",{className:"mt-1 space-y-1 max-h-40 overflow-y-auto pr-2",children:s.features.map((r,i)=>e.jsxs("li",{className:"text-sm flex",children:[e.jsx(T,{className:"h-4 w-4 mr-2 text-green-500 flex-shrink-0"}),e.jsx("span",{children:r})]},i))})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Max Clients:"})," ",e.jsx("span",{className:"text-sm",children:s.maxClients})]})]}),e.jsxs(re,{className:"border-t pt-4 flex justify-between",children:[e.jsxs(d,{variant:"outline",size:"sm",onClick:()=>z(s),children:[e.jsx(Se,{className:"h-4 w-4 mr-1"}),"Edit"]}),e.jsxs("div",{className:"space-x-2",children:[!s.isDefault&&s.isActive&&e.jsxs(d,{variant:"secondary",size:"sm",onClick:()=>G(s.id),children:[e.jsx(pe,{className:"h-4 w-4 mr-1"}),"Set Default"]}),s.isActive&&!s.isDefault&&e.jsxs(d,{variant:"destructive",size:"sm",onClick:()=>x(s.id),children:[e.jsx(X,{className:"h-4 w-4 mr-1"}),"Deactivate"]})]})]})]},s.id))}),e.jsx(te,{open:I,onOpenChange:h,children:e.jsxs(ae,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(ne,{children:"Create Subscription Plan"}),e.jsx(le,{children:"Create a new subscription plan for therapists."})]}),e.jsx(oe,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(_),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:t.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Plan Name"}),e.jsx(m,{children:e.jsx(f,{placeholder:"Basic Plan",...s})}),e.jsx(u,{})]})}),e.jsx(l,{control:t.control,name:"price",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Price"}),e.jsx(m,{children:e.jsx(f,{type:"number",min:"0",step:"0.01",placeholder:"0.00",...s,onChange:r=>s.onChange(parseFloat(r.target.value))})}),e.jsx(j,{children:"Set to 0 for free plans"}),e.jsx(u,{})]})})]}),e.jsx(l,{control:t.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Description"}),e.jsx(m,{children:e.jsx(de,{placeholder:"A basic plan for therapists starting out...",...s})}),e.jsx(u,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:t.control,name:"interval",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Billing Interval"}),e.jsxs(me,{value:s.value,onValueChange:s.onChange,children:[e.jsx(m,{children:e.jsx(ue,{children:e.jsx(xe,{placeholder:"Select billing interval"})})}),e.jsxs(he,{children:[e.jsx(V,{value:"month",children:"Monthly"}),e.jsx(V,{value:"year",children:"Yearly"})]})]}),e.jsx(u,{})]})}),e.jsx(l,{control:t.control,name:"maxClients",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Maximum Clients"}),e.jsx(m,{children:e.jsx(f,{type:"number",min:"1",placeholder:"5",...s,onChange:r=>s.onChange(parseInt(r.target.value))})}),e.jsx(j,{children:"Maximum number of clients a therapist can manage"}),e.jsx(u,{})]})})]}),e.jsx("div",{className:"space-y-3",children:e.jsx(l,{control:t.control,name:"features",render:()=>{var s;return e.jsxs(c,{children:[e.jsx(o,{children:"Features"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{placeholder:"Add a feature...",value:v,onChange:r=>M(r.target.value),onKeyPress:r=>r.key==="Enter"&&(r.preventDefault(),A())}),e.jsx(d,{type:"button",onClick:A,children:"Add"})]}),e.jsx("div",{className:"mt-2 space-y-2 max-h-40 overflow-y-auto pr-1",children:(s=t.watch("features"))==null?void 0:s.map((r,i)=>e.jsxs("div",{className:"flex items-center bg-muted p-2 rounded-md",children:[e.jsx("span",{className:"flex-1 text-sm",children:r}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>K(i),children:e.jsx(X,{className:"h-4 w-4"})})]},i))}),e.jsx(u,{})]})}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:t.control,name:"isActive",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between p-3 rounded-md border",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(o,{children:"Active"}),e.jsx(j,{children:"Make this plan available to users"})]}),e.jsx(m,{children:e.jsx(Q,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(l,{control:t.control,name:"isDefault",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between p-3 rounded-md border",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(o,{children:"Default Plan"}),e.jsx(j,{children:"Set as the default plan for new users"})]}),e.jsx(m,{children:e.jsx(Q,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsx(l,{control:t.control,name:"stripePriceId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Stripe Price ID (Optional)"}),e.jsx(m,{children:e.jsx(f,{placeholder:"price_...",...s,value:s.value||""})}),e.jsx(j,{children:"For paid plans: the Stripe Price ID from your Stripe Dashboard"}),e.jsx(u,{})]})}),e.jsxs(ce,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>h(!1),children:"Cancel"}),e.jsxs(d,{type:"submit",disabled:q.isPending,children:[q.isPending&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Create Plan"]})]})]})})]})}),e.jsx(te,{open:y,onOpenChange:b,children:e.jsxs(ae,{className:"sm:max-w-[600px] max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(ne,{children:"Edit Subscription Plan"}),e.jsx(le,{children:"Update this subscription plan. Existing subscriptions won't be affected."})]}),e.jsx(oe,{...t,children:e.jsxs("form",{onSubmit:t.handleSubmit(H),className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:t.control,name:"name",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Plan Name"}),e.jsx(m,{children:e.jsx(f,{placeholder:"Basic Plan",...s})}),e.jsx(u,{})]})}),e.jsx(l,{control:t.control,name:"price",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Price"}),e.jsx(m,{children:e.jsx(f,{type:"number",min:"0",step:"0.01",placeholder:"0.00",...s,onChange:r=>s.onChange(parseFloat(r.target.value))})}),e.jsx(j,{children:"Set to 0 for free plans"}),e.jsx(u,{})]})})]}),e.jsx(l,{control:t.control,name:"description",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Description"}),e.jsx(m,{children:e.jsx(de,{placeholder:"A basic plan for therapists starting out...",...s})}),e.jsx(u,{})]})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:t.control,name:"interval",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Billing Interval"}),e.jsxs(me,{value:s.value,onValueChange:s.onChange,children:[e.jsx(m,{children:e.jsx(ue,{children:e.jsx(xe,{placeholder:"Select billing interval"})})}),e.jsxs(he,{children:[e.jsx(V,{value:"month",children:"Monthly"}),e.jsx(V,{value:"year",children:"Yearly"})]})]}),e.jsx(u,{})]})}),e.jsx(l,{control:t.control,name:"maxClients",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Maximum Clients"}),e.jsx(m,{children:e.jsx(f,{type:"number",min:"1",placeholder:"5",...s,onChange:r=>s.onChange(parseInt(r.target.value))})}),e.jsx(j,{children:"Maximum number of clients a therapist can manage"}),e.jsx(u,{})]})})]}),e.jsx("div",{className:"space-y-3",children:e.jsx(l,{control:t.control,name:"features",render:()=>{var s;return e.jsxs(c,{children:[e.jsx(o,{children:"Features"}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(f,{placeholder:"Add a feature...",value:v,onChange:r=>M(r.target.value),onKeyPress:r=>r.key==="Enter"&&(r.preventDefault(),A())}),e.jsx(d,{type:"button",onClick:A,children:"Add"})]}),e.jsx("div",{className:"mt-2 space-y-2 max-h-40 overflow-y-auto pr-1",children:(s=t.watch("features"))==null?void 0:s.map((r,i)=>e.jsxs("div",{className:"flex items-center bg-muted p-2 rounded-md",children:[e.jsx("span",{className:"flex-1 text-sm",children:r}),e.jsx(d,{type:"button",variant:"ghost",size:"sm",onClick:()=>K(i),children:e.jsx(X,{className:"h-4 w-4"})})]},i))}),e.jsx(u,{})]})}})}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsx(l,{control:t.control,name:"isActive",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between p-3 rounded-md border",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(o,{children:"Active"}),e.jsx(j,{children:"Make this plan available to users"})]}),e.jsx(m,{children:e.jsx(Q,{checked:s.value,onCheckedChange:s.onChange})})]})}),e.jsx(l,{control:t.control,name:"isDefault",render:({field:s})=>e.jsxs(c,{className:"flex flex-row items-center justify-between p-3 rounded-md border",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(o,{children:"Default Plan"}),e.jsx(j,{children:"Set as the default plan for new users"})]}),e.jsx(m,{children:e.jsx(Q,{checked:s.value,onCheckedChange:s.onChange})})]})})]}),e.jsx(l,{control:t.control,name:"stripePriceId",render:({field:s})=>e.jsxs(c,{children:[e.jsx(o,{children:"Stripe Price ID (Optional)"}),e.jsx(m,{children:e.jsx(f,{placeholder:"price_...",...s,value:s.value||""})}),e.jsx(j,{children:"For paid plans: the Stripe Price ID from your Stripe Dashboard"}),e.jsx(u,{})]})}),e.jsxs(ce,{children:[e.jsx(d,{type:"button",variant:"outline",onClick:()=>b(!1),children:"Cancel"}),e.jsxs(d,{type:"submit",disabled:O.isPending,children:[O.isPending&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Update Plan"]})]})]})})]})})]})}function Be(){var B;const{toast:n}=fe(),g=ge(),[I,h]=w.useState(!1),[y,b]=w.useState(!1),[P,Y]=w.useState(!1),[v,M]=w.useState(null),{data:a,isLoading:U,error:$}=R({queryKey:["/api/subscription"],queryFn:async()=>{const s=await fetch("/api/subscription");if(!s.ok)throw new Error("Failed to fetch subscription information");return s.json()}}),{data:t,isLoading:q,error:O}=R({queryKey:["/api/subscription-plans"],queryFn:async()=>{const s=await fetch("/api/subscription-plans");if(!s.ok)throw new Error("Failed to fetch subscription plans");return s.json()}}),D=F({mutationFn:async s=>{const r=await S("POST","/api/subscription",{planId:s});if(!r.ok){const i=await r.json();throw new Error(i.message||"Failed to subscribe to plan")}return await r.json()},onSuccess:s=>{if(!s.url){n({title:"Success",description:"Your subscription has been updated successfully"}),g.invalidateQueries({queryKey:["/api/subscription"]}),h(!1);return}Y(!0),window.location.href=s.url},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"}),Y(!1)}}),k=F({mutationFn:async()=>{const s=await S("POST","/api/subscription/cancel",{});if(!s.ok){const r=await s.json();throw new Error(r.message||"Failed to cancel subscription")}return await s.json()},onSuccess:()=>{n({title:"Subscription Cancelled",description:"Your subscription will remain active until the end of your billing period."}),g.invalidateQueries({queryKey:["/api/subscription"]}),b(!1)},onError:s=>{n({title:"Error",description:s.message,variant:"destructive"})}}),_=s=>{D.mutate(s)},H=s=>{M(s),h(!0)},A=()=>{k.mutate()},K=()=>!v||!t?null:t.find(s=>s.id===v)||null,z=s=>s?Le(new Date(s),"MMMM d, yyyy"):"N/A",G=s=>{if(!s)return null;switch(s){case"active":return e.jsxs(N,{variant:"outline",className:"bg-green-100 text-green-700",children:[e.jsx(T,{className:"h-3 w-3 mr-1"}),"Active"]});case"trialing":return e.jsxs(N,{variant:"outline",className:"bg-blue-100 text-blue-700",children:[e.jsx(Oe,{className:"h-3 w-3 mr-1"}),"Trial"]});case"past_due":return e.jsxs(N,{variant:"outline",className:"bg-amber-100 text-amber-700",children:[e.jsx(E,{className:"h-3 w-3 mr-1"}),"Past Due"]});case"canceled":return e.jsxs(N,{variant:"outline",className:"bg-gray-100 text-gray-700",children:[e.jsx(qe,{className:"h-3 w-3 mr-1"}),"Cancelled"]});default:return e.jsx(N,{variant:"outline",children:s})}};if(U||q)return e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2",children:"Loading subscription information..."})]});if($||O)return e.jsxs("div",{className:"p-4 bg-destructive/10 rounded-md border border-destructive",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Error Loading Subscription"]}),e.jsx("p",{className:"text-sm mt-2",children:"Failed to load subscription information. Please try again later."})]});const x=K();return e.jsxs("div",{className:"space-y-6 overflow-y-auto pr-2 h-[calc(100vh-120px)]",children:[e.jsxs(J,{children:[e.jsx(W,{children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx(Z,{children:"Your Subscription"}),e.jsx(ee,{children:"Manage your therapist subscription"})]}),G(a==null?void 0:a.status)]})}),e.jsx(se,{className:"space-y-4",children:a!=null&&a.plan?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold",children:a.plan.name}),e.jsx("p",{className:"text-sm text-muted-foreground",children:a.plan.description})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-4 mt-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Price"}),e.jsxs("p",{className:"text-lg",children:["$",a.plan.price,e.jsxs("span",{className:"text-sm text-muted-foreground",children:["/",a.plan.interval]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-sm font-medium",children:"Max Clients"}),e.jsx("p",{className:"text-lg",children:a.plan.maxClients})]})]}),a.stripeSubscription&&e.jsxs("div",{className:"space-y-2 mt-4",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("p",{className:"text-sm font-medium",children:"Current Period"}),e.jsxs("p",{className:"text-sm",children:["Ends ",z(a.stripeSubscription.currentPeriodEnd)]})]}),a.stripeSubscription.cancelAtPeriodEnd&&e.jsxs("div",{className:"rounded-md bg-amber-50 p-3 text-sm text-amber-900 border border-amber-100",children:[e.jsx(E,{className:"h-4 w-4 inline-block mr-1"}),"Your subscription will not renew after the current period."]})]}),e.jsxs("div",{className:"space-y-1 mt-4",children:[e.jsx("p",{className:"text-sm font-medium",children:"Features"}),e.jsx("ul",{className:"space-y-1 max-h-40 overflow-y-auto pr-2",children:a.plan.features.map((s,r)=>e.jsxs("li",{className:"text-sm flex",children:[e.jsx(T,{className:"h-4 w-4 mr-2 text-green-500 flex-shrink-0"}),e.jsx("span",{children:s})]},r))})]})]}):e.jsxs("div",{className:"text-center py-6",children:[e.jsx("p",{className:"text-lg font-medium mb-2",children:"No Active Subscription"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-6",children:"You don't have an active subscription. Choose a plan to get started."})]})}),e.jsx(re,{className:"border-t pt-4",children:(a==null?void 0:a.stripeSubscription)&&!a.stripeSubscription.cancelAtPeriodEnd&&e.jsxs(d,{variant:"outline",className:"text-destructive hover:bg-destructive/10",onClick:()=>b(!0),disabled:k.isPending,children:[k.isPending&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Cancel Subscription"]})})]}),e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold mb-4 sticky top-0 bg-background z-10 py-2",children:"Available Plans"}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3 max-h-[calc(100vh-380px)] overflow-y-auto pb-4 pr-2",children:t==null?void 0:t.filter(s=>s.isActive).map(s=>{var r,i;return e.jsxs(J,{className:((r=a==null?void 0:a.plan)==null?void 0:r.id)===s.id?"border-primary":"",children:[e.jsxs(W,{children:[e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsx(Z,{children:s.name}),e.jsxs("div",{children:[e.jsx(N,{variant:"secondary",className:"mb-1",children:s.interval==="month"?"Monthly":"Yearly"}),e.jsxs("div",{className:"text-2xl font-bold",children:["$",s.price,e.jsxs("span",{className:"text-sm font-normal",children:["/",s.interval]})]})]})]}),e.jsx(ee,{children:s.description})]}),e.jsxs(se,{children:[e.jsxs("div",{className:"mb-4",children:[e.jsx("span",{className:"text-sm font-medium",children:"Max Clients:"})," ",e.jsx("span",{className:"text-sm",children:s.maxClients})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-sm font-medium",children:"Features:"}),e.jsx("ul",{className:"mt-1 space-y-1 max-h-32 overflow-y-auto pr-2",children:s.features.map((L,be)=>e.jsxs("li",{className:"text-sm flex",children:[e.jsx(T,{className:"h-4 w-4 mr-2 text-green-500 flex-shrink-0"}),e.jsx("span",{children:L})]},be))})]})]}),e.jsx(re,{className:"border-t pt-4",children:((i=a==null?void 0:a.plan)==null?void 0:i.id)===s.id?e.jsx(d,{variant:"outline",disabled:!0,className:"w-full",children:"Current Plan"}):e.jsx(d,{className:"w-full",onClick:()=>H(s.id),children:s.price>0?"Upgrade":"Select"})})]},s.id)})})]}),e.jsx(te,{open:I,onOpenChange:h,children:e.jsxs(ae,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(ie,{children:[e.jsx(ne,{children:"Confirm Subscription"}),e.jsx(le,{children:a!=null&&a.plan?"You are about to change your subscription plan.":"You are about to subscribe to a new plan."})]}),x&&e.jsxs("div",{className:"py-4",children:[e.jsx("h3",{className:"text-lg font-semibold",children:x.name}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:x.description}),e.jsxs("div",{className:"flex justify-between items-center p-3 rounded-md bg-primary/5 mb-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Price"}),e.jsxs("p",{className:"text-xl font-bold",children:["$",x.price,e.jsxs("span",{className:"text-sm font-normal text-muted-foreground",children:["/",x.interval]})]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-right",children:"Max Clients"}),e.jsx("p",{className:"text-xl font-bold text-right",children:x.maxClients})]})]}),x.price>0&&e.jsxs("div",{className:"flex items-center p-3 rounded-md bg-primary/5 mb-4",children:[e.jsx(Ye,{className:"h-5 w-5 mr-3 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Payment Information"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"You'll be redirected to our secure payment processor to complete your subscription."})]})]})]}),e.jsxs(ce,{children:[e.jsx(d,{variant:"outline",onClick:()=>h(!1),disabled:D.isPending||P,children:"Cancel"}),e.jsxs(d,{onClick:()=>v&&_(v),disabled:D.isPending||P,children:[(D.isPending||P)&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),x&&typeof x.price=="number"&&x.price>0?"Proceed to Checkout":"Confirm"]})]})]})}),e.jsx(Pe,{open:y,onOpenChange:b,children:e.jsxs(De,{className:"max-h-[90vh] overflow-y-auto",children:[e.jsxs(ke,{children:[e.jsx(Ae,{children:"Are you sure you want to cancel?"}),e.jsxs(Fe,{children:["Your subscription will remain active until the end of your current billing period (",(B=a==null?void 0:a.stripeSubscription)!=null&&B.currentPeriodEnd?z(a.stripeSubscription.currentPeriodEnd):"the end of your billing period","). After that, you'll be moved to the free plan."]})]}),e.jsxs(Ee,{children:[e.jsx(Ie,{children:"Keep Subscription"}),e.jsxs(Me,{onClick:A,className:"bg-destructive text-destructive-foreground hover:bg-destructive/90",children:[k.isPending&&e.jsx(C,{className:"h-4 w-4 mr-2 animate-spin"}),"Cancel Subscription"]})]})]})})]})}function js(){const{user:n,loading:g}=ve(),{data:I,isLoading:h}=R({queryKey:["/api/stripe/status"],queryFn:async()=>{try{const y=await S("GET","/api/stripe/status");return y.ok?(await y.json()).configured===!0:!1}catch(y){return console.error("Error checking Stripe status:",y),!1}},enabled:!!n});return g||h?e.jsxs("div",{className:"flex items-center justify-center min-h-screen",children:[e.jsx(C,{className:"h-8 w-8 animate-spin text-primary"}),e.jsx("p",{className:"ml-2",children:"Loading subscription information..."})]}):n?e.jsx(Te,{title:"Subscription Management",children:e.jsxs("div",{className:"container max-w-5xl mx-auto px-4 py-8",children:[n.role==="admin"&&!I&&e.jsxs("div",{className:"mb-6 p-4 bg-amber-50 rounded-md border border-amber-200 sticky top-0 z-10",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center text-amber-800",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Stripe Not Configured"]}),e.jsx("p",{className:"text-sm mt-2 text-amber-700",children:"Stripe API keys are not configured. Paid subscriptions will not work until you set up your Stripe account and add your API keys."}),e.jsxs("div",{className:"mt-4 text-sm text-amber-700",children:[e.jsx("p",{className:"font-semibold",children:"To configure Stripe:"}),e.jsxs("ol",{className:"list-decimal pl-5 space-y-1 mt-2",children:[e.jsxs("li",{children:["Sign up for a Stripe account at ",e.jsx("a",{href:"https://stripe.com",target:"_blank",rel:"noopener noreferrer",className:"underline",children:"stripe.com"})]}),e.jsx("li",{children:"Go to the Stripe Dashboard > Developers > API keys"}),e.jsx("li",{children:"Add your API keys to the environment variables"})]})]})]}),e.jsx("div",{className:"overflow-auto",children:n.role==="admin"?e.jsx(ze,{}):n.role==="therapist"?e.jsx(Be,{}):e.jsxs("div",{className:"p-6 bg-muted rounded-lg",children:[e.jsx("h2",{className:"text-xl font-semibold mb-3",children:"Client Account"}),e.jsx("p",{className:"text-muted-foreground",children:"Subscription management is only available for therapist and administrator accounts. As a client, you don't need to manage any subscription."})]})})]})}):e.jsx("div",{className:"container max-w-3xl mx-auto px-4 py-8",children:e.jsxs("div",{className:"p-4 bg-destructive/10 rounded-md border border-destructive",children:[e.jsxs("h3",{className:"text-lg font-medium flex items-center",children:[e.jsx(E,{className:"h-5 w-5 mr-2"}),"Authentication Required"]}),e.jsx("p",{className:"text-sm mt-2",children:"You need to be logged in to access this page."}),e.jsx(d,{asChild:!0,className:"mt-4",children:e.jsx(ye,{href:"/auth",children:"Login or Register"})})]})})}export{js as default};
