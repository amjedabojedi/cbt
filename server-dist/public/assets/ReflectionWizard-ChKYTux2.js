import{j as e,T as we,t as Ne,v as Ce,w as Se,u as ke,n as Ae,m as Fe,r as n,B as u,h as m,D as Pe}from"./index-BJDVYPr2.js";import{u as De,t as Ee,F as Te,z as h,a as W,b as F,c as P,f as X,d as z,e as Re}from"./form-Bn3qej8w.js";import{u as Ie,C as L}from"./use-active-user-CkIppDip.js";import{D as Ve,a as Be,b as Ge,c as $e,e as We}from"./dialog-BkbRhY2O.js";import{T as ze}from"./textarea-8UmQ7iuL.js";import{I as Z}from"./input-C744jVRX.js";import{C as Le}from"./checkbox-CpzJVwUi.js";import{L as ee}from"./label-DKKVfa8V.js";import{P as Me}from"./progress-XD4z056s.js";import{S as M}from"./slider-BHLSMB0K.js";import{I as He}from"./info-PLI2XuV7.js";import{A as qe,a as Oe,b as Ye,c as Je}from"./accordion-C_vhZxL6.js";import{C as Ke}from"./circle-plus-C1yyTLEf.js";function y({content:r,research:w}){return e.jsx(we,{children:e.jsxs(Ne,{delayDuration:300,children:[e.jsx(Ce,{asChild:!0,children:e.jsx("button",{className:"inline-flex items-center ml-1.5 text-muted-foreground hover:text-primary focus:outline-none focus:ring-2 focus:ring-primary/20 rounded-full",children:e.jsx(He,{className:"h-3.5 w-3.5"})})}),e.jsxs(Se,{className:"max-w-[280px] text-sm",children:[e.jsx("div",{children:r}),e.jsxs("div",{className:"mt-1.5 text-xs italic text-muted-foreground",children:["Based on research by ",w]})]})]})})}const te=[{value:"all-or-nothing",label:"All-or-Nothing Thinking",description:"Seeing situations in black and white terms, with no middle ground.",example:"If I don't get a perfect score, I'm a complete failure.",reframe:"Most situations fall somewhere in between extremes. Look for partial successes."},{value:"catastrophizing",label:"Catastrophizing",description:"Expecting the worst possible outcome in a situation.",example:"If I make a mistake in my presentation, my career will be ruined.",reframe:"Consider the most realistic outcome, not just the worst case scenario."},{value:"emotional-reasoning",label:"Emotional Reasoning",description:"Assuming your emotions reflect reality: 'I feel it, therefore it must be true.'",example:"I feel anxious about the flight, so it must be dangerous.",reframe:"Emotions are not facts. They're responses that may or may not be proportionate."},{value:"mind-reading",label:"Mind Reading",description:"Assuming you know what others are thinking, usually negatively.",example:"She didn't smile at me, so she must dislike me.",reframe:"Without confirmation, we can't know what others think. Consider alternative explanations."},{value:"overgeneralization",label:"Overgeneralization",description:"Taking one negative event as evidence of endless pattern of defeat.",example:"I didn't get this job. I'll never find employment.",reframe:"One event is just one data point, not a universal pattern."},{value:"personalization",label:"Personalization",description:"Believing others' actions are specifically related to you.",example:"The team's project failed because of my contribution.",reframe:"Most outcomes result from many factors, not just your actions."},{value:"should-statements",label:"Should Statements",description:"Having rigid rules about how you and others 'should' behave.",example:"I should never make mistakes. They should always consider my feelings.",reframe:"Replace 'should' with more flexible preferences and realistic expectations."},{value:"mental-filter",label:"Mental Filter",description:"Focusing exclusively on negative details while ignoring positives.",example:"I got feedback on my report with 9 compliments and 1 criticism, but I can only think about the criticism.",reframe:"Consciously acknowledge the full picture, including positive aspects."},{value:"disqualifying-positive",label:"Disqualifying the Positive",description:"Rejecting positive experiences by insisting they don't count.",example:"I did well on the project, but that doesn't count because anyone could have done it.",reframe:"Accept compliments and achievements as legitimate parts of your experience."},{value:"jumping-to-conclusions",label:"Jumping to Conclusions",description:"Making negative interpretations without supporting facts.",example:"My friend hasn't replied to my message. Our friendship must be over.",reframe:"Wait for evidence before coming to conclusions. Consider alternative explanations."}],Ue=h.object({automaticThoughts:h.string().min(3,"Please enter your thoughts"),cognitiveDistortions:h.array(h.string()).default([]),evidenceFor:h.string().default(""),evidenceAgainst:h.string().default(""),alternativePerspective:h.string().default(""),insightsGained:h.string().default(""),reflectionRating:h.number().min(1).max(10).default(5)}),Qe=r=>r?{Joy:"#F9D71C",Sadness:"#6D87C4",Fear:"#8A65AA",Disgust:"#7DB954",Anger:"#E43D40",Happy:"#F9D71C",Excited:"#E8B22B",Proud:"#D6A338",Content:"#C8953F",Hopeful:"#BAA150",Depressed:"#6D87C4",Lonely:"#5D78B5",Guilty:"#4C69A6",Disappointed:"#3B5A97",Hurt:"#2A4B88",Nervous:"#8A65AA",Worried:"#7C5D9F",Anxious:"#6D5595",Insecure:"#5F4D8A",Terrified:"#50457F",Disgusted:"#7DB954",Judgemental:"#6FA94B",Disapproving:"#629A41",Awful:"#548B38",Avoidant:"#457C2F",Angry:"#E43D40",Frustrated:"#D23B3E",Irritated:"#C0393B",Critical:"#AE3639",Distant:"#9C3436"}[r]||"#808080":"#cccccc";function ut({emotion:r,open:w,onClose:x,existingThoughtRecord:d,isEditMode:v=!1}){const{user:o}=ke(),{isViewingSelf:se}=Ie(),{toast:l}=Ae(),[,H]=Fe(),[p,b]=n.useState(1),[j,q]=n.useState(!1);n.useState(!1);const[N,D]=n.useState(null),[g,C]=n.useState([]),[f,S]=n.useState([]),[ie,E]=n.useState(!1),[ae,T]=n.useState(!1),[k,R]=n.useState(""),[A,I]=n.useState(""),[V,B]=n.useState({}),[G,$]=n.useState({}),[O,Y]=n.useState([]),[J,K]=n.useState([]),[_e,re]=n.useState([]);n.useRef(null),n.useRef(null),n.useRef(null),n.useRef(null),n.useRef(null);const U=4,ne=p/U*100,a=De({resolver:Ee(Ue),mode:"onChange",defaultValues:v&&d?{automaticThoughts:d.automaticThoughts,cognitiveDistortions:d.cognitiveDistortions||[],evidenceFor:d.evidenceFor,evidenceAgainst:d.evidenceAgainst,alternativePerspective:d.alternativePerspective,insightsGained:d.insightsGained,reflectionRating:d.reflectionRating}:{automaticThoughts:"",cognitiveDistortions:[],evidenceFor:"",evidenceAgainst:"",alternativePerspective:"",insightsGained:"",reflectionRating:5}});n.useEffect(()=>{const t=a.watch(s=>{console.log("Form changed:",s)});return()=>t.unsubscribe()},[a]),n.useEffect(()=>{if(o){const t=async()=>{try{const c=await(await m("GET",`/api/users/${o.id}/protective-factors`)).json();Y(c)}catch(i){console.error("Error fetching protective factors:",i),l({title:"Error",description:"Failed to load protective factors",variant:"destructive"})}},s=async()=>{try{const c=await(await m("GET",`/api/users/${o.id}/coping-strategies`)).json();K(c)}catch(i){console.error("Error fetching coping strategies:",i),l({title:"Error",description:"Failed to load coping strategies",variant:"destructive"})}};t(),s()}},[o,l]),n.useEffect(()=>{o&&r&&(async()=>{try{const i=await(await m("GET",`/api/users/${o.id}/thoughts?emotionRecordId=${r.id}`)).json();re(i)}catch(s){console.error("Error fetching previous reflections:",s)}})()},[o,r]);const oe=()=>{p===1&&(a.trigger(["automaticThoughts"]),a.formState.errors.automaticThoughts)||(b(p+1),console.log("Current form values:",a.getValues()))},le=()=>{b(p-1)},ce=t=>{g.includes(t)?(C(s=>s.filter(i=>i!==t)),B(s=>{const i={...s};return delete i[t],i})):(C(s=>[...s,t]),B(s=>({...s,[t]:5})))},de=t=>{f.includes(t)?(S(s=>s.filter(i=>i!==t)),$(s=>{const i={...s};return delete i[t],i})):(S(s=>[...s,t]),$(s=>({...s,[t]:5})))},ue=(t,s)=>{B(i=>({...i,[t]:s}))},me=(t,s)=>{$(i=>({...i,[t]:s}))},he=async()=>{if(!(!k.trim()||!o))try{const s=await(await m("POST",`/api/users/${o.id}/protective-factors`,{userId:o.id,name:k,description:"",isGlobal:!1})).json();Y(i=>[...i,s]),C(i=>[...i,s.id]),R(""),E(!1),l({title:"Success",description:"Added new protective factor"})}catch(t){console.error("Error adding protective factor:",t),l({title:"Error",description:"Failed to add protective factor",variant:"destructive"})}},pe=async()=>{if(!(!A.trim()||!o))try{const s=await(await m("POST",`/api/users/${o.id}/coping-strategies`,{userId:o.id,name:A,description:"",isGlobal:!1})).json();K(i=>[...i,s]),S(i=>[...i,s.id]),I(""),T(!1),l({title:"Success",description:"Added new coping strategy"})}catch(t){console.error("Error adding coping strategy:",t),l({title:"Error",description:"Failed to add coping strategy",variant:"destructive"})}},Q=async t=>{if(!o){l({title:"Error",description:"You must be logged in to record thoughts",variant:"destructive"});return}if(!t.automaticThoughts||t.automaticThoughts.trim().length<3){l({title:"Error",description:"Please enter your automatic thoughts",variant:"destructive"}),b(1);return}if(!se){l({title:"Permission Denied",description:"Therapists cannot add reflections to client emotion records",variant:"destructive"}),x();return}q(!0);try{const s={userId:o.id,emotionRecordId:v&&d?d.emotionRecordId:r.id,automaticThoughts:t.automaticThoughts,cognitiveDistortions:t.cognitiveDistortions||[],evidenceFor:t.evidenceFor||"",evidenceAgainst:t.evidenceAgainst||"",alternativePerspective:t.alternativePerspective||"",insightsGained:t.insightsGained||"",reflectionRating:t.reflectionRating||5};let i;v&&d?(i=await(await m("PATCH",`/api/users/${o.id}/thoughts/${d.id}`,s)).json(),l({title:"Success",description:"Your thought record has been updated successfully."})):(i=await(await m("POST",`/api/users/${o.id}/thoughts`,s)).json(),l({title:"Success",description:"Your thought record has been saved successfully."})),g.length>0&&await Promise.all(g.map(c=>m("POST",`/api/users/${o.id}/protective-factor-usage`,{userId:o.id,thoughtRecordId:i.id,protectiveFactorId:c,effectivenessRating:V[c]||5}))),f.length>0&&await Promise.all(f.map(c=>m("POST",`/api/users/${o.id}/coping-strategy-usage`,{userId:o.id,thoughtRecordId:i.id,copingStrategyId:c,effectivenessRating:G[c]||5}))),Pe.invalidateQueries({queryKey:[`/api/users/${o.id}/thoughts`]}),a.reset({automaticThoughts:"",cognitiveDistortions:[],evidenceFor:"",evidenceAgainst:"",alternativePerspective:"",insightsGained:"",reflectionRating:5}),C([]),S([]),b(1),l({title:"Reflection Completed",description:"Your reflection has been recorded successfully."}),v||H(`/thoughts/${i.id}`),x()}catch(s){console.error("Error recording thought reflection:",s),l({title:"Error",description:"Failed to record reflection. Please try again.",variant:"destructive"})}finally{q(!1)}},ge=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx(W,{control:a.control,name:"automaticThoughts",render:({field:t})=>e.jsxs(F,{children:[e.jsx(P,{children:"What thoughts are going through your mind?"}),e.jsxs(X,{children:["Write down any automatic thoughts that came up when you experienced ",r.tertiaryEmotion?`${r.primaryEmotion||r.coreEmotion||"this emotion"} (${r.tertiaryEmotion})`:r.primaryEmotion||r.coreEmotion||"this emotion","."]}),e.jsx(z,{children:e.jsx(ze,{placeholder:"I think that...",className:"min-h-[120px] focus:border-primary focus:ring-1 focus:ring-primary w-full",value:t.value||"",onChange:s=>{const i=s.target.value;t.onChange(i),a.setValue("automaticThoughts",i,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0})},onBlur:t.onBlur,ref:t.ref,name:t.name})}),e.jsx(Re,{})]})}),e.jsx(W,{control:a.control,name:"cognitiveDistortions",render:()=>e.jsxs(F,{className:"space-y-4",children:[e.jsxs("div",{className:"mb-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(P,{className:"text-lg",children:"Identify any cognitive distortions in your thinking:"}),e.jsx(y,{content:"Cognitive distortions are helpful to identify",research:"Research from Beck and Burns (1980) shows that identifying cognitive distortions is a key step in cognitive behavioral therapy. Studies indicate that becoming aware of these patterns can reduce symptoms of depression and anxiety by 40-60% when combined with other CBT techniques."})]}),e.jsx(X,{children:"These are patterns of thinking that can reinforce negative thoughts and emotions. Select any that apply to your situation."})]}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-2",children:te.map(t=>{var i;const s=(i=a.getValues("cognitiveDistortions"))==null?void 0:i.includes(t.value);return e.jsxs(F,{className:"flex flex-row items-start space-x-3 space-y-0",children:[e.jsx(z,{children:e.jsx(Le,{checked:s,onCheckedChange:c=>{const _=a.getValues("cognitiveDistortions")||[],be=c?[..._,t.value]:_.filter(je=>je!==t.value);a.setValue("cognitiveDistortions",be),c?D(t.value):N===t.value&&D(null)}})}),e.jsx("div",{className:"space-y-1",children:e.jsx(P,{className:`font-medium cursor-pointer ${s?"text-primary":""}`,onClick:()=>D(N===t.value?null:t.value),children:t.label})})]},t.value)})}),N&&e.jsx("div",{className:"mt-4 p-4 bg-muted/50 rounded-lg border border-muted-foreground/20",children:te.filter(t=>t.value===N).map(t=>e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-semibold text-primary",children:t.label}),e.jsx("p",{className:"text-sm",children:t.description}),e.jsxs("div",{className:"bg-muted/70 p-3 rounded-md mt-2",children:[e.jsx("p",{className:"text-sm font-medium",children:"Example:"}),e.jsxs("p",{className:"text-sm italic",children:['"',t.example,'"']})]}),e.jsxs("div",{className:"bg-primary/10 p-3 rounded-md mt-2",children:[e.jsx("p",{className:"text-sm font-medium text-primary",children:"How to reframe:"}),e.jsx("p",{className:"text-sm",children:t.reframe})]})]},t.value))})]})})]}),fe=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"p-4 bg-neutral-100 rounded-md mb-4",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("p",{className:"text-sm font-medium mb-2",children:"Your thoughts:"}),e.jsx("p",{className:"text-sm p-3 bg-white rounded border border-neutral-200",children:a.getValues("automaticThoughts")})]})}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"evidenceFor",className:"text-sm font-medium",children:"What evidence supports this thought?"}),e.jsx(y,{content:"Examining evidence is key to changing thoughts",research:"According to meta-analyses by Hofmann et al. (2012), examining evidence for and against automatic thoughts is one of the most effective cognitive restructuring techniques. This process helps develop more balanced thinking patterns and reduces emotional distress by up to 50% in clinical trials."})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"List facts that actually support your thought. Focus on objective information, not feelings."}),e.jsx("textarea",{id:"evidenceFor",name:"evidenceFor",placeholder:"List facts that support this thought...",rows:3,value:a.getValues("evidenceFor")||"",onChange:t=>{a.setValue("evidenceFor",t.target.value,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0})},className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 focus:border-primary focus:ring-1 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"evidenceAgainst",className:"text-sm font-medium",children:"What evidence contradicts this thought?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"List facts that challenge your thought. Look for alternative explanations and realities."}),e.jsx("textarea",{id:"evidenceAgainst",name:"evidenceAgainst",placeholder:"List facts that don't support this thought...",rows:3,value:a.getValues("evidenceAgainst")||"",onChange:t=>{a.setValue("evidenceAgainst",t.target.value,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0})},className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 focus:border-primary focus:ring-1 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{children:[e.jsx(ee,{children:"What protective factors can help you with this situation?"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Protective factors are resources, strengths, or skills that help you manage difficult emotions"})]}),e.jsx(y,{content:"Protective factors build resilience",research:"Research by Masten & Cicchetti (2016) shows that protective factors significantly improve mental health outcomes and reduce symptom severity. Studies demonstrate that individuals who identify and use their protective factors are 3x more likely to recover from mental health challenges and have fewer relapses."})]}),e.jsxs(u,{variant:"ghost",size:"sm",type:"button",className:"text-primary hover:text-primary/80",onClick:t=>{t.preventDefault(),t.stopPropagation(),l({title:"About Protective Factors",description:"Protective factors are personal resources, skills, or relationships that help you cope with stress and build resilience."})},children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Learn More"]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[O.map(t=>e.jsx("div",{className:`px-3 py-2 text-sm border rounded-full cursor-pointer transition-colors ${g.includes(t.id)?"bg-primary text-white border-primary":"bg-white text-neutral-700 border-neutral-300 hover:border-primary"}`,onClick:()=>ce(t.id),children:t.name},t.id)),ie?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-48",placeholder:"Enter new factor...",value:k,onChange:t=>R(t.target.value)}),e.jsx(u,{size:"sm",type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),he()},disabled:!k.trim(),children:"Add"}),e.jsx(u,{size:"sm",type:"button",variant:"outline",onClick:t=>{t.preventDefault(),t.stopPropagation(),E(!1),R("")},children:"Cancel"})]}):e.jsx("div",{className:"px-3 py-2 text-sm border border-dashed border-neutral-400 rounded-full cursor-pointer hover:border-primary",onClick:t=>{t.preventDefault(),t.stopPropagation(),E(!0)},children:"+ Add New"})]}),g.length>0&&e.jsxs("div",{className:"space-y-3 mt-2 p-3 border rounded-md bg-muted/20",children:[e.jsx("h5",{className:"text-sm font-medium",children:"Rate how effective each protective factor is (1-10):"}),e.jsx("div",{className:"space-y-3",children:g.map(t=>{const s=O.find(i=>i.id===t);return s?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsxs("span",{className:"text-sm",children:[V[t]||5,"/10"]})]}),e.jsx(M,{value:[V[t]||5],min:1,max:10,step:1,onValueChange:i=>ue(t,i[0])})]},`rating-${t}`):null})})]}),g.length>0&&e.jsxs("div",{className:"mt-2 p-3 bg-muted/40 rounded-lg text-sm",children:[e.jsx("h5",{className:"font-medium mb-1",children:"Why protective factors matter:"}),e.jsx("p",{children:"Identifying and using your protective factors can build resilience and help you handle difficult situations more effectively."}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-2",children:e.jsxs("div",{className:"bg-background p-2 rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Examples of protective factors:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-1 space-y-1",children:[e.jsx("li",{children:"Social support - Friends, family, community connections"}),e.jsx("li",{children:"Personal skills - Problem-solving abilities, emotional awareness"}),e.jsx("li",{children:"Resources - Access to healthcare, stable housing, education"}),e.jsx("li",{children:"Activities - Exercise, creative outlets, spiritual practices"})]})]})})]})]})]})]}),xe=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"alternativePerspective",className:"text-sm font-medium",children:"What's a more balanced perspective?"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Consider the evidence for and against your thoughts to create a more balanced view."}),e.jsx("textarea",{id:"alternativePerspective",name:"alternativePerspective",placeholder:"A more realistic way to see this situation might be...",rows:4,value:a.getValues("alternativePerspective")||"",onChange:t=>{a.setValue("alternativePerspective",t.target.value,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0})},className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 focus:border-primary focus:ring-1 focus:ring-primary"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{className:"flex items-start gap-2",children:[e.jsxs("div",{children:[e.jsx(ee,{children:"What coping strategies might help you deal with this?"}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Coping strategies are specific actions or techniques you can use to manage stress and difficult emotions"})]}),e.jsx(y,{content:"Effective coping strategies reduce symptoms",research:"Research by Aldao et al. (2010) demonstrates that adaptive coping strategies significantly reduce symptoms of anxiety and depression. A meta-analysis of 114 studies showed that healthy coping strategies like problem-solving, cognitive reframing, and mindfulness can reduce psychological distress by 30-45% compared to avoidant coping methods."})]}),e.jsxs(u,{variant:"ghost",size:"sm",type:"button",className:"text-primary hover:text-primary/80",onClick:t=>{t.preventDefault(),t.stopPropagation(),l({title:"About Coping Strategies",description:"Coping strategies are specific techniques that help you manage stress, regulate emotions, and maintain well-being during difficult situations."})},children:[e.jsx(L,{className:"h-4 w-4 mr-1"}),"Learn More"]})]}),e.jsxs("div",{className:"flex flex-col gap-3",children:[e.jsxs("div",{className:"flex flex-wrap gap-2",children:[J.map(t=>e.jsx("div",{className:`px-3 py-2 text-sm border rounded-full cursor-pointer transition-colors ${f.includes(t.id)?"bg-primary text-white border-primary":"bg-white text-neutral-700 border-neutral-300 hover:border-primary"}`,onClick:()=>de(t.id),children:t.name},t.id)),ae?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Z,{className:"w-48",placeholder:"Enter new strategy...",value:A,onChange:t=>I(t.target.value)}),e.jsx(u,{size:"sm",type:"button",onClick:t=>{t.preventDefault(),t.stopPropagation(),pe()},disabled:!A.trim(),children:"Add"}),e.jsx(u,{size:"sm",type:"button",variant:"outline",onClick:t=>{t.preventDefault(),t.stopPropagation(),T(!1),I("")},children:"Cancel"})]}):e.jsx("div",{className:"px-3 py-2 text-sm border border-dashed border-neutral-400 rounded-full cursor-pointer hover:border-primary",onClick:t=>{t.preventDefault(),t.stopPropagation(),T(!0)},children:"+ Add New"})]}),f.length>0&&e.jsxs("div",{className:"space-y-3 mt-2 p-3 border rounded-md bg-muted/20",children:[e.jsx("h5",{className:"text-sm font-medium",children:"Rate how effective each coping strategy is (1-10):"}),e.jsx("div",{className:"space-y-3",children:f.map(t=>{const s=J.find(i=>i.id===t);return s?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{className:"text-sm font-medium",children:s.name}),e.jsxs("span",{className:"text-sm",children:[G[t]||5,"/10"]})]}),e.jsx(M,{value:[G[t]||5],min:1,max:10,step:1,onValueChange:i=>me(t,i[0])})]},`rating-${t}`):null})})]}),f.length>0&&e.jsxs("div",{className:"mt-2 p-3 bg-muted/40 rounded-lg text-sm",children:[e.jsx("h5",{className:"font-medium mb-1",children:"How to use coping strategies:"}),e.jsx("p",{children:"Effective coping strategies can help you manage stress, regulate emotions, and solve problems more effectively."}),e.jsx("div",{className:"mt-2 grid grid-cols-1 gap-2",children:e.jsxs("div",{className:"bg-background p-2 rounded-md",children:[e.jsx("span",{className:"font-medium",children:"Types of coping strategies:"}),e.jsxs("ul",{className:"list-disc pl-5 mt-1 space-y-1",children:[e.jsxs("li",{children:[e.jsx("strong",{children:"Emotional coping"})," - Managing feelings (deep breathing, mindfulness, journaling)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Problem-focused coping"})," - Taking action (making plans, seeking information, solving problems)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Social coping"})," - Connecting with others (talking to friends, joining support groups)"]}),e.jsxs("li",{children:[e.jsx("strong",{children:"Physical coping"})," - Taking care of your body (exercise, proper sleep, healthy eating)"]})]})]})})]})]})]})]}),ve=()=>e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("label",{htmlFor:"insightsGained",className:"text-sm font-medium",children:"What insights did you gain from this reflection?"}),e.jsx(y,{content:"Insight development improves treatment outcomes",research:"Studies by Kazantzis et al. (2018) indicate that clients who articulate specific insights from CBT exercises show 28% better treatment outcomes than those who don't. Research also demonstrates that written reflection significantly enhances cognitive processing and helps solidify new thinking patterns."})]}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"Summarize what you've learned about your thoughts, feelings, and reactions."}),e.jsx("textarea",{id:"insightsGained",name:"insightsGained",placeholder:"What I've learned from this reflection...",rows:4,value:a.getValues("insightsGained")||"",onChange:t=>{a.setValue("insightsGained",t.target.value,{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0})},className:"flex w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 focus:border-primary focus:ring-1 focus:ring-primary"})]}),e.jsx(W,{control:a.control,name:"reflectionRating",render:({field:t})=>e.jsxs(F,{children:[e.jsx(P,{children:"How helpful was this reflection? (1 = Not helpful, 10 = Very helpful)"}),e.jsx(z,{children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(M,{value:[t.value||5],min:1,max:10,step:1,defaultValue:[5],onValueChange:s=>{t.onChange(s[0]),a.setValue("reflectionRating",s[0],{shouldValidate:!0,shouldDirty:!0,shouldTouch:!0})}}),e.jsxs("div",{className:"flex justify-between text-sm text-neutral-500",children:[e.jsx("span",{children:"Not helpful"}),e.jsx("span",{children:"Somewhat helpful"}),e.jsx("span",{children:"Very helpful"})]}),e.jsxs("div",{className:"text-center text-lg font-medium text-primary",children:[t.value||5,"/10"]})]})})]})}),e.jsxs("div",{className:"mt-8 rounded-lg border p-4 bg-muted/30",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("h3",{className:"text-lg font-medium",children:"Turn Your Insights Into Action"}),e.jsx(y,{content:"Goal-setting improves therapy outcomes",research:"A meta-analysis by Locke & Latham (2019) found that structured goal-setting improved therapy outcomes by 42% compared to therapy without goals. Specifically, SMART goals (Specific, Measurable, Achievable, Relevant, Time-bound) are associated with higher achievement rates (70% vs 35%) compared to vague intentions."})]}),e.jsxs(u,{variant:"outline",size:"sm",className:"flex items-center gap-1",onClick:()=>{const t=a.getValues().insightsGained;t&&sessionStorage.setItem("reflection_insights",t),H("/goal-setting"),x()},children:[e.jsx(Ke,{className:"h-4 w-4"}),e.jsx("span",{children:"Create Goal"})]})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"Consider creating a SMART goal based on your reflections to help you move forward."}),e.jsx(qe,{type:"single",collapsible:!0,className:"w-full",children:e.jsxs(Oe,{value:"smart",children:[e.jsx(Ye,{className:"text-base font-medium",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(L,{className:"h-5 w-5 mr-2 text-primary"}),"SMART Goal Framework"]})}),e.jsx(Je,{className:"text-sm",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{children:"SMART is an acronym to help you create effective goals:"}),e.jsxs("div",{className:"grid grid-cols-1 gap-3",children:[e.jsxs("div",{className:"p-3 rounded-md bg-background",children:[e.jsx("h4",{className:"font-medium",children:"Specific"}),e.jsx("p",{children:'Your goal should be clear and specific, answering the five "W" questions: What, Why, Who, Where, and Which.'}),e.jsx("p",{className:"text-xs mt-1 italic",children:'Example: "I will practice deep breathing for 5 minutes each morning" instead of "I will manage stress better."'})]}),e.jsxs("div",{className:"p-3 rounded-md bg-background",children:[e.jsx("h4",{className:"font-medium",children:"Measurable"}),e.jsx("p",{children:"Include specific metrics to track your progress and know when you've reached your goal."}),e.jsx("p",{className:"text-xs mt-1 italic",children:'Example: "I will walk 30 minutes daily for 5 days a week" instead of "I will exercise more."'})]}),e.jsxs("div",{className:"p-3 rounded-md bg-background",children:[e.jsx("h4",{className:"font-medium",children:"Achievable"}),e.jsx("p",{children:"Your goal should stretch your abilities but still be attainable."}),e.jsx("p",{className:"text-xs mt-1 italic",children:'Example: "I will meditate for 10 minutes daily" instead of "I will meditate for 2 hours daily."'})]}),e.jsxs("div",{className:"p-3 rounded-md bg-background",children:[e.jsx("h4",{className:"font-medium",children:"Relevant"}),e.jsx("p",{children:"Your goal should align with your broader life objectives and personal values."}),e.jsx("p",{className:"text-xs mt-1 italic",children:'Example: "I will practice assertive communication at work" if career advancement is important to you.'})]}),e.jsxs("div",{className:"p-3 rounded-md bg-background",children:[e.jsx("h4",{className:"font-medium",children:"Time-bound"}),e.jsx("p",{children:"Your goal needs a target date to create urgency and maintain focus."}),e.jsx("p",{className:"text-xs mt-1 italic",children:'Example: "I will reduce my anxiety levels by 30% within 6 weeks" instead of "I will feel less anxious someday."'})]})]})]})})]})})]})]})]}),ye=()=>{switch(p){case 1:return ge();case 2:return fe();case 3:return xe();case 4:return ve();default:return null}};return e.jsx(Ve,{open:w,onOpenChange:t=>!t&&x(),children:e.jsxs(Be,{className:"max-w-4xl max-h-[90vh] overflow-auto",children:[e.jsxs(Ge,{children:[e.jsxs($e,{className:"text-2xl flex items-center",children:[e.jsx("div",{className:"w-3 h-3 rounded-full mr-2",style:{backgroundColor:Qe(r.primaryEmotion||r.coreEmotion||"")}}),v?"Edit":"Reflect on"," ",r.tertiaryEmotion?`${r.primaryEmotion||r.coreEmotion||"Emotion"} (${r.tertiaryEmotion})`:r.primaryEmotion||r.coreEmotion||"Emotion"]}),e.jsx("div",{className:"text-sm text-neutral-500 mt-1",children:new Date(r.timestamp).toLocaleString()})]}),e.jsxs("div",{className:"mt-2",children:[e.jsx(Me,{value:ne,className:"h-2 mb-4"}),e.jsx(Te,{...a,children:e.jsx("form",{onSubmit:a.handleSubmit(Q),className:"space-y-6",children:ye()})})]}),e.jsxs(We,{className:"flex justify-between items-center pt-4 border-t",children:[e.jsx("div",{children:p>1&&e.jsx(u,{type:"button",variant:"outline",onClick:le,disabled:j,children:"Back"})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(u,{type:"button",variant:"ghost",onClick:x,disabled:j,children:"Cancel"}),p<U?e.jsx(u,{type:"button",onClick:oe,disabled:j,children:"Next"}):e.jsx(u,{type:"submit",onClick:()=>{const t=a.getValues();if(!t.automaticThoughts||t.automaticThoughts.trim().length<3){l({title:"Error",description:"Please enter your automatic thoughts",variant:"destructive"}),b(1);return}a.handleSubmit(Q)()},disabled:j,className:"bg-primary hover:bg-primary/90",children:j?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"w-4 h-4 rounded-full border-2 border-white border-t-transparent animate-spin mr-2"}),"Submitting..."]}):v?"Update Reflection":"Complete Reflection"})]})]})]})})}export{ut as R};
