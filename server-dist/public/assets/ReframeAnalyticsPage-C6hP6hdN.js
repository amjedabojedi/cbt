import{j as e,i as T,C as a,e as i,f as l,a as c,g as n}from"./index-BJDVYPr2.js";import{u as M}from"./useQuery-CVl6tFXz.js";import{T as P,a as L,b as h,c as m}from"./tabs-DZkkmdmK.js";import{A as j}from"./AppLayout-B4pR-pjA.js";import{A as F}from"./activity-B2O4100s.js";import{C as B}from"./target-7abParum.js";import{C as K}from"./clock-Od4KD6Fc.js";import{R as g,o as E,X as H,Y as k,T as N,B as q,q as O}from"./generateCategoricalChart-CFBGWCRH.js";import{B as X}from"./BarChart-BD1_1xzo.js";import{P as Y,a as G}from"./PieChart-PYX3tuHq.js";import{f as C}from"./format-CrnBQ42y.js";import"./utils-km2FGkQ4.js";import"./index-epKMAjhH.js";import"./index-ZMpGrT0S.js";import"./Header-HmO9KIvP.js";import"./check-CPyQFfyd.js";import"./en-US-9SRVm7yB.js";function ce(){var f,y;const{data:s,isLoading:v,error:p}=M({queryKey:["/api/admin/debug/reframe-coach/results"]});if(v)return e.jsx(j,{title:"Reframe Analytics",children:e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsx(T,{className:"w-8 h-8 animate-spin text-primary"})})});if(p)return e.jsx(j,{title:"Reframe Analytics",children:e.jsx("div",{className:"p-6",children:e.jsxs(a,{children:[e.jsx(i,{children:e.jsx(l,{className:"text-destructive",children:"Error Loading Data"})}),e.jsxs(c,{children:[e.jsx("p",{children:"Failed to load Reframe Coach analytics data. Please try again later."}),e.jsx("pre",{className:"mt-4 p-4 bg-muted rounded-md text-sm overflow-auto",children:p.message})]})]})})});const d=(s==null?void 0:s.totalCount)||0,b=d?Math.round(((s==null?void 0:s.completedCount)||0)/d*100):0;s!=null&&s.recentResultsCount;const R=s!=null&&s.recentResults&&s.recentResults.length>0?Math.round(s.recentResults.reduce((t,r)=>t+r.correctCount/r.totalCount*100,0)/s.recentResults.length):0,A=Array.from({length:7},(t,r)=>{const o=new Date;o.setDate(o.getDate()-r);const D=C(o,"MM/dd"),w=s!=null&&s.recentResults?s.recentResults.filter(S=>new Date(S.createdAt).toDateString()===o.toDateString()).length:0;return{date:D,count:w}}).reverse(),x=(s==null?void 0:s.distortionStats)||[],u=["#0088FE","#00C49F","#FFBB28","#FF8042","#8884d8","#82ca9d"];return e.jsx(j,{title:"Reframe Analytics",children:e.jsxs("div",{className:"p-6",children:[e.jsx("h1",{className:"text-3xl font-bold mb-6",children:"Reframe Coach Analytics"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-6",children:[e.jsxs(a,{children:[e.jsxs(i,{className:"pb-2",children:[e.jsxs(l,{className:"text-lg flex items-center",children:[e.jsx(F,{className:"mr-2 h-4 w-4"}),"Total Practice Sessions"]}),e.jsx(n,{children:"All time"})]}),e.jsx(c,{children:e.jsx("p",{className:"text-3xl font-bold",children:d})})]}),e.jsxs(a,{children:[e.jsxs(i,{className:"pb-2",children:[e.jsxs(l,{className:"text-lg flex items-center",children:[e.jsx(B,{className:"mr-2 h-4 w-4"}),"Completion Rate"]}),e.jsx(n,{children:"Percentage of completed sessions"})]}),e.jsx(c,{children:e.jsxs("p",{className:"text-3xl font-bold",children:[b,"%"]})})]}),e.jsxs(a,{children:[e.jsxs(i,{className:"pb-2",children:[e.jsxs(l,{className:"text-lg flex items-center",children:[e.jsx(K,{className:"mr-2 h-4 w-4"}),"Average Score"]}),e.jsx(n,{children:"Average correct answers"})]}),e.jsx(c,{children:e.jsxs("p",{className:"text-3xl font-bold",children:[R,"%"]})})]})]}),e.jsxs(P,{defaultValue:"activity",children:[e.jsxs(L,{className:"mb-6",children:[e.jsx(h,{value:"activity",children:"Activity"}),e.jsx(h,{value:"distortions",children:"Cognitive Distortions"}),e.jsx(h,{value:"details",children:"Detailed Results"})]}),e.jsx(m,{value:"activity",children:e.jsxs(a,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Daily Practice Activity (Last 7 Days)"}),e.jsx(n,{children:"Number of practice sessions completed per day"})]}),e.jsx(c,{className:"h-80",children:e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(X,{data:A,children:[e.jsx(E,{strokeDasharray:"3 3"}),e.jsx(H,{dataKey:"date"}),e.jsx(k,{allowDecimals:!1}),e.jsx(N,{}),e.jsx(q,{dataKey:"count",fill:"#8884d8",name:"Sessions"})]})})})]})}),e.jsx(m,{value:"distortions",children:e.jsxs(a,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Cognitive Distortion Distribution"}),e.jsx(n,{children:"Most common cognitive distortions in practice scenarios"})]}),e.jsx(c,{className:"h-80",children:x.length>0?e.jsx(g,{width:"100%",height:"100%",children:e.jsxs(Y,{children:[e.jsx(G,{data:x,cx:"50%",cy:"50%",labelLine:!0,outerRadius:80,fill:"#8884d8",dataKey:"count",nameKey:"distortion",label:({distortion:t})=>t,children:x.map((t,r)=>e.jsx(O,{fill:u[r%u.length]},`cell-${r}`))}),e.jsx(N,{})]})}):e.jsx("div",{className:"flex items-center justify-center h-full",children:e.jsx("p",{className:"text-muted-foreground",children:"No distortion data available"})})})]})}),e.jsx(m,{value:"details",children:e.jsxs(a,{children:[e.jsxs(i,{children:[e.jsx(l,{children:"Recent Practice Results"}),e.jsxs(n,{children:["Showing the last ",((f=s==null?void 0:s.recentResults)==null?void 0:f.length)||0," practice results"]})]}),e.jsx(c,{children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full border-collapse",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"border-b",children:[e.jsx("th",{className:"px-4 py-2 text-left",children:"User"}),e.jsx("th",{className:"px-4 py-2 text-left",children:"Date"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Score"}),e.jsx("th",{className:"px-4 py-2 text-right",children:"Time Spent"}),e.jsx("th",{className:"px-4 py-2 text-center",children:"Completed"})]})}),e.jsxs("tbody",{children:[(y=s==null?void 0:s.recentResults)==null?void 0:y.map(t=>e.jsxs("tr",{className:"border-b hover:bg-muted/50",children:[e.jsx("td",{className:"px-4 py-2",children:t.username||t.email}),e.jsx("td",{className:"px-4 py-2",children:C(new Date(t.createdAt),"MMM d, yyyy HH:mm")}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[t.correctCount,"/",t.totalCount,"(",Math.round(t.correctCount/t.totalCount*100),"%)"]}),e.jsxs("td",{className:"px-4 py-2 text-right",children:[Math.round(t.timeSpent/1e3)," seconds"]}),e.jsx("td",{className:"px-4 py-2 text-center",children:t.completed?e.jsx("span",{className:"text-green-600",children:"✓"}):e.jsx("span",{className:"text-red-600",children:"✗"})})]},t.id)),(!(s!=null&&s.recentResults)||s.recentResults.length===0)&&e.jsx("tr",{children:e.jsx("td",{colSpan:5,className:"px-4 py-8 text-center text-muted-foreground",children:"No recent practice results found"})})]})]})})})]})})]})]})})}export{ce as default};
