import{u as se,m as te,n as ae,r as g,j as e,B as b,L as A,C as B,e as E,f as M,g as H,a as U,i as V,l as D}from"./index-BJDVYPr2.js";import{T as re,a as ie,b as W,c as z}from"./tabs-DZkkmdmK.js";import{I as j}from"./input-C744jVRX.js";import{S as ne,a as le,b as oe,c as ce,d as de}from"./select-Bh-crIyN.js";import{u as J,F as _,a as o,b as c,c as d,d as m,f as w,e as h,z as r,t as O}from"./form-Bn3qej8w.js";import"./index-epKMAjhH.js";import"./index-ZMpGrT0S.js";import"./index-pLghM4Oe.js";import"./chevron-down-JR_7gpC-.js";import"./check-CPyQFfyd.js";import"./label-DKKVfa8V.js";const me=r.object({username:r.string().min(2,"Username must be at least 2 characters"),password:r.string().min(6,"Password must be at least 6 characters")}),he=r.object({username:r.string().min(2,"Username must be at least 2 characters"),email:r.string().email("Please enter a valid email address"),password:r.string().min(6,"Password must be at least 6 characters"),name:r.string().min(2,"Name must be at least 2 characters"),role:r.string().default("therapist"),therapistId:r.number().optional(),status:r.string().optional(),isInvitation:r.boolean().optional()});function Ie(){const{user:I,login:Y,register:Z}=se(),[ue,S]=te(),{toast:p}=ae(),k=window.location.href,$=window.location.search||(k.includes("?")?k.split("?")[1]:""),y=new URLSearchParams($),C=window.location.hash.includes("?")?new URLSearchParams(window.location.hash.split("?")[1]):new URLSearchParams,f=y.get("invitation")||C.get("invitation"),u=y.get("email")||C.get("email"),n=y.get("therapistId")||C.get("therapistId");g.useEffect(()=>{if(f==="true"&&u&&n||u&&n){const a={email:u,therapistId:n,timestamp:Date.now()};localStorage.setItem("pending_invitation",JSON.stringify(a)),console.log("Mobile invitation data stored:",a),v("register")}},[f,u,n]);const P=localStorage.getItem("pending_invitation");let i=null;if(P)try{i=JSON.parse(P),Date.now()-(i.timestamp||0)>36e5&&(localStorage.removeItem("pending_invitation"),i=null)}catch{localStorage.removeItem("pending_invitation")}const t=f==="true"||!!u||!!i,q=u||(i==null?void 0:i.email)||"",G=n?parseInt(n):(i==null?void 0:i.therapistId)||void 0,[K,v]=g.useState(t?"register":"login"),[L,T]=g.useState(!1),[F,R]=g.useState(!1),N=J({resolver:O(me),defaultValues:{username:"",password:""}}),l=J({resolver:O(he),defaultValues:{username:"",email:q,password:"",name:"",role:t?"client":"therapist",therapistId:G,status:t?"active":void 0,isInvitation:t||!1}});g.useEffect(()=>{t&&(v("register"),p({title:"Client Invitation",description:"A mental health professional has invited you to create an account. Please register to access your therapy tools."}))},[f,p]),g.useEffect(()=>{I&&S("/")},[I,S]);const Q=async s=>{T(!0);try{await Y(s.username,s.password)}catch(a){console.error(a),p({title:"Login Failed",description:a.message||"An error occurred. Please try again.",variant:"destructive"})}finally{T(!1)}},X=async s=>{R(!0);try{const a={...s};if(n){const x=parseInt(n);isNaN(x)||(a.therapistId=x,console.log("Registering with therapist ID:",x))}t&&(console.log("Registering from invitation - setting status to active and isInvitation flag"),a.status="active",a.isInvitation=!0);const ee=await Z(a);if(t&&localStorage.removeItem("pending_invitation"),t){try{(await fetch(`/api/users/${ee.id}/update-status`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:"active"})})).ok&&console.log("Successfully updated user status to active")}catch(x){console.error("Error updating status:",x)}p({title:"Registration Complete",description:"Your account has been created and connected to your therapist."})}}catch(a){console.error(a),p({title:"Registration Failed",description:a.message||"An error occurred. Please try again.",variant:"destructive"})}finally{R(!1)}};return e.jsxs("div",{className:"flex min-h-screen flex-col md:flex-row",children:[e.jsx("div",{className:"flex flex-col items-center justify-center w-full md:w-1/2 p-8 auth-container",children:e.jsxs("div",{className:"w-full max-w-md",children:[e.jsxs("div",{className:"flex flex-col items-center mb-8",children:[e.jsx("div",{className:"flex justify-center w-full mb-4",children:e.jsx(b,{asChild:!0,variant:"ghost",className:"flex items-center gap-2 text-muted-foreground",children:e.jsxs(A,{href:"/",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"mr-1",children:[e.jsx("path",{d:"m12 19-7-7 7-7"}),e.jsx("path",{d:"M19 12H5"})]}),"Back to Home"]})})}),e.jsx("h1",{className:"text-3xl font-bold text-neutral-800",children:"ResilienceHub"}),e.jsx("p",{className:"text-neutral-500 mt-2",children:t?"Complete your registration to connect with your mental health professional":"Your interactive CBT tools for tracking emotions, thoughts, and behaviors"})]}),e.jsxs(re,{value:K,onValueChange:v,className:"w-full auth-tabs",children:[e.jsxs(ie,{className:"grid w-full grid-cols-2 mb-6 tabs-list",children:[e.jsx(W,{value:"login",className:"tabs-trigger",children:"Login"}),e.jsx(W,{value:"register",className:"tabs-trigger",children:t?"Client Registration":"Professional Registration"})]}),!t&&e.jsxs("div",{className:"mb-4 p-3 rounded bg-blue-50 border border-blue-100 text-blue-700 text-sm",children:[e.jsx("p",{className:"font-medium mb-1",children:"Note:"}),e.jsxs("ul",{className:"list-disc list-inside space-y-1",children:[e.jsx("li",{children:"Clients need an invitation from their mental health professional"}),e.jsx("li",{children:"Professionals can register directly using the form"}),e.jsx("li",{children:"If you received an invitation, check your email for the registration link"})]})]}),e.jsx(z,{value:"login",children:e.jsxs(B,{className:"auth-card",children:[e.jsxs(E,{children:[e.jsx(M,{className:"card-title",children:"Welcome Back"}),e.jsx(H,{className:"card-description",children:"Enter your credentials to access your account"})]}),e.jsx(U,{children:e.jsx(_,{...N,children:e.jsxs("form",{onSubmit:N.handleSubmit(Q),className:"space-y-4",children:[e.jsx(o,{control:N.control,name:"username",render:({field:s})=>e.jsxs(c,{className:"form-item",children:[e.jsx(d,{children:"Username or Email"}),e.jsx(m,{children:e.jsx(j,{placeholder:"johndoe or john@example.com",...s})}),e.jsx(w,{className:"form-description",children:"You can log in with either your username or email address"}),e.jsx(h,{className:"form-message"})]})}),e.jsx(o,{control:N.control,name:"password",render:({field:s})=>e.jsxs(c,{className:"form-item",children:[e.jsx(d,{children:"Password"}),e.jsx(m,{children:e.jsx(j,{type:"password",placeholder:"••••••••",...s})}),e.jsx("div",{className:"flex justify-end mt-2",children:e.jsx(A,{href:"/forgot-password",className:"text-sm text-blue-600 hover:text-blue-800 font-medium",children:"Forgot Password?"})}),e.jsx(h,{className:"form-message"})]})}),e.jsx(b,{type:"submit",className:"w-full auth-button",disabled:L,children:L?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Logging in..."]}):"Log In"})]})})}),e.jsx(D,{className:"flex justify-center",children:e.jsx("p",{className:"text-sm text-muted-foreground",children:"Clients need an invitation from a mental health professional to register. If you're a professional, please select 'Register' to create an account."})})]})}),e.jsx(z,{value:"register",className:"mt-6",children:e.jsxs(B,{className:"auth-card",children:[e.jsxs(E,{children:[e.jsx(M,{className:"card-title",children:t?"Complete Your Registration":"Create Account"}),e.jsx(H,{className:"card-description",children:t?"Fill out the form below to finalize your account creation":"Join Resilience CBT to access interactive CBT tools"})]}),e.jsx(U,{children:e.jsx(_,{...l,children:e.jsxs("form",{onSubmit:l.handleSubmit(X),className:"space-y-4",children:[e.jsx(o,{control:l.control,name:"name",render:({field:s})=>e.jsxs(c,{className:"form-item",children:[e.jsx(d,{children:"Full Name"}),e.jsx(m,{children:e.jsx(j,{placeholder:"John Doe",...s})}),e.jsx(h,{className:"form-message"})]})}),e.jsx(o,{control:l.control,name:"username",render:({field:s})=>e.jsxs(c,{className:"form-item",children:[e.jsx(d,{children:"Username"}),e.jsx(m,{children:e.jsx(j,{placeholder:"johndoe",...s})}),e.jsx(w,{className:"form-description",children:"This will be used to log in to your account"}),e.jsx(h,{className:"form-message"})]})}),e.jsx(o,{control:l.control,name:"email",render:({field:s})=>e.jsxs(c,{className:"form-item",children:[e.jsx(d,{children:"Email"}),e.jsx(m,{children:e.jsx(j,{type:"email",placeholder:"john.doe@example.com",...s,disabled:t,className:t?"bg-muted":""})}),e.jsx(h,{className:"form-message"})]})}),e.jsx(o,{control:l.control,name:"password",render:({field:s})=>e.jsxs(c,{className:"form-item",children:[e.jsx(d,{children:"Password"}),e.jsx(m,{children:e.jsx(j,{type:"password",placeholder:"••••••••",...s})}),e.jsx(w,{className:"form-description",children:"Must be at least 6 characters"}),e.jsx(h,{className:"form-message"})]})}),!t&&e.jsx(o,{control:l.control,name:"role",render:({field:s})=>e.jsxs(c,{className:"form-item",children:[e.jsx(d,{children:"Account Type"}),e.jsxs(ne,{onValueChange:s.onChange,defaultValue:s.value,children:[e.jsx(m,{children:e.jsx(le,{className:"select-trigger",children:e.jsx(oe,{placeholder:"Select account type"})})}),e.jsx(ce,{className:"select-content",children:e.jsx(de,{value:"therapist",className:"select-item",children:"Mental Health Professional"})})]}),e.jsx(w,{className:"form-description",children:"As a mental health professional, you'll be enrolled in the Free trial plan automatically"}),e.jsx(h,{className:"form-message"})]})}),t&&e.jsx("input",{type:"hidden",...l.register("role"),value:"client"}),e.jsx(b,{type:"submit",className:"w-full auth-button",disabled:F,children:F?e.jsxs("div",{className:"flex items-center justify-center",children:[e.jsx(V,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating account..."]}):"Create Account"})]})})}),e.jsx(D,{className:"flex justify-center",children:e.jsxs("p",{className:"text-sm text-muted-foreground",children:["Already have an account?"," ",e.jsx(b,{variant:"link",className:"p-0",onClick:()=>v("login"),children:"Log in"})]})})]})})]})]})}),e.jsx("div",{className:"hidden md:flex md:w-1/2 bg-white p-8 items-center justify-center auth-container",children:e.jsxs("div",{className:"max-w-lg",children:[e.jsx("h2",{className:"text-3xl font-bold text-primary mb-4",children:t?"Welcome to ResilienceHub":"Advanced Interactive CBT Tools"}),e.jsx("p",{className:"text-lg mb-6 text-neutral-700",children:t?"A mental health professional has invited you to join ResilienceHub, where you'll have access to personalized interactive CBT tools for tracking.":"ResilienceHub provides a comprehensive suite of tools for tracking emotions, thoughts, and behaviors designed around evidence-based approaches."}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-primary mr-4",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M14 9a2 2 0 0 1-2 2H6l-4 4V4c0-1.1.9-2 2-2h8a2 2 0 0 1 2 2v5Z"}),e.jsx("path",{d:"M18 9h2a2 2 0 0 1 2 2v11l-4-4h-6a2 2 0 0 1-2-2v-1"})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-primary mb-1",children:"Professional-Client Connection"}),e.jsx("p",{className:"text-neutral-600",children:"Share your tracking data securely with your mental health professional."})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-primary mr-4",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("path",{d:"M12 16v-4"}),e.jsx("path",{d:"M12 8h.01"})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-primary mb-1",children:"Advanced Emotion Tracking"}),e.jsx("p",{className:"text-neutral-600",children:"Identify, record, and understand your emotions with our specialized tools."})]})]}),e.jsxs("div",{className:"flex items-start",children:[e.jsx("div",{className:"flex-shrink-0 h-10 w-10 rounded-full bg-blue-100 flex items-center justify-center text-primary mr-4",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"}),e.jsx("path",{d:"M13.73 21a2 2 0 0 1-3.46 0"})]})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-primary mb-1",children:"Personal Progress Insights"}),e.jsx("p",{className:"text-neutral-600",children:"Track your progress with detailed analytics and visualizations."})]})]})]})]})})]})}export{Ie as default};
