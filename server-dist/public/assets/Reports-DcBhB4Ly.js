import{c as U,u as oe,r as K,n as ce,j as e,B as de,C as o,a as c,e as p,f,g}from"./index-BJDVYPr2.js";import{u as E}from"./useQuery-CVl6tFXz.js";import{A as me}from"./AppLayout-B4pR-pjA.js";import{T as xe,a as he,b as A,c as F}from"./tabs-DZkkmdmK.js";import{S as ue,a as je,b as pe,c as fe,d as y}from"./select-Bh-crIyN.js";import{H as ge}from"./target-7abParum.js";import{F as ye}from"./file-text-CB9D2AC_.js";import{T as be}from"./trending-up-CZSEG5Sb.js";import{C as q}from"./chart-pie-_0cUHNFN.js";import{R as b,q as P,T as v,p as N,o as I,X as G,Y as O,B as ve}from"./generateCategoricalChart-CFBGWCRH.js";import{P as Y,a as H}from"./PieChart-PYX3tuHq.js";import{a as Ne,L as we,s as _}from"./LineChart-D-Uu3kL0.js";import{B as Ce}from"./BarChart-BD1_1xzo.js";import{f as V}from"./format-CrnBQ42y.js";import{s as De}from"./subMonths-CJEKbx3n.js";import"./utils-km2FGkQ4.js";import"./Header-HmO9KIvP.js";import"./index-ZMpGrT0S.js";import"./index-epKMAjhH.js";import"./check-CPyQFfyd.js";import"./index-pLghM4Oe.js";import"./chevron-down-JR_7gpC-.js";import"./en-US-9SRVm7yB.js";import"./addMonths-CPL-v1oH.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=U("ChartNoAxesColumn",[["line",{x1:"18",x2:"18",y1:"20",y2:"10",key:"1xfpm4"}],["line",{x1:"12",x2:"12",y1:"20",y2:"4",key:"be30l9"}],["line",{x1:"6",x2:"6",y1:"20",y2:"14",key:"1r4le6"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Te=U("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);function ze(){const{user:i}=oe(),[h,X]=K.useState("month"),{data:n=[],isLoading:Q}=E({queryKey:i?[`/api/users/${i.id}/emotions`]:[],enabled:!!i}),{data:d=[],isLoading:z}=E({queryKey:i?[`/api/users/${i.id}/thoughts`]:[],enabled:!!i}),{data:l=[],isLoading:J}=E({queryKey:i?[`/api/users/${i.id}/goals`]:[],enabled:!!i}),Z=()=>{if(!n||n.length===0)return[];const s=w(n,h),t={};return s.forEach(a=>{const r=a.coreEmotion;t[r]=(t[r]||0)+1}),Object.entries(t).map(([a,r])=>({name:a,value:r}))},ee=()=>{if(!n||n.length===0)return[];const s=w(n,h),t={};return s.forEach(a=>{const r=V(new Date(a.timestamp),"yyyy-MM-dd");t[r]||(t[r]={total:0,count:0}),t[r].total+=a.intensity,t[r].count+=1}),Object.entries(t).map(([a,r])=>({date:V(new Date(a),"MMM d"),intensity:parseFloat((r.total/r.count).toFixed(1))})).sort((a,r)=>new Date(a.date).getTime()-new Date(r.date).getTime())},te=()=>{if(!d||d.length===0)return[];const s=w(d,h),t={};return s.forEach(a=>{a.cognitiveDistortions&&a.cognitiveDistortions.length>0&&a.cognitiveDistortions.forEach(r=>{const x=ae(r);t[x]=(t[x]||0)+1})}),Object.entries(t).map(([a,r])=>({name:a,value:r})).sort((a,r)=>r.value-a.value).slice(0,5)},se=()=>{if(!l||l.length===0)return[];const s={Pending:0,"In Progress":0,Completed:0,Approved:0};return l.forEach(t=>{switch(t.status){case"pending":s.Pending++;break;case"in_progress":s["In Progress"]++;break;case"completed":s.Completed++;break;case"approved":s.Approved++;break}}),Object.entries(s).filter(([t,a])=>a>0).map(([t,a])=>({name:t,value:a}))},w=(s,t)=>{const a=new Date;let r;switch(t){case"week":r=_(a,7);break;case"month":r=_(a,30);break;case"year":r=De(a,12);break;case"all":default:return s}return s.filter(x=>{const $=new Date(x.timestamp||x.createdAt);return $>=r&&$<=a})},ae=s=>s.split("-").map(t=>t.charAt(0).toUpperCase()+t.slice(1)).join(" "),m=["#4285F4","#EA4335","#FBBC05","#34A853","#8F44AD"],R=({active:s,payload:t})=>s&&t&&t.length?e.jsxs("div",{className:"bg-white p-3 border border-neutral-200 rounded-md shadow-sm",children:[e.jsx("p",{className:"font-medium",children:t[0].name}),e.jsxs("p",{className:"text-sm",children:["Count: ",e.jsx("span",{className:"font-medium",children:t[0].value})]}),e.jsxs("p",{className:"text-sm",children:["Percentage: ",e.jsxs("span",{className:"font-medium",children:[(t[0].value/t[0].payload.total*100).toFixed(1),"%"]})]})]}):null,re=(n==null?void 0:n.length)||0,ie=(d==null?void 0:d.length)||0,L=(l==null?void 0:l.length)||0,ne=(l==null?void 0:l.filter(s=>s.status==="completed"||s.status==="approved").length)||0,le=L>0?parseFloat((ne/L*100).toFixed(1)):0,C=Z(),S=ee(),D=te(),u=se(),B=C.map(s=>({...s,total:C.reduce((t,a)=>t+a.value,0)})),j=Q||z||J,{toast:T}=ce(),[M,k]=K.useState(!1);return e.jsx(me,{title:"Reports",children:e.jsxs("div",{className:"container mx-auto px-4 py-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-neutral-800",children:"Progress Reports"}),e.jsx("p",{className:"text-neutral-500",children:"Analytics and insights to track your journey"})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs(ue,{value:h,onValueChange:s=>X(s),children:[e.jsx(je,{className:"w-[180px]",children:e.jsx(pe,{placeholder:"Select time range"})}),e.jsxs(fe,{children:[e.jsx(y,{value:"week",children:"Past Week"}),e.jsx(y,{value:"month",children:"Past Month"}),e.jsx(y,{value:"year",children:"Past Year"}),e.jsx(y,{value:"all",children:"All Time"})]})]}),e.jsx(de,{variant:"outline",disabled:M,onClick:()=>{k(!0);try{T({title:"Starting export...",description:"Your PDF report is being generated."});const s="/api/export/pdf?type=all",t=document.createElement("a");t.href=s,t.setAttribute("download",""),document.body.appendChild(t),t.click(),document.body.removeChild(t),setTimeout(()=>{T({title:"Export complete",description:"Your PDF report has been downloaded.",variant:"default"}),k(!1)},2e3)}catch(s){console.error("Export error:",s),T({title:"Export failed",description:"There was a problem generating your PDF report. Please try again later.",variant:"destructive"}),k(!1)}},children:M?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"h-4 w-4 mr-2 animate-spin rounded-full border-2 border-primary border-t-transparent"}),"Exporting..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Te,{className:"h-4 w-4 mr-2"}),"Export Report"]})})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4 mb-6",children:[e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-500 text-sm",children:"Total Emotions Recorded"}),e.jsx("h3",{className:"text-3xl font-bold text-neutral-800 mt-1",children:re})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center",children:e.jsx(ge,{className:"h-6 w-6 text-blue-600"})})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-500 text-sm",children:"Thought Records Completed"}),e.jsx("h3",{className:"text-3xl font-bold text-neutral-800 mt-1",children:ie})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-purple-100 flex items-center justify-center",children:e.jsx(ye,{className:"h-6 w-6 text-purple-600"})})]})})}),e.jsx(o,{children:e.jsx(c,{className:"pt-6",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-neutral-500 text-sm",children:"Goal Completion Rate"}),e.jsxs("h3",{className:"text-3xl font-bold text-neutral-800 mt-1",children:[le,"%"]})]}),e.jsx("div",{className:"w-12 h-12 rounded-full bg-green-100 flex items-center justify-center",children:e.jsx(be,{className:"h-6 w-6 text-green-600"})})]})})})]}),e.jsxs(xe,{defaultValue:"emotions",children:[e.jsxs(he,{className:"mb-6",children:[e.jsx(A,{value:"emotions",children:"Emotions"}),e.jsx(A,{value:"thoughts",children:"Thoughts"}),e.jsx(A,{value:"goals",children:"Goals"})]}),e.jsx(F,{value:"emotions",className:"space-y-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs(o,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2 text-primary"}),"Emotion Distribution"]}),e.jsx(g,{children:"Breakdown of your core emotions"})]}),e.jsx(c,{children:j?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):C.length===0?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"No emotion data available"})}):e.jsx("div",{className:"h-64",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(Y,{children:[e.jsx(H,{data:B,cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:s,percent:t})=>`${s} (${(t*100).toFixed(0)}%)`,labelLine:!1,children:B.map((s,t)=>e.jsx(P,{fill:m[t%m.length]},`cell-${t}`))}),e.jsx(v,{content:e.jsx(R,{})}),e.jsx(N,{})]})})})})]}),e.jsxs(o,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center",children:[e.jsx(W,{className:"h-5 w-5 mr-2 text-primary"}),"Emotion Intensity Trend"]}),e.jsx(g,{children:"Average intensity over time"})]}),e.jsx(c,{children:j?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):S.length===0?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"No intensity data available"})}):e.jsx("div",{className:"h-64",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(Ne,{data:S,margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(G,{dataKey:"date"}),e.jsx(O,{domain:[0,10]}),e.jsx(v,{}),e.jsx(N,{}),e.jsx(we,{type:"monotone",dataKey:"intensity",stroke:"#4285F4",strokeWidth:2,activeDot:{r:8}})]})})})})]})]})}),e.jsx(F,{value:"thoughts",className:"space-y-6",children:e.jsxs(o,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center",children:[e.jsx(W,{className:"h-5 w-5 mr-2 text-primary"}),"Top Cognitive Distortions"]}),e.jsx(g,{children:"Most frequent thought patterns identified"})]}),e.jsx(c,{children:j?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):D.length===0?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"No cognitive distortion data available"})}):e.jsx("div",{className:"h-64",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(Ce,{data:D,layout:"vertical",margin:{top:5,right:30,left:20,bottom:5},children:[e.jsx(I,{strokeDasharray:"3 3"}),e.jsx(G,{type:"number"}),e.jsx(O,{dataKey:"name",type:"category",width:150}),e.jsx(v,{}),e.jsx(N,{}),e.jsx(ve,{dataKey:"value",fill:"#8F44AD",name:"Frequency",children:D.map((s,t)=>e.jsx(P,{fill:m[t%m.length]},`cell-${t}`))})]})})})})]})}),e.jsx(F,{value:"goals",className:"space-y-6",children:e.jsxs(o,{children:[e.jsxs(p,{children:[e.jsxs(f,{className:"flex items-center",children:[e.jsx(q,{className:"h-5 w-5 mr-2 text-primary"}),"Goal Status Distribution"]}),e.jsx(g,{children:"Current status of your SMART goals"})]}),e.jsx(c,{children:j?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary"})}):u.length===0?e.jsx("div",{className:"h-64 flex items-center justify-center",children:e.jsx("p",{className:"text-neutral-500",children:"No goal data available"})}):e.jsx("div",{className:"h-64",children:e.jsx(b,{width:"100%",height:"100%",children:e.jsxs(Y,{children:[e.jsx(H,{data:u.map(s=>({...s,total:u.reduce((t,a)=>t+a.value,0)})),cx:"50%",cy:"50%",outerRadius:80,fill:"#8884d8",dataKey:"value",label:({name:s,percent:t})=>`${s} (${(t*100).toFixed(0)}%)`,labelLine:!1,children:u.map((s,t)=>e.jsx(P,{fill:m[t%m.length]},`cell-${t}`))}),e.jsx(v,{content:e.jsx(R,{})}),e.jsx(N,{})]})})})})]})})]})]})})}export{ze as default};
